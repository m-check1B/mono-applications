import{w as n,o as c,z as o}from"./BuVZNLKp.js";class h{#e=n(null);get socket(){return c(this.#e)}set socket(e){o(this.#e,e,!0)}#t=n(!1);get connected(){return c(this.#t)}set connected(e){o(this.#t,e,!0)}#s=n(!1);get reconnecting(){return c(this.#s)}set reconnecting(e){o(this.#s,e,!0)}handlers=new Set;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;connect(e){const r="ws://127.0.0.1:3010/ws",i=e?`${r}?token=${e}`:r;try{this.socket=new WebSocket(i),this.socket.onopen=()=>{this.connected=!0,this.reconnecting=!1,this.reconnectAttempts=0,console.log("WebSocket connected")},this.socket.onmessage=t=>{try{const s=JSON.parse(t.data);this.handlers.forEach(a=>a(s))}catch(s){console.error("Failed to parse WebSocket message:",s)}},this.socket.onerror=t=>{console.error("WebSocket error:",t)},this.socket.onclose=()=>{this.connected=!1,console.log("WebSocket disconnected"),this.attemptReconnect()}}catch(t){console.error("Failed to create WebSocket:",t)}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnecting=!0,this.reconnectAttempts++,setTimeout(()=>{console.log(`Reconnecting... (attempt ${this.reconnectAttempts})`),this.connect()},this.reconnectDelay*this.reconnectAttempts)}disconnect(){this.socket&&(this.socket.close(),this.socket=null,this.connected=!1)}onMessage(e){return this.handlers.add(e),()=>this.handlers.delete(e)}send(e){this.socket&&this.connected?this.socket.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message")}}const k=new h;export{k as w};
