import{c as Ee,a as b,f as j}from"../chunks/pFl1CK35.js";import{a as Ve,o as ft}from"../chunks/0VtO9hYy.js";import{h as ge,p as Re,i as Oe,f as g,d as t,e as i,t as ve,c as Me,u as Rt,g as a,s as ne,r as e,n as ue,a as We,j as he}from"../chunks/aQ_ifger.js";import{s as k}from"../chunks/DBuqHHqM.js";import{i as O}from"../chunks/BTxJJ6eU.js";import{d as $e}from"../chunks/C918u5xm.js";import{s as xe}from"../chunks/DGR2HyJN.js";import{l as ht,s as gt,p as we}from"../chunks/DzqNI6-e.js";import{w as mt,g as Te}from"../chunks/B4dMqloI.js";import{a as _e}from"../chunks/BqAhscvM.js";import{e as Ke,i as bt}from"../chunks/oqRKM5NY.js";import{s as Se}from"../chunks/C8vjnfWO.js";import{c as _t}from"../chunks/CEkw2kT7.js";import{M as dt}from"../chunks/t44G3NBe.js";import{U as Mt}from"../chunks/BS24MMqf.js";import{B as Dt}from"../chunks/Civmg7zw.js";import{P as Lt,c as Pt}from"../chunks/B6mJBgjZ.js";import{A as nt}from"../chunks/eZUK58Ls.js";import{R as Ge}from"../chunks/DVBVNVSq.js";import{C as Ht}from"../chunks/CCzAia_M.js";import{a as Ft,W as Nt}from"../chunks/C0dSNkxj.js";import{C as Ot}from"../chunks/CPLHLQIe.js";import{T as vt,c as yt}from"../chunks/Zr3TcUzR.js";import{S as Wt}from"../chunks/DYJXI9Zw.js";import"../chunks/CnJ-dsFT.js";import{s as St}from"../chunks/DaxPoLM8.js";import{I as xt}from"../chunks/D7pKbUF5.js";import{b as Ut}from"../chunks/Bo6fAwy7.js";import{P as zt}from"../chunks/C6dIHe7_.js";import{P as Jt}from"../chunks/C8ipYI_7.js";import{M as Bt}from"../chunks/DQwSrkCv.js";import{M as Qt}from"../chunks/BcyIxIqt.js";function ut(P,s){const n=ht(s,["children","$$slots","$$events","$$legacy"]);const l=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]];xt(P,gt({name:"volume-2"},()=>n,{get iconNode(){return l},children:(o,h)=>{var u=Ee(),H=ge(u);St(H,s,"default",{}),b(o,u)},$$slots:{default:!0}}))}function Gt(P,s){const n=ht(s,["children","$$slots","$$events","$$legacy"]);const l=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]];xt(P,gt({name:"volume-x"},()=>n,{get iconNode(){return l},children:(o,h)=>{var u=Ee(),H=ge(u);St(H,s,"default",{}),b(o,u)},$$slots:{default:!0}}))}var Vt=j('<span class="status-dot svelte-1blqu8h" aria-hidden="true"></span> <span class="status-text svelte-1blqu8h">Connected</span>',1),$t=j('<span class="status-dot svelte-1blqu8h" aria-hidden="true"></span> <span class="status-text svelte-1blqu8h">Connecting...</span>',1),Yt=j('<span class="status-dot svelte-1blqu8h" aria-hidden="true"></span> <span class="status-text svelte-1blqu8h">No Active Call</span>',1),Kt=j('<div class="call-control-panel svelte-1blqu8h" role="region" aria-label="Call controls"><div class="status-bar svelte-1blqu8h"><div role="status" aria-live="polite"><!></div> <div class="call-timer svelte-1blqu8h" role="timer" aria-label="Call duration"><span class="timer-icon svelte-1blqu8h" aria-hidden="true">‚è±</span> <span class="timer-text svelte-1blqu8h"> </span></div></div> <div class="controls svelte-1blqu8h" role="group" aria-label="Call control buttons"><button tabindex="0"><span class="icon svelte-1blqu8h" aria-hidden="true"> </span> <span class="label svelte-1blqu8h"> </span> <span class="sr-only svelte-1blqu8h"> </span></button> <button tabindex="0"><span class="icon svelte-1blqu8h" aria-hidden="true"> </span> <span class="label svelte-1blqu8h"> </span> <span class="sr-only svelte-1blqu8h"> </span></button> <button class="control-btn transfer svelte-1blqu8h" aria-label="Transfer call to another agent" tabindex="0"><span class="icon svelte-1blqu8h" aria-hidden="true">‚Üó</span> <span class="label svelte-1blqu8h">Transfer</span></button> <button class="control-btn end-call svelte-1blqu8h" aria-label="End call" tabindex="0"><span class="icon svelte-1blqu8h" aria-hidden="true">üìû</span> <span class="label svelte-1blqu8h">End Call</span></button></div></div>');function Xt(P,s){Re(s,!0);let n=we(s,"session",11,null),l=ne(!1),o=ne(!1),h=ne(0),u=ne("disconnected"),H=null;const A=R=>{const r=Math.floor(R/60),w=R%60;return`${r.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`},I=()=>{H||(H=setInterval(()=>{Rt(h)},1e3))},L=()=>{H&&(clearInterval(H),H=null)},q=()=>{g(l,!a(l)),s.onMute?.(a(l))},Y=()=>{g(o,!a(o)),s.onHold?.(a(o))},D=()=>{L(),g(h,0),g(u,"disconnected"),s.onEndCall?.()},W=()=>{s.onTransfer?.()};Oe(()=>{n()?.status==="connected"?(g(u,"connected"),I()):n()?.status==="connecting"?g(u,"connecting"):(g(u,"disconnected"),L())}),Ve(()=>{L()});var K=Kt(),se=t(K),C=t(se);let _;var c=t(C);{var p=R=>{var r=Vt();ue(2),b(R,r)},x=R=>{var r=Ee(),w=ge(r);{var m=v=>{var y=$t();ue(2),b(v,y)},G=v=>{var y=Yt();ue(2),b(v,y)};O(w,v=>{a(u)==="connecting"?v(m):v(G,!1)},!0)}b(R,r)};O(c,R=>{a(u)==="connected"?R(p):R(x,!1)})}e(C);var M=i(C,2),T=i(t(M),2),B=t(T,!0);e(T),e(M),e(se);var X=i(se,2),F=t(X);let N;F.__click=q;var U=t(F),re=t(U,!0);e(U);var ae=i(U,2),le=t(ae,!0);e(ae);var Z=i(ae,2),ce=t(Z,!0);e(Z),e(F);var V=i(F,2);let de;V.__click=Y;var $=t(V),pe=t($,!0);e($);var ie=i($,2),f=t(ie,!0);e(ie);var E=i(ie,2),ee=t(E,!0);e(E),e(V);var d=i(V,2);d.__click=W;var S=i(d,2);S.__click=D,e(X),e(K),ve(R=>{_=xe(C,1,"status-indicator svelte-1blqu8h",null,_,{connected:a(u)==="connected",connecting:a(u)==="connecting",disconnected:a(u)==="disconnected"}),k(B,R),N=xe(F,1,"control-btn mute svelte-1blqu8h",null,N,{active:a(l)}),F.disabled=a(u)!=="connected",_e(F,"aria-label",a(l)?"Unmute microphone":"Mute microphone"),_e(F,"aria-pressed",a(l)),k(re,a(l)?"üîá":"üé§"),k(le,a(l)?"Unmute":"Mute"),k(ce,a(l)?"Microphone is muted":"Microphone is active"),de=xe(V,1,"control-btn hold svelte-1blqu8h",null,de,{active:a(o)}),V.disabled=a(u)!=="connected",_e(V,"aria-label",a(o)?"Resume call":"Place call on hold"),_e(V,"aria-pressed",a(o)),k(pe,a(o)?"‚ñ∂":"‚è∏"),k(f,a(o)?"Resume":"Hold"),k(ee,a(o)?"Call is on hold":"Call is active"),d.disabled=a(u)!=="connected",S.disabled=a(u)==="disconnected"},[()=>A(a(h))]),b(P,K),Me()}$e(["click"]);var Zt=j('<span role="alert" aria-live="assertive"><span aria-hidden="true" class="svelte-6xlqpg">‚ö†</span> <span class="sr-only svelte-6xlqpg"> </span></span>'),es=j('<span class="emotion-badge svelte-6xlqpg" role="listitem"><span aria-hidden="true" class="svelte-6xlqpg"> </span></span>'),ts=j('<div class="trend-info svelte-6xlqpg" role="group" aria-label="Sentiment trend information"><div class="trend-item svelte-6xlqpg"><span class="trend-label svelte-6xlqpg">Trend:</span> <span role="status" aria-live="polite"><span aria-hidden="true" class="svelte-6xlqpg"> </span> <span class="sr-only svelte-6xlqpg"> </span></span></div> <div class="trend-item svelte-6xlqpg"><span class="trend-label svelte-6xlqpg">Avg Polarity:</span> <span class="trend-value svelte-6xlqpg" role="status"> </span></div> <div class="trend-item svelte-6xlqpg"><span class="trend-label svelte-6xlqpg">Changes:</span> <span class="trend-value svelte-6xlqpg" role="status"> </span></div></div>'),ss=j('<div class="header svelte-6xlqpg"><h3 class="title svelte-6xlqpg">Customer Sentiment</h3> <!></div> <div class="current-sentiment svelte-6xlqpg" role="status" aria-live="polite" aria-atomic="true"><div class="sentiment-label svelte-6xlqpg"><span class="sentiment-text svelte-6xlqpg"> </span> <span class="confidence svelte-6xlqpg"> </span> <span class="sr-only svelte-6xlqpg"> </span></div> <div class="emotions svelte-6xlqpg" role="list" aria-label="Detected emotions"></div></div> <div class="polarity-bar svelte-6xlqpg" role="group" aria-label="Sentiment polarity indicator"><div class="polarity-labels svelte-6xlqpg" aria-hidden="true"><span class="label-negative svelte-6xlqpg">Negative</span> <span class="label-neutral svelte-6xlqpg">Neutral</span> <span class="label-positive svelte-6xlqpg">Positive</span></div> <div class="polarity-track svelte-6xlqpg" role="img"><div class="polarity-fill svelte-6xlqpg" aria-hidden="true"></div> <div class="polarity-indicator svelte-6xlqpg" aria-hidden="true"></div></div> <div class="polarity-value svelte-6xlqpg" role="status"> <span class="sr-only svelte-6xlqpg"> </span></div></div> <div class="intensity-meter svelte-6xlqpg" role="group" aria-label="Sentiment intensity meter"><span class="intensity-label svelte-6xlqpg" id="intensity-label">Intensity:</span> <div class="intensity-bar svelte-6xlqpg" role="progressbar" aria-labelledby="intensity-label" aria-valuemin="0" aria-valuemax="100"><div class="intensity-fill svelte-6xlqpg" aria-hidden="true"></div></div> <span class="intensity-value svelte-6xlqpg"> </span></div> <!> <div class="footer svelte-6xlqpg" role="contentinfo"><span class="speaker-badge svelte-6xlqpg"><span aria-hidden="true" class="svelte-6xlqpg"> </span> </span> <time class="timestamp svelte-6xlqpg"> </time></div>',1),as=j('<div class="no-data svelte-6xlqpg" role="status" aria-live="polite"><span class="icon svelte-6xlqpg" aria-hidden="true">üòê</span> <p class="svelte-6xlqpg">No sentiment data yet</p> <p class="hint svelte-6xlqpg">Sentiment will appear once the conversation starts</p></div>'),ns=j('<div class="sentiment-indicator svelte-6xlqpg" role="region" aria-label="Customer sentiment analysis"><!></div>');function rs(P,s){Re(s,!0);let n=we(s,"sentiment",11,null),l=we(s,"trend",11,null);const o={happy:"üòä",satisfied:"üôÇ",neutral:"üòê",frustrated:"üò§",angry:"üò†",confused:"üòï",anxious:"üò∞"},h={very_positive:"#10b981",positive:"#84cc16",neutral:"#a3a3a3",negative:"#f59e0b",very_negative:"#ef4444"},u=D=>h[D]||"#a3a3a3",H=D=>(D+1)/2*100,A=D=>D.split("_").map(W=>W.charAt(0).toUpperCase()+W.slice(1)).join(" ");var I=ns(),L=t(I);{var q=D=>{var W=ss(),K=ge(W),se=i(t(K),2);{var C=v=>{var y=Zt();let Q;var te=i(t(y)),oe=i(te),ye=t(oe);e(oe),e(y),ve(ke=>{Q=xe(y,1,"alert-badge svelte-6xlqpg",null,Q,{high:l().alert_level==="high",medium:l().alert_level==="medium",low:l().alert_level==="low"}),k(te,` ${ke??""} `),k(ye,`Alert: ${l().alert_level??""} sentiment level detected`)},[()=>l().alert_level.toUpperCase()]),b(v,y)};O(se,v=>{l()&&l().alert_level!=="none"&&v(C)})}e(K);var _=i(K,2),c=t(_),p=t(c),x=t(p,!0);e(p);var M=i(p,2),T=t(M);e(M);var B=i(M,2),X=t(B);e(B),e(c);var F=i(c,2);Ke(F,21,()=>n().emotions,bt,(v,y)=>{var Q=es(),te=t(Q),oe=t(te,!0);e(te),e(Q),ve(()=>{_e(Q,"aria-label",`${a(y)??""} emotion`),_e(Q,"title",a(y)),k(oe,o[a(y)]||"üòê")}),b(v,Q)}),e(F),e(_);var N=i(_,2),U=i(t(N),2),re=t(U),ae=i(re,2);e(U);var le=i(U,2),Z=t(le),ce=i(Z),V=t(ce);e(ce),e(le),e(N);var de=i(N,2),$=i(t(de),2),pe=t($);e($);var ie=i($,2),f=t(ie);e(ie),e(de);var E=i(de,2);{var ee=v=>{var y=ts(),Q=t(y),te=i(t(Q),2);let oe;var ye=t(te),ke=t(ye,!0);e(ye);var qe=i(ye),Le=i(qe),De=t(Le);e(Le),e(te),e(Q);var Ie=i(Q,2),Ae=i(t(Ie),2),Ue=t(Ae,!0);e(Ae),e(Ie);var Pe=i(Ie,2),He=i(t(Pe),2),Fe=t(He,!0);e(He),e(Pe),e(y),ve(ze=>{oe=xe(te,1,"trend-value svelte-6xlqpg",null,oe,{improving:l().is_improving,declining:!l().is_improving}),k(ke,l().is_improving?"üìà":"üìâ"),k(qe,` ${l().is_improving?"Improving":"Declining"} `),k(De,`Sentiment trend is ${l().is_improving?"improving":"declining"}`),k(Ue,ze),k(Fe,l().sentiment_changes)},[()=>l().average_polarity.toFixed(2)]),b(v,y)};O(E,v=>{l()&&v(ee)})}var d=i(E,2),S=t(d),R=t(S),r=t(R,!0);e(R);var w=i(R);e(S);var m=i(S,2),G=t(m,!0);e(m),e(d),ve((v,y,Q,te,oe,ye,ke,qe,Le,De,Ie,Ae,Ue,Pe,He,Fe,ze,Je,Ye)=>{_e(_,"aria-label",`Current sentiment: ${v??""}`),Se(p,`color: ${y??""}`),k(x,Q),k(T,`(${te??""}% confident)`),k(X,`Customer sentiment is ${oe??""} with ${ye??""} percent confidence`),_e(U,"aria-label",`Polarity score: ${ke??""} out of range -1 to 1`),Se(re,`width: ${qe??""}%;
					background: ${Le??""}`),Se(ae,`left: ${De??""}%;
					background: ${Ie??""}`),k(Z,`Score: ${Ae??""} `),k(V,`Polarity score is ${Ue??""}, ranging from -1 (very negative) to 1 (very positive)`),_e($,"aria-valuenow",Pe),_e($,"aria-valuetext",`${He??""} percent`),Se(pe,`width: ${n().intensity*100}%;
					background: ${Fe??""}`),k(f,`${ze??""}%`),k(r,n().speaker==="customer"?"üë§":"üë®‚Äçüíº"),k(w,` ${n().speaker==="customer"?"Customer":"Agent"}`),_e(m,"datetime",Je),k(G,Ye)},[()=>A(n().sentiment),()=>u(n().sentiment),()=>A(n().sentiment),()=>Math.round(n().confidence*100),()=>A(n().sentiment),()=>Math.round(n().confidence*100),()=>n().polarity_score.toFixed(2),()=>H(n().polarity_score),()=>u(n().sentiment),()=>H(n().polarity_score),()=>u(n().sentiment),()=>n().polarity_score.toFixed(2),()=>n().polarity_score.toFixed(2),()=>Math.round(n().intensity*100),()=>Math.round(n().intensity*100),()=>u(n().sentiment),()=>Math.round(n().intensity*100),()=>new Date(n().timestamp).toISOString(),()=>new Date(n().timestamp).toLocaleTimeString()]),b(D,W)},Y=D=>{var W=as();b(D,W)};O(L,D=>{n()?D(q):D(Y,!1)})}e(I),b(P,I),Me()}var is=j('<span class="badge svelte-1w4jx6a"> </span>'),os=j('<button class="action-btn primary svelte-1w4jx6a"><span class="btn-icon svelte-1w4jx6a">‚úì</span> Use Response</button>'),ls=j('<button class="action-btn secondary svelte-1w4jx6a"><span class="btn-icon svelte-1w4jx6a">üëÅ</span> View Article</button>'),cs=j('<button class="action-btn secondary svelte-1w4jx6a"><span class="btn-icon svelte-1w4jx6a">‚Ñπ</span> More Info</button>'),ds=j('<div class="suggestion-card svelte-1w4jx6a"><div class="card-header svelte-1w4jx6a"><div class="type-badge svelte-1w4jx6a"><span class="type-icon svelte-1w4jx6a"> </span> <span class="type-text"> </span></div> <div class="priority-badge svelte-1w4jx6a"> </div></div> <h4 class="suggestion-title svelte-1w4jx6a"> </h4> <p class="suggestion-content svelte-1w4jx6a"> </p> <div class="card-footer svelte-1w4jx6a"><div class="confidence svelte-1w4jx6a"><span class="confidence-label svelte-1w4jx6a">Confidence:</span> <div class="confidence-bar svelte-1w4jx6a"><div class="confidence-fill svelte-1w4jx6a"></div></div> <span class="confidence-value svelte-1w4jx6a"> </span></div></div> <div class="card-actions svelte-1w4jx6a"><!> <button class="action-btn dismiss svelte-1w4jx6a"><span class="btn-icon svelte-1w4jx6a">‚úï</span> Dismiss</button></div></div>'),vs=j('<div class="no-suggestions svelte-1w4jx6a"><span class="no-suggestions-icon svelte-1w4jx6a">ü§ñ</span> <p class="no-suggestions-text svelte-1w4jx6a">No suggestions yet</p> <p class="no-suggestions-hint svelte-1w4jx6a">AI assistance will appear as the conversation progresses</p></div>'),us=j('<div class="ai-assistance-panel svelte-1w4jx6a"><div class="header svelte-1w4jx6a"><h3 class="title svelte-1w4jx6a"><span class="icon svelte-1w4jx6a">ü§ñ</span> AI Assistance</h3> <!></div> <div class="suggestions-list svelte-1w4jx6a"><!></div></div>');function ps(P,s){Re(s,!0);let n=we(s,"suggestions",27,()=>We([]));const l={suggested_response:"üí¨",knowledge_article:"üìö",compliance_warning:"‚ö†Ô∏è",performance_tip:"üí°",escalation_guide:"üöÄ"},o={urgent:{bg:"#fef2f2",border:"#ef4444",text:"#991b1b"},high:{bg:"#fff7ed",border:"#f97316",text:"#9a3412"},medium:{bg:"#fef3c7",border:"#f59e0b",text:"#92400e"},low:{bg:"#f0fdf4",border:"#10b981",text:"#065f46"}},h=C=>C.split("_").map(_=>_.charAt(0).toUpperCase()+_.slice(1)).join(" "),u=C=>{s.onUseSuggestion?.(C)},H=C=>{s.onDismissSuggestion?.(C)},A=he(()=>()=>{const C=["urgent","high","medium","low"];return[...n()].sort((_,c)=>{const p=C.indexOf(_.priority)-C.indexOf(c.priority);return p!==0?p:c.confidence-_.confidence})});var I=us(),L=t(I),q=i(t(L),2);{var Y=C=>{var _=is(),c=t(_);e(_),ve(()=>k(c,`${n().length??""} ${n().length===1?"suggestion":"suggestions"}`)),b(C,_)};O(q,C=>{n().length>0&&C(Y)})}e(L);var D=i(L,2),W=t(D);{var K=C=>{var _=Ee(),c=ge(_);Ke(c,17,()=>a(A)(),p=>p.id,(p,x)=>{const M=he(()=>o[a(x).priority]);var T=ds(),B=t(T),X=t(B),F=t(X),N=t(F,!0);e(F);var U=i(F,2),re=t(U,!0);e(U),e(X);var ae=i(X,2),le=t(ae,!0);e(ae),e(B);var Z=i(B,2),ce=t(Z,!0);e(Z);var V=i(Z,2),de=t(V,!0);e(V);var $=i(V,2),pe=t($),ie=i(t(pe),2),f=t(ie);e(ie);var E=i(ie,2),ee=t(E);e(E),e(pe),e($);var d=i($,2),S=t(d);{var R=m=>{var G=os();G.__click=()=>u(a(x)),ve(()=>Se(G,`background: ${a(M).border??""}`)),b(m,G)},r=m=>{var G=Ee(),v=ge(G);{var y=te=>{var oe=ls();oe.__click=()=>u(a(x)),ve(()=>Se(oe,`color: ${a(M).border??""}; border-color: ${a(M).border??""}`)),b(te,oe)},Q=te=>{var oe=cs();oe.__click=()=>u(a(x)),ve(()=>Se(oe,`color: ${a(M).border??""}; border-color: ${a(M).border??""}`)),b(te,oe)};O(v,te=>{a(x).type==="knowledge_article"?te(y):te(Q,!1)},!0)}b(m,G)};O(S,m=>{a(x).type==="suggested_response"?m(R):m(r,!1)})}var w=i(S,2);w.__click=()=>H(a(x).id),e(d),e(T),ve((m,G,v)=>{Se(T,`background: ${a(M).bg??""}; border-color: ${a(M).border??""}`),Se(X,`color: ${a(M).text??""}`),k(N,l[a(x).type]||"üìå"),k(re,m),Se(ae,`color: ${a(M).text??""}`),k(le,G),Se(Z,`color: ${a(M).text??""}`),k(ce,a(x).title),k(de,a(x).content),Se(f,`width: ${a(x).confidence*100}%;
									background: ${a(M).border??""}`),k(ee,`${v??""}%`)},[()=>h(a(x).type),()=>a(x).priority.toUpperCase(),()=>Math.round(a(x).confidence*100)]),b(p,T)}),b(C,_)},se=C=>{var _=vs();b(C,_)};O(W,C=>{a(A)().length>0?C(K):C(se,!1)})}e(D),e(I),b(P,I),Me()}$e(["click"]);var fs=j('<span class="inline-flex items-center gap-1.5 border-2 border-terminal-green bg-void px-2 py-0.5 text-[10px] font-bold uppercase text-terminal-green" role="status" aria-live="polite"><span class="size-1.5 animate-pulse bg-terminal-green" aria-hidden="true"></span> Live_Feed <span class="sr-only">Transcription is live</span></span>'),hs=j('<div class="flex flex-col items-center justify-center py-24 text-center border-2 border-dashed border-muted/20" role="status"><div class="relative mb-6"><!> <div class="absolute inset-0 flex items-center justify-center"><span class="text-terminal-green animate-pulse font-mono text-xs">AWAITING_SIGNAL...</span></div></div> <p class="text-[11px] font-bold uppercase tracking-[0.2em] text-muted-foreground max-w-xs">No active stream detected. Start a call to initiate real-time logging.</p></div>'),gs=j('<div class="absolute top-0 right-0 p-1"><div class="w-1 h-1 bg-terminal-green animate-pulse"></div></div>'),ms=j('<div role="article"><div class="flex items-start gap-4"><div aria-hidden="true"><!></div> <div class="flex-1 space-y-2"><div class="flex items-center justify-between border-b border-foreground/10 pb-1"><span> </span> <time class="text-[9px] font-mono font-bold text-muted-foreground"> </time></div> <p class="text-sm font-mono leading-relaxed text-foreground"> </p></div></div> <!></div>'),bs=j('<article class="brutal-card h-full flex flex-col" role="region" aria-label="Live transcription"><div class="flex items-center justify-between mb-6 border-b-2 border-foreground pb-4"><div class="flex items-center gap-3"><!> <h2 class="text-xl font-display uppercase tracking-tight">Transcription</h2> <!></div> <span class="text-[10px] font-mono font-bold uppercase tracking-widest text-muted-foreground" role="status" aria-live="polite" aria-atomic="true"> </span></div> <div class="flex-1 space-y-4 overflow-y-auto pr-2 custom-scrollbar svelte-1k71it6" role="log" aria-live="polite" aria-relevant="additions" aria-label="Conversation transcript"><!></div></article>');function _s(P,s){Re(s,!0);let n=we(s,"messages",19,()=>[]),l=we(s,"segments",19,()=>[]),o=we(s,"isLive",3,!1);const h=l().length>0?l():n();function u(T){return T.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function H(T){return T==="user"?"Customer":"AI Agent"}function A(T){return T==="user"?Mt:Dt}function I(T){return T==="user"?"text-cyan-data":"text-terminal-green"}function L(T){return T==="user"?"bg-cyan-data/5":"bg-terminal-green/5"}var q=bs(),Y=t(q),D=t(Y),W=t(D);dt(W,{class:"size-5 text-foreground","aria-hidden":"true"});var K=i(W,4);{var se=T=>{var B=fs();b(T,B)};O(K,T=>{o()&&T(se)})}e(D);var C=i(D,2),_=t(C);e(C),e(Y);var c=i(Y,2),p=t(c);{var x=T=>{var B=hs(),X=t(B),F=t(X);dt(F,{class:"size-16 text-muted/10","aria-hidden":"true"}),ue(2),e(X),ue(2),e(B),b(T,B)},M=T=>{var B=Ee(),X=ge(B);Ke(X,17,()=>h,F=>F.timestamp,(F,N)=>{var U=ms(),re=t(U),ae=t(re),le=t(ae);_t(le,()=>A(a(N).role),(d,S)=>{S(d,{class:"size-4"})}),e(ae);var Z=i(ae,2),ce=t(Z),V=t(ce),de=t(V);e(V);var $=i(V,2),pe=t($,!0);e($),e(ce);var ie=i(ce,2),f=t(ie,!0);e(ie),e(Z),e(re);var E=i(re,2);{var ee=d=>{var S=gs();b(d,S)};O(E,d=>{a(N).role==="assistant"&&d(ee)})}e(U),ve((d,S,R,r,w,m,G)=>{xe(U,1,`border-2 border-foreground p-4 relative group hover:shadow-[4px_4px_0px_0px_rgba(51,255,0,0.5)] transition-all ${d??""}`,"svelte-1k71it6"),_e(U,"aria-label",`${S??""} message`),xe(ae,1,R,"svelte-1k71it6"),xe(V,1,r,"svelte-1k71it6"),k(de,`// ${w??""}`),_e($,"datetime",m),k(pe,G),k(f,a(N).content)},[()=>L(a(N).role),()=>H(a(N).role),()=>`border-2 border-foreground p-2 bg-void ${I(a(N).role)}`,()=>`text-[10px] font-black uppercase tracking-widest ${I(a(N).role)}`,()=>H(a(N).role),()=>a(N).timestamp.toISOString(),()=>u(a(N).timestamp)]),b(F,U)}),b(T,B)};O(p,T=>{h.length===0?T(x):T(M,!1)})}e(c),e(q),ve(()=>k(_,`[${h.length??""}] Segments`)),b(P,q),Me()}const pt="1.0.0",st="voice-kraliki-session-state",at=10,ys=1e3;function Ss(){const P={call:null,provider:"gemini",audio:{isMuted:!1,isRecording:!1,inputLevel:0,outputLevel:0},ui:{activePanel:"transcription",sidebarOpen:!0,theme:"light"},errors:[],lastActivity:Date.now(),version:pt},s=mt(P);let n=null,l=[];function o(){n&&clearTimeout(n),n=setTimeout(()=>{h(),n=null},ys)}function h(){try{const p={...Te(s),lastActivity:Date.now()};localStorage.setItem(st,JSON.stringify(p)),console.log("üíæ Session state saved")}catch(c){console.error("‚ùå Failed to save session state:",c)}}function u(){try{const c=localStorage.getItem(st);if(!c)return!1;const p=JSON.parse(c);if(p.version!==pt)return console.warn("‚ö†Ô∏è State version mismatch, clearing old state"),H(),!1;if(!A(p))return console.warn("‚ö†Ô∏è Invalid state structure, clearing state"),H(),!1;p.callHistory&&(l=p.callHistory.slice(0,at));const x={...p,call:null,audio:{...p.audio,isRecording:!1,inputLevel:0,outputLevel:0},errors:p.errors.filter(M=>Date.now()-M.timestamp<3e5)};return s.set(x),console.log("üì• Session state restored"),!0}catch(c){return console.error("‚ùå Failed to restore session state:",c),H(),!1}}function H(){try{localStorage.removeItem(st),s.set(P),l=[],console.log("üóëÔ∏è Session state cleared")}catch(c){console.error("‚ùå Failed to clear session state:",c)}}function A(c){return!(!c||typeof c!="object"||!c.version||!c.provider||!c.audio||!c.ui||!["gemini","openai","deepgram_nova3"].includes(c.provider))}function I(c){s.update(p=>{const x=p.call?{...p.call,...c}:c;return p.call&&c.status==="ended"&&(l=[{...p.call,...c},...l.slice(0,at-1)]),{...p,call:x}}),o()}function L(c){s.update(p=>({...p,provider:c})),o()}function q(c){s.update(p=>({...p,audio:{...p.audio,...c}})),o()}function Y(c){s.update(p=>({...p,ui:{...p.ui,...c}})),o()}function D(c){const p={...c,timestamp:Date.now()};s.update(x=>({...x,errors:[...x.errors.slice(-9),p]})),o()}function W(){s.update(c=>({...c,errors:[]})),o()}async function K(c){const x=Te(s).errors.find(M=>M.code===c);if(!x||!x.recoverable||!x.recoveryAction)return!1;try{return console.log(`üîÑ Attempting to recover from error: ${c}`),await x.recoveryAction(),s.update(M=>({...M,errors:M.errors.filter(T=>T.code!==c)})),o(),!0}catch(M){return console.error(`‚ùå Failed to recover from error ${c}:`,M),!1}}function se(){return[...l]}function C(){const p={...Te(s),callHistory:l,exportedAt:Date.now()};return JSON.stringify(p,null,2)}function _(c){try{const p=JSON.parse(c);if(!A(p))throw new Error("Invalid state structure");p.callHistory&&(l=p.callHistory.slice(0,at));const x={...p,call:null,audio:{...p.audio,isRecording:!1,inputLevel:0,outputLevel:0}};return s.set(x),o(),console.log("üì• State imported successfully"),!0}catch(p){return console.error("‚ùå Failed to import state:",p),!1}}return s.subscribe(()=>{o()}),setInterval(()=>{const c=Te(s),p=c.errors.filter(x=>Date.now()-x.timestamp<3e5);p.length!==c.errors.length&&s.update(x=>({...x,errors:p}))},6e4),{subscribe:s.subscribe,saveState:h,restoreState:u,clearState:H,updateCallState:I,updateProvider:L,updateAudioState:q,updateUIState:Y,addError:D,clearErrors:W,recoverFromError:K,getCallHistory:se,exportState:C,importState:_}}var xs=j("<!> Testing...",1),ws=j("<!> Mic Working",1),ks=j("<!> Mic Issue",1),Cs=j("<!> Test Microphone",1),js=j('<div class="recommendation svelte-12jkq20"><!> <span> </span></div>'),qs=j('<div class="recommendations-section svelte-12jkq20"><h4 class="svelte-12jkq20">Recommendations</h4> <div class="recommendations svelte-12jkq20"></div></div>'),As=j("<!> Retrying...",1),Ts=j("<!> Reconnect",1),Is=j('<button type="button" class="action-button primary svelte-12jkq20"><!></button>'),Es=j('<button type="button" class="action-button secondary svelte-12jkq20"><!> Switch Provider</button>'),Rs=j('<button type="button" class="action-button secondary svelte-12jkq20"><!> Settings</button>'),Ms=j('<span class="status-dot live svelte-12jkq20"></span> Live',1),Ds=j('<span class="status-dot idle svelte-12jkq20"></span> Idle',1),Ls=j('<div class="expanded-view svelte-12jkq20"><div class="metrics-section svelte-12jkq20"><h4 class="svelte-12jkq20">Connection Metrics</h4> <div class="metrics-grid svelte-12jkq20"><div class="metric svelte-12jkq20"><span class="label svelte-12jkq20">Latency</span> <span class="value svelte-12jkq20"> </span></div> <div class="metric svelte-12jkq20"><span class="label svelte-12jkq20">Packet Loss</span> <span class="value svelte-12jkq20"> </span></div> <div class="metric svelte-12jkq20"><span class="label svelte-12jkq20">Bitrate</span> <span class="value svelte-12jkq20"> </span></div> <div class="metric svelte-12jkq20"><span class="label svelte-12jkq20">Audio Level</span> <span class="value svelte-12jkq20"> </span></div></div></div> <div class="audio-section svelte-12jkq20"><h4 class="svelte-12jkq20">Audio Test</h4> <div class="audio-test svelte-12jkq20"><button type="button" class="test-button svelte-12jkq20"><!></button></div></div> <!> <div class="actions-section svelte-12jkq20"><h4 class="svelte-12jkq20">Actions</h4> <div class="actions svelte-12jkq20"><!> <!> <!></div></div> <div class="provider-section svelte-12jkq20"><h4 class="svelte-12jkq20">Provider</h4> <div class="provider-info svelte-12jkq20"><span class="provider-name svelte-12jkq20"> </span> <span class="provider-status svelte-12jkq20"><!></span></div></div></div>'),Ps=j('<div class="connection-status svelte-12jkq20"><div><div class="status-indicator svelte-12jkq20"><!> <span class="status-text svelte-12jkq20"> </span></div> <div class="quality-indicator svelte-12jkq20"><div><div class="quality-fill svelte-12jkq20"></div></div> <span class="quality-text svelte-12jkq20"> </span></div> <!> <!></div> <!></div>');function Hs(P,s){Re(s,!0);let n=we(s,"isLive",3,!1),l=we(s,"currentProvider",3,"unknown"),o=we(s,"showDetails",3,!1),h=ne(!1),u=ne(!1),H=ne(We(Date.now())),A=ne(!1),I=ne(null);const L=he(()=>()=>{if(!s.stats)return"unknown";const{latency:d,packetLoss:S,bitrate:R}=s.stats;return d<100&&S<1&&R>50?"excellent":d<200&&S<3&&R>30?"good":d<500&&S<10&&R>10?"fair":"poor"}),q=he(()=>()=>s.stats?s.stats.connectionState:"unknown"),Y=he(()=>()=>{switch(a(L)()){case"excellent":return"text-green-500";case"good":return"text-blue-500";case"fair":return"text-yellow-500";case"poor":return"text-red-500";default:return"text-gray-500"}}),D=he(()=>()=>{switch(a(q)()){case"connected":return Ot;case"connecting":return Ge;case"disconnected":return Ft;case"failed":return Ht;case"reconnecting":return Ge;default:return nt}}),W=he(()=>()=>{switch(a(q)()){case"connected":return"Connected";case"connecting":return"Connecting...";case"disconnected":return"Disconnected";case"failed":return"Connection Failed";case"reconnecting":return"Reconnecting...";default:return"Unknown"}}),K=he(()=>()=>{switch(a(L)()){case"excellent":return"Excellent";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return"Unknown"}}),se=he(()=>()=>s.stats?s.stats.latency>300||s.stats.packetLoss>5||s.stats.audioLevel<.1:!1),C=he(()=>()=>{const d=[];return s.stats&&(s.stats.latency>300&&d.push("High latency detected. Check your internet connection."),s.stats.packetLoss>5&&d.push("Packet loss detected. Consider switching providers or networks."),s.stats.audioLevel<.1&&n()&&d.push("Low audio input detected. Check your microphone."),s.stats.bitrate<20&&n()&&d.push("Low audio quality detected. Check audio settings.")),d});async function _(){g(A,!0),g(I,"testing");try{const d=await navigator.mediaDevices.getUserMedia({audio:!0}),S=new(window.AudioContext||window.webkitAudioContext),R=S.createAnalyser();S.createMediaStreamSource(d).connect(R),R.fftSize=256;const w=new Uint8Array(R.frequencyBinCount);R.getByteFrequencyData(w);const G=w.reduce((v,y)=>v+y,0)/w.length/255;d.getTracks().forEach(v=>v.stop()),await S.close(),g(I,G>.1?"passed":"failed",!0)}catch(d){console.error("Audio test failed:",d),g(I,"failed")}finally{g(A,!1)}}async function c(){if(!(a(u)||!s.onRetry)){g(u,!0);try{await s.onRetry()}finally{g(u,!1)}}}function p(d){return d<1e3?`${Math.round(d)}ms`:`${(d/1e3).toFixed(1)}s`}function x(d){return d<1e3?`${Math.round(d)} kbps`:`${(d/1e3).toFixed(1)} Mbps`}function M(d){return`${Math.round(d*100)}%`}Oe(()=>{a(se)()&&!a(h)&&g(h,!0)});let T;ft(()=>{T=setInterval(()=>{g(H,Date.now(),!0)},5e3)}),Ve(()=>{T&&clearInterval(T)});var B=Ps(),X=t(B);let F;X.__click=()=>g(h,!a(h));var N=t(X),U=t(N);{let d=he(()=>a(Y)()),S=he(()=>a(q)()==="connecting"||a(q)()==="reconnecting"?"spinning":"");_t(U,()=>a(D)(),(R,r)=>{r(R,{get class(){return`icon ${a(d)??""} ${a(S)??""}`}})})}var re=i(U,2),ae=t(re,!0);e(re),e(N);var le=i(N,2),Z=t(le);let ce;var V=i(Z,2),de=t(V,!0);e(V),e(le);var $=i(le,2);{var pe=d=>{vt(d,{class:"warning-icon"})};O($,d=>{a(se)()&&d(pe)})}var ie=i($,2);{var f=d=>{{let S=he(()=>a(h)?"rotated":"");nt(d,{get class(){return`expand-icon ${a(S)??""}`}})}};O(ie,d=>{o()&&d(f)})}e(X);var E=i(X,2);{var ee=d=>{var S=Ls(),R=t(S),r=i(t(R),2),w=t(r),m=i(t(w),2),G=t(m,!0);e(m),e(w);var v=i(w,2),y=i(t(v),2),Q=t(y,!0);e(y),e(v);var te=i(v,2),oe=i(t(te),2),ye=t(oe,!0);e(oe),e(te);var ke=i(te,2),qe=i(t(ke),2),Le=t(qe,!0);e(qe),e(ke),e(r),e(R);var De=i(R,2),Ie=i(t(De),2),Ae=t(Ie);Ae.__click=_;var Ue=t(Ae);{var Pe=z=>{var J=xs(),me=ge(J);Ge(me,{class:"animate-spin"}),ue(),b(z,J)},He=z=>{var J=Ee(),me=ge(J);{var Ce=fe=>{var be=ws(),je=ge(be);ut(je,{class:"text-green-500"}),ue(),b(fe,be)},Be=fe=>{var be=Ee(),je=ge(be);{var et=Ne=>{var Qe=ks(),tt=ge(Qe);Gt(tt,{class:"text-red-500"}),ue(),b(Ne,Qe)},Et=Ne=>{var Qe=Cs(),tt=ge(Qe);ut(tt,{}),ue(),b(Ne,Qe)};O(je,Ne=>{a(I)==="failed"?Ne(et):Ne(Et,!1)},!0)}b(fe,be)};O(me,fe=>{a(I)==="passed"?fe(Ce):fe(Be,!1)},!0)}b(z,J)};O(Ue,z=>{a(A)?z(Pe):z(He,!1)})}e(Ae),e(Ie),e(De);var Fe=i(De,2);{var ze=z=>{var J=qs(),me=i(t(J),2);Ke(me,21,()=>a(C)(),bt,(Ce,Be)=>{var fe=js(),be=t(fe);vt(be,{class:"icon"});var je=i(be,2),et=t(je,!0);e(je),e(fe),ve(()=>k(et,a(Be))),b(Ce,fe)}),e(me),e(J),b(z,J)};O(Fe,z=>{a(C)().length>0&&z(ze)})}var Je=i(Fe,2),Ye=i(t(Je),2),rt=t(Ye);{var wt=z=>{var J=Is();J.__click=c;var me=t(J);{var Ce=fe=>{var be=As(),je=ge(be);Ge(je,{class:"animate-spin"}),ue(),b(fe,be)},Be=fe=>{var be=Ts(),je=ge(be);Ge(je,{}),ue(),b(fe,be)};O(me,fe=>{a(u)?fe(Ce):fe(Be,!1)})}e(J),ve(()=>J.disabled=a(u)),b(z,J)};O(rt,z=>{a(q)()!=="connected"&&s.onRetry&&z(wt)})}var it=i(rt,2);{var kt=z=>{var J=Es();J.__click=function(...Ce){s.onSwitchProvider?.apply(this,Ce)};var me=t(J);Nt(me,{}),ue(),e(J),b(z,J)};O(it,z=>{s.onSwitchProvider&&z(kt)})}var Ct=i(it,2);{var jt=z=>{var J=Rs();J.__click=function(...Ce){s.onSettings?.apply(this,Ce)};var me=t(J);Wt(me,{}),ue(),e(J),b(z,J)};O(Ct,z=>{s.onSettings&&z(jt)})}e(Ye),e(Je);var ot=i(Je,2),lt=i(t(ot),2),Ze=t(lt),qt=t(Ze,!0);e(Ze);var ct=i(Ze,2),At=t(ct);{var Tt=z=>{var J=Ms();ue(),b(z,J)},It=z=>{var J=Ds();ue(),b(z,J)};O(At,z=>{n()?z(Tt):z(It,!1)})}e(ct),e(lt),e(ot),e(S),ve((z,J,me,Ce)=>{k(G,z),k(Q,J),k(ye,me),k(Le,Ce),Ae.disabled=a(A),k(qt,l())},[()=>s.stats?p(s.stats.latency):"N/A",()=>s.stats?M(s.stats.packetLoss/100):"N/A",()=>s.stats?x(s.stats.bitrate):"N/A",()=>s.stats?M(s.stats.audioLevel):"N/A"]),b(d,S)};O(E,d=>{a(h)&&o()&&d(ee)})}e(B),ve((d,S,R)=>{F=xe(X,1,"compact-view svelte-12jkq20",null,F,{expanded:a(h)}),k(ae,d),ce=xe(Z,1,"quality-bar svelte-12jkq20",null,ce,S),k(de,R)},[()=>a(W)(),()=>({excellent:a(L)()==="excellent",good:a(L)()==="good",fair:a(L)()==="fair",poor:a(L)()==="poor"}),()=>a(K)()]),b(P,B),Me()}$e(["click"]);function Fs(P={}){const n={...{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],enableAudio:!0,enableVideo:!1,autoReconnect:!0,reconnectInterval:3e3,maxReconnectAttempts:5},...P},l=mt({connectionState:"idle",latency:0,packetLoss:0,audioLevel:0,bitrate:0,lastUpdate:Date.now()});let o=null,h=null,u=null;const H=yt();let A=null,I=null,L=null,q=null,Y=null,D=0,W=null,K="";function se(f){l.update(E=>({...E,...f,lastUpdate:Date.now()}))}function C(f){se({connectionState:f}),console.log("üîó WebRTC connection state:",f)}async function _(){const f=new RTCPeerConnection({iceServers:n.iceServers});return f.addEventListener("connectionstatechange",()=>{switch(f.connectionState){case"connected":C("connected"),D=0;break;case"disconnected":C("disconnected"),n.autoReconnect&&N();break;case"failed":C("failed");break;case"connecting":C("connecting");break}}),f.addEventListener("iceconnectionstatechange",()=>{console.log("üßä ICE connection state:",f.iceConnectionState)}),f.addEventListener("track",E=>{E.streams&&E.streams[0]&&(E.streams[0],console.log("üéµ Received remote audio stream"))}),h&&h.getTracks().forEach(E=>{f.addTrack(E,h)}),f}async function c(){if(n.enableAudio)try{h=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1}),p(),console.log("üé§ Local audio stream established")}catch(f){throw console.error("‚ùå Failed to setup local audio:",f),f}}function p(){if(!h)return;A=new(window.AudioContext||window.webkitAudioContext),I=A.createAnalyser(),I.fftSize=256,I.smoothingTimeConstant=.8,A.createMediaStreamSource(h).connect(I),L=setInterval(()=>{if(!I)return;const E=new Uint8Array(I.frequencyBinCount);I.getByteFrequencyData(E);const d=E.reduce((S,R)=>S+R,0)/E.length/255;se({audioLevel:d})},100)}async function x(f){return new Promise((E,ee)=>{u=new WebSocket(f),u.onopen=()=>{console.log("üì° Signaling connected"),E()},u.onmessage=async d=>{try{const S=JSON.parse(d.data);await M(S)}catch(S){console.error("‚ùå Failed to handle signaling message:",S)}},u.onerror=d=>{console.error("‚ùå Signaling error:",d),ee(d)},u.onclose=()=>{console.log("üì° Signaling disconnected"),n.autoReconnect&&D<n.maxReconnectAttempts&&N()}})}async function M(f){if(o)switch(f.type){case"offer":await T(f.offer);break;case"answer":await B(f.answer);break;case"ice-candidate":await X(f.candidate);break;default:console.warn("ü§∑ Unknown signaling message type:",f.type)}}async function T(f){if(!o)return;await o.setRemoteDescription(f);const E=await o.createAnswer();await o.setLocalDescription(E),F({type:"answer",answer:E})}async function B(f){o&&await o.setRemoteDescription(f)}async function X(f){o&&await o.addIceCandidate(f)}function F(f){u&&u.readyState===WebSocket.OPEN&&u.send(JSON.stringify(f))}function N(){W||(C("reconnecting"),W=setTimeout(async()=>{if(W=null,D>=n.maxReconnectAttempts){C("failed");return}D++,console.log(`üîÑ Reconnection attempt ${D}/${n.maxReconnectAttempts}`);try{await re(),await U(K)}catch(f){console.error("‚ùå Reconnection failed:",f),N()}},n.reconnectInterval))}async function U(f){K=f,C("connecting");try{await c(),o=await _(),await x(f),ae()}catch(E){throw console.error("‚ùå Failed to connect WebRTC:",E),C("failed"),E}}async function re(){C("disconnected"),W&&(clearTimeout(W),W=null),L&&(clearInterval(L),L=null),A&&A.state!=="closed"&&(await A.close(),A=null),h&&(h.getTracks().forEach(f=>f.stop()),h=null),o&&(o.close(),o=null),u&&(u.close(),u=null),I=null}function ae(){o&&setInterval(async()=>{if(!(!o||o.connectionState!=="connected"))try{const f=await o.getStats();let E=0,ee=0,d=0,S=0;f.forEach(r=>{if(r.type==="remote-inbound-rtp"&&r.kind==="audio"&&(E=r.roundTripTime||0,ee=r.packetsLost||0,d=r.packetsReceived||0),r.type==="inbound-rtp"&&r.kind==="audio"){const w=r.bytesReceived||0,m=r.timestamp||0;S=w*8/1e3}});const R=d>0?ee/(ee+d)*100:0;se({latency:E*1e3,packetLoss:R,bitrate:S})}catch(f){console.warn("‚ö†Ô∏è Failed to get WebRTC stats:",f)}},1e3)}async function le(f){const E=Te(l).connectionState==="connected",ee=K;try{const S=`${ee.split("/").slice(0,-1).join("/")}/${f}`;E&&await re(),await U(S)}catch(d){if(console.error("‚ùå Failed to switch provider:",d),E)try{await U(ee)}catch(S){console.error("‚ùå Failed to reconnect to previous provider:",S)}throw d}}function Z(f){h&&h.getAudioTracks().forEach(E=>{E.enabled=!f})}function ce(f){console.log("üéµ Audio chunk received (WebRTC handles streaming automatically)")}async function V(){try{return q=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always",displaySurface:"monitor"},audio:!1}),Y=q.getVideoTracks()[0],Y.onended=()=>{de(),console.log("üñ•Ô∏è Screen share stopped by user")},o&&o.addTrack(Y,q),console.log("üñ•Ô∏è Screen sharing started"),q}catch(f){throw console.error("‚ùå Failed to start screen share:",f),new Error("Screen sharing denied or not supported")}}function de(){Y&&(Y.stop(),Y=null),q&&(q.getTracks().forEach(f=>f.stop()),q=null),console.log("üñ•Ô∏è Screen sharing stopped")}function $(){return q}function pe(){return q!==null&&Y?.readyState==="live"}async function ie(){de(),await re(),await H.cleanup()}return{subscribe:l.subscribe,connect:U,disconnect:re,switchProvider:le,getConnectionState(){return Te(l).connectionState},async getStats(){return o?await o.getStats():null},muteAudio:Z,sendAudioChunk:ce,startScreenShare:V,stopScreenShare:de,getScreenShareStream:$,isScreenSharing:pe,cleanup:ie}}var Ns=j('<span class="status-badge active svelte-1e8mw4j" aria-label="Screen sharing active"><span class="status-dot svelte-1e8mw4j"></span> Active</span>'),Os=j('<div class="error-message svelte-1e8mw4j" role="alert"><span class="error-icon svelte-1e8mw4j" aria-hidden="true">‚ö†Ô∏è</span> <span class="svelte-1e8mw4j"> </span></div>'),Ws=j('<div class="start-view svelte-1e8mw4j"><p class="description svelte-1e8mw4j">Share your screen to collaborate with others in real-time.</p> <button class="share-button svelte-1e8mw4j" aria-label="Start screen sharing"><span class="button-icon svelte-1e8mw4j" aria-hidden="true">üñ•Ô∏è</span> Start Screen Share</button> <p class="note svelte-1e8mw4j"><strong class="svelte-1e8mw4j">Note:</strong> Requires HTTPS and a modern browser (Chrome, Firefox, Edge, Safari).</p></div>'),Us=j('<div class="sharing-active svelte-1e8mw4j"><div class="video-container svelte-1e8mw4j"><video autoplay class="screen-preview svelte-1e8mw4j" aria-label="Screen share preview"></video></div> <button class="stop-button svelte-1e8mw4j" aria-label="Stop screen sharing"><span class="button-icon svelte-1e8mw4j" aria-hidden="true">‚èπÔ∏è</span> Stop Sharing</button></div>',2),zs=j('<div class="screen-share-container svelte-1e8mw4j" role="region" aria-label="Screen sharing controls"><div class="header svelte-1e8mw4j"><h3 class="title svelte-1e8mw4j">Screen Share</h3> <!></div> <!> <!></div>');function Js(P,s){Re(s,!0);const n=Fs();let l=ne(!1),o=ne(null),h,u=ne(null);async function H(){try{g(u,null),g(o,await n.startScreenShare(),!0),g(l,!0),h&&a(o)&&(h.srcObject=a(o))}catch(_){console.error("Failed to start screen sharing:",_),g(u,_ instanceof Error?_.message:"Screen sharing not available or denied",!0),g(l,!1),g(o,null)}}function A(){n.stopScreenShare(),g(l,!1),g(o,null),g(u,null),h&&(h.srcObject=null)}Ve(()=>{a(l)&&A()});var I=zs(),L=t(I),q=i(t(L),2);{var Y=_=>{var c=Ns();b(_,c)};O(q,_=>{a(l)&&_(Y)})}e(L);var D=i(L,2);{var W=_=>{var c=Os(),p=i(t(c),2),x=t(p,!0);e(p),e(c),ve(()=>k(x,a(u))),b(_,c)};O(D,_=>{a(u)&&_(W)})}var K=i(D,2);{var se=_=>{var c=Ws(),p=i(t(c),2);p.__click=H,ue(2),e(c),b(_,c)},C=_=>{var c=Us(),p=t(c),x=t(p);x.muted=!0,Ut(x,T=>h=T,()=>h),e(p);var M=i(p,2);M.__click=A,e(c),b(_,c)};O(K,_=>{a(l)?_(C,!1):_(se)})}e(I),b(P,I),Me()}$e(["click"]);class Bs{ws=null;sessionId;callbacks;options;status;isIntentionallyClosed=!1;reconnectTimer=null;heartbeatTimer=null;healthCheckTimer=null;pingStartTime=0;missedHeartbeats=0;latencyHistory=[];maxLatencyHistory=10;consecutiveFailures=0;constructor(s,n,l={}){this.sessionId=s,this.callbacks=n,this.options={url:this.getDefaultUrl(),protocols:[],heartbeatInterval:3e4,heartbeatTimeout:5e3,maxMissedHeartbeats:3,maxReconnectAttempts:10,initialReconnectDelay:1e3,maxReconnectDelay:3e4,reconnectBackoffFactor:2,jitterFactor:.1,latencyThresholds:{excellent:50,good:150,fair:300,poor:1e3},unhealthyThreshold:3,healthCheckInterval:1e4,...l},this.status={state:"disconnected",metrics:{connectedAt:null,lastPingAt:null,lastPongAt:null,reconnectAttempts:0,totalDisconnections:0,averageLatency:0,connectionQuality:"disconnected"},isHealthy:!1}}getDefaultUrl(){const s=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.hostname;return`${s}//${n}:8000/ws/${this.sessionId}`}connect(){if(this.ws?.readyState===WebSocket.OPEN||this.ws?.readyState===WebSocket.CONNECTING){console.warn("WebSocket already connected or connecting");return}this.updateStatus("connecting"),this.callbacks.onConnecting?.();try{console.log(`Connecting to enhanced WebSocket: ${this.options.url}`),this.ws=new WebSocket(this.options.url,this.options.protocols),this.setupEventHandlers()}catch(s){console.error("Failed to create WebSocket:",s),this.handleError(s)}}setupEventHandlers(){this.ws&&(this.ws.onopen=s=>{console.log("Enhanced WebSocket connected"),this.status.metrics.connectedAt=Date.now(),this.status.metrics.reconnectAttempts=0,this.consecutiveFailures=0,this.missedHeartbeats=0,this.updateStatus("connected"),this.startHeartbeat(),this.startHealthCheck(),this.callbacks.onConnected?.(this.getStatus())},this.ws.onmessage=s=>{try{if(this.handleHeartbeatResponse(s.data))return;if(s.data instanceof ArrayBuffer)this.callbacks.onBinaryMessage?.(s.data);else{const n=JSON.parse(s.data);this.callbacks.onMessage?.(n)}this.consecutiveFailures=0}catch(n){console.error("Failed to parse WebSocket message:",n),this.consecutiveFailures++}},this.ws.onerror=s=>{console.error("Enhanced WebSocket error:",s),this.handleError(new Error("WebSocket connection error"))},this.ws.onclose=s=>{console.log("Enhanced WebSocket closed:",s.code,s.reason),this.stopHeartbeat(),this.stopHealthCheck(),this.status.metrics.totalDisconnections++,this.updateStatus("disconnected"),this.callbacks.onDisconnected?.(this.getStatus()),this.isIntentionallyClosed||this.attemptReconnection()})}handleHeartbeatResponse(s){if(typeof s!="string")return!1;try{if(JSON.parse(s).type==="pong"){const l=Date.now()-this.pingStartTime;return this.recordLatency(l),this.status.metrics.lastPongAt=Date.now(),this.missedHeartbeats=0,this.callbacks.onHeartbeat?.(l),!0}}catch{}return!1}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=window.setInterval(()=>{if(this.ws?.readyState===WebSocket.OPEN){this.pingStartTime=Date.now(),this.status.metrics.lastPingAt=this.pingStartTime;try{this.ws.send(JSON.stringify({type:"ping",timestamp:this.pingStartTime})),setTimeout(()=>{this.status.metrics.lastPongAt&&this.status.metrics.lastPongAt<this.pingStartTime&&(this.missedHeartbeats++,this.missedHeartbeats>=this.options.maxMissedHeartbeats&&(console.warn("Too many missed heartbeats, closing connection"),this.ws?.close(1e3,"Missed heartbeats")))},this.options.heartbeatTimeout)}catch(s){console.error("Failed to send heartbeat:",s),this.consecutiveFailures++}}},this.options.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}startHealthCheck(){this.stopHealthCheck(),this.healthCheckTimer=window.setInterval(()=>{this.updateConnectionQuality(),this.isHealthy()||this.callbacks.onUnhealthyConnection?.(this.getStatus())},this.options.healthCheckInterval)}stopHealthCheck(){this.healthCheckTimer&&(clearInterval(this.healthCheckTimer),this.healthCheckTimer=null)}recordLatency(s){this.latencyHistory.push(s),this.latencyHistory.length>this.maxLatencyHistory&&this.latencyHistory.shift(),this.status.metrics.averageLatency=this.latencyHistory.reduce((n,l)=>n+l,0)/this.latencyHistory.length}updateConnectionQuality(){const{averageLatency:s}=this.status.metrics,{excellent:n,good:l,fair:o,poor:h}=this.options.latencyThresholds;let u;s<=n?u="excellent":s<=l?u="good":s<=o?u="fair":s<=h?u="poor":u="disconnected",u!==this.status.metrics.connectionQuality&&(this.status.metrics.connectionQuality=u,this.callbacks.onConnectionQualityChange?.(u))}attemptReconnection(){if(this.status.metrics.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.updateStatus("error");return}this.status.metrics.reconnectAttempts++,this.updateStatus("reconnecting");const s=Math.min(this.options.initialReconnectDelay*Math.pow(this.options.reconnectBackoffFactor,this.status.metrics.reconnectAttempts-1),this.options.maxReconnectDelay),n=s*this.options.jitterFactor*Math.random(),l=s+n;console.log(`Reconnecting in ${Math.round(l)}ms (attempt ${this.status.metrics.reconnectAttempts}/${this.options.maxReconnectAttempts})`),this.callbacks.onReconnecting?.(this.status.metrics.reconnectAttempts,this.options.maxReconnectAttempts),this.reconnectTimer=window.setTimeout(()=>{this.connect()},l)}handleError(s){this.consecutiveFailures++,this.updateStatus("error"),this.callbacks.onError?.(s,this.getStatus())}updateStatus(s){this.status.state=s,this.status.isHealthy=this.isHealthy()}isHealthy(){return this.status.state==="connected"&&this.consecutiveFailures<this.options.unhealthyThreshold&&this.missedHeartbeats<this.options.maxMissedHeartbeats&&this.status.metrics.connectionQuality!=="disconnected"}getStatus(){return{...this.status}}send(s){if(this.ws?.readyState===WebSocket.OPEN)try{return this.ws.send(s),!0}catch(n){return console.error("Failed to send message:",n),this.consecutiveFailures++,!1}return!1}sendJSON(s){return this.send(JSON.stringify(s))}analyzeSentiment(s,n){this.sendJSON({type:"sentiment",text:s,speaker:n})}requestAssistance(s,n={}){this.sendJSON({type:"assistance",transcript:s,context:n})}sendTranscription(s,n,l=1,o=!0){this.sendJSON({type:"transcription",text:s,speaker:n,confidence:l,is_final:o})}isConnected(){return this.ws?.readyState===WebSocket.OPEN&&this.status.state==="connected"}disconnect(){this.isIntentionallyClosed=!0,this.updateStatus("disconnecting"),this.callbacks.onDisconnecting?.(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopHeartbeat(),this.stopHealthCheck(),this.ws&&(this.ws.close(1e3,"Intentionally closed"),this.ws=null),this.updateStatus("disconnected")}}function Qs(P,s,n){const l=new Bs(P,s,n);return l.connect(),l}const Xe="http://localhost:8000";async function Gs(P,s){const n=await fetch(`${Xe}/ai/transcription/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:P,config:s})});if(!n.ok)throw new Error(`Failed to start transcription: ${n.statusText}`)}async function Vs(P,s){const n=await fetch(`${Xe}/ai/assistance/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:P,config:s})});if(!n.ok)throw new Error(`Failed to start assistance: ${n.statusText}`)}async function $s(P,s){const n=await fetch(`${Xe}/ai/sentiment/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:P,config:s})});if(!n.ok)throw new Error(`Failed to start sentiment analysis: ${n.statusText}`)}async function Ys(P){const s=await fetch(`${Xe}/ai/sentiment/trend/${P}`);if(!s.ok)throw new Error(`Failed to get sentiment trend: ${s.statusText}`);return s.json()}var Ks=j('<div class="info-grid svelte-e2j4"><div class="info-item svelte-e2j4"><span class="info-label svelte-e2j4">Session ID:</span> <span class="info-value svelte-e2j4"> </span></div> <div class="info-item svelte-e2j4"><span class="info-label svelte-e2j4">Status:</span> <span> </span></div> <div class="info-item svelte-e2j4"><span class="info-label svelte-e2j4">Provider:</span> <span class="info-value svelte-e2j4"> </span></div></div>'),Xs=j('<p class="no-session svelte-e2j4">No active session</p>'),Zs=j('<div class="agent-workspace svelte-e2j4"><div class="top-bar svelte-e2j4"><div class="call-controls-container svelte-e2j4"><!></div> <div class="provider-selector-container svelte-e2j4"><!></div> <div class="connection-status-container svelte-e2j4"><!></div></div> <div class="main-content svelte-e2j4"><div class="left-panel svelte-e2j4"><div class="customer-info svelte-e2j4"><h3 class="section-title svelte-e2j4">Customer Information</h3> <!></div> <div class="transcription-container svelte-e2j4"><h3 class="section-title svelte-e2j4">Live Transcription</h3> <!></div></div> <div class="right-panel svelte-e2j4"><div class="sentiment-container svelte-e2j4"><!></div> <div class="screen-share-wrapper svelte-e2j4"><!></div> <div class="assistance-container svelte-e2j4"><!></div></div></div></div>');function ea(P,s){Re(s,!0);let n=we(s,"session",15,null),l=we(s,"onRetryConnection",7);l()||l(async()=>{});const o=Ss();let h=ne(We([])),u=ne(null),H=ne(null),A=ne(We([])),I=null,L=ne(!1),q=ne("idle");const Y=he(()=>()=>a(h).map(r=>({role:r.speaker==="customer"?"user":"assistant",content:r.text,timestamp:new Date(r.timestamp)})));function D(r){switch(r){case"connecting":return"connecting";case"connected":return"active";case"error":return"error";case"disconnected":return"ended";default:return"idle"}}ft(()=>{o.restoreState();const r=Te(o);return g(q,r.call?.status??"idle",!0),()=>{o.saveState()}}),Oe(()=>{const r=n();if(!r){g(q,"idle"),o.updateCallState({status:"idle"}),o.saveState();return}const w=D(r.status),m=Te(o),G=r.sessionId??m.call?.id??"";g(q,w,!0),o.updateProvider(r.provider),o.updateCallState({id:G,status:w,provider:r.provider,metadata:{lastEvent:r.lastEvent,lastEventAt:r.lastEventAt}}),r.error&&o.addError({code:"provider_session_error",message:r.error,recoverable:!0}),o.saveState()}),Oe(()=>{const r=n();r&&r.status==="connected"&&r.sessionId&&!a(L)?(W(r.sessionId),g(L,!0)):(!r||r.status!=="connected")&&a(L)&&(K(),g(L,!1))});async function W(r){console.log("ü§ñ Initializing AI services for session:",r);try{await Gs(r,{language:"en",enable_interim_results:!0,enable_speaker_detection:!0,enable_punctuation:!0}),await $s(r,{enable_real_time:!0,enable_emotions:!0,alert_on_negative:!0,negative_threshold:-.5,track_trends:!0}),await Vs(r,{enable_suggestions:!0,enable_knowledge_base:!0,enable_compliance:!0,enable_coaching:!0,suggestion_threshold:.6,max_suggestions:3}),I=Qs(r,{onMessage:m=>{m.type==="transcription"?se(m.data):m.type==="sentiment"?C(m.data):m.type==="assistance"&&_(m.data)},onConnecting:()=>console.log("üîÑ Connecting to enhanced AI WebSocket..."),onConnected:m=>console.log("‚úÖ Enhanced AI WebSocket connected with quality:",m.metrics.connectionQuality),onDisconnecting:()=>console.log("üîÑ Disconnecting enhanced AI WebSocket..."),onDisconnected:m=>console.log("üîå Enhanced AI WebSocket disconnected"),onReconnecting:(m,G)=>console.log(`üîÑ Enhanced AI WebSocket reconnecting ${m}/${G}`),onError:m=>console.error("‚ùå Enhanced AI WebSocket error:",m),onHeartbeat:m=>console.log(`üíì Enhanced AI WebSocket heartbeat: ${m}ms`),onConnectionQualityChange:m=>console.log("üìä Enhanced AI WebSocket quality changed to:",m),onUnhealthyConnection:m=>console.warn("‚ö†Ô∏è Enhanced AI WebSocket connection unhealthy:",m)},{heartbeatInterval:15e3,maxReconnectAttempts:5,initialReconnectDelay:1e3,maxReconnectDelay:1e4}),o.updateCallState({status:"active",metadata:{aiServices:"initialized"}}),o.saveState(),g(q,"active"),console.log("‚úÖ AI services initialized successfully")}catch(w){console.error("‚ùå Failed to initialize AI services:",w),o.addError({code:"ai_initialization_failed",message:w instanceof Error?w.message:"Failed to initialize AI services",recoverable:!0}),o.saveState(),g(q,"error")}}function K(){console.log("üõë Shutting down AI services"),I&&(I.disconnect(),I=null),g(h,[],!0),g(u,null),g(H,null),g(A,[],!0),o.updateCallState({status:"ended",metadata:{aiServices:"stopped"}}),o.saveState(),g(q,"ended")}function se(r){console.log("üìù Transcription received:",r.text);const w=a(h).findIndex(m=>m.id===r.id);w>=0?a(h)[w]=r:g(h,[...a(h),r],!0),r.is_final&&I&&I.analyzeSentiment(r.text,r.speaker),a(h).length>100&&g(h,a(h).slice(-100),!0)}async function C(r){if(console.log("üòä Sentiment received:",r.sentiment,r.polarity_score),g(u,r,!0),n()?.sessionId)try{g(H,await Ys(n().sessionId),!0)}catch(w){console.error("Failed to fetch sentiment trend:",w)}if(r.polarity_score<-.3&&I&&a(h).length>0){const w=a(h).filter(m=>m.is_final).map(m=>`${m.speaker.toUpperCase()}: ${m.text}`).join(`
`);I.requestAssistance(w,{customer_sentiment:r.sentiment,polarity:r.polarity_score})}}function _(r){console.log("üí° Assistance received:",r.length,"suggestions"),g(A,r,!0)}function c(r){console.log("‚úì Using suggestion:",r.title),g(A,a(A).filter(w=>w.id!==r.id),!0)}function p(r){console.log("‚úï Dismissing suggestion:",r),g(A,a(A).filter(w=>w.id!==r),!0)}async function x(){try{o.clearErrors(),o.updateCallState({status:"connecting"}),o.saveState(),g(q,"connecting"),await l()?.()}catch(r){o.addError({code:"retry_failed",message:r instanceof Error?r.message:"Failed to retry connection",recoverable:!0}),o.saveState(),g(q,"error")}}Ve(()=>{K(),o.saveState()}),Oe(()=>{const r=n();if(!r){g(q,"idle"),o.updateCallState({status:"idle"}),o.saveState();return}const w=D(r.status),m=Te(o),G=r.sessionId??m.call?.id??"";g(q,w,!0),o.updateProvider(r.provider),o.updateCallState({id:G,status:w,provider:r.provider,metadata:{lastEvent:r.lastEvent,lastEventAt:r.lastEventAt}}),r.error&&o.addError({code:"provider_session_error",message:r.error,recoverable:!0}),o.saveState()});var M=Zs(),T=t(M),B=t(T),X=t(B);Xt(X,{get onEndCall(){return s.onEndCall},get onMute(){return s.onMute},get onHold(){return s.onHold},get onTransfer(){return s.onTransfer},get session(){return n()},set session(r){n(r)}}),e(B);var F=i(B,2),N=t(F);Lt(N,{}),e(F);var U=i(F,2),re=t(U);{let r=he(()=>a(q)==="active"),w=he(()=>n()?.provider??"unknown");Hs(re,{get isLive(){return a(r)},get currentProvider(){return a(w)},onRetry:x})}e(U),e(T);var ae=i(T,2),le=t(ae),Z=t(le),ce=i(t(Z),2);{var V=r=>{var w=Ks(),m=t(w),G=i(t(m),2),v=t(G,!0);e(G),e(m);var y=i(m,2),Q=i(t(y),2);let te;var oe=t(Q,!0);e(Q),e(y);var ye=i(y,2),ke=i(t(ye),2),qe=t(ke,!0);e(ke),e(ye),e(w),ve(()=>{k(v,n().sessionId),te=xe(Q,1,"info-value status svelte-e2j4",null,te,{active:a(q)==="active"}),k(oe,a(q)),k(qe,n().provider)}),b(r,w)},de=r=>{var w=Xs();b(r,w)};O(ce,r=>{n()?r(V):r(de,!1)})}e(Z);var $=i(Z,2),pe=i(t($),2);{let r=he(()=>a(Y)());_s(pe,{get segments(){return a(r)}})}e($),e(le);var ie=i(le,2),f=t(ie),E=t(f);rs(E,{get sentiment(){return a(u)},get trend(){return a(H)}}),e(f);var ee=i(f,2),d=t(ee);Js(d,{}),e(ee);var S=i(ee,2),R=t(S);ps(R,{get suggestions(){return a(A)},onUseSuggestion:c,onDismissSuggestion:p}),e(S),e(ie),e(ae),e(M),b(P,M),Me()}var ta=j('<button class="btn btn-primary btn-lg svelte-47l5b6"><!> Start Demo Call</button>'),sa=j('<button class="btn btn-danger btn-lg svelte-47l5b6"><!> End Call</button>'),aa=j('<div class="alert alert-error svelte-47l5b6"> </div>'),na=j('<article class="instructions-card svelte-47l5b6"><h3 class="instructions-title svelte-47l5b6">Getting Started</h3> <div class="instructions-list svelte-47l5b6"><div class="instruction-item svelte-47l5b6"><span class="instruction-number svelte-47l5b6">1</span> <div class="svelte-47l5b6"><p class="instruction-text svelte-47l5b6">Click "Start Demo Call" to begin a test session</p> <p class="instruction-hint svelte-47l5b6">This will connect to the AI provider and start your microphone</p></div></div> <div class="instruction-item svelte-47l5b6"><span class="instruction-number svelte-47l5b6">2</span> <div class="svelte-47l5b6"><p class="instruction-text svelte-47l5b6">Speak naturally to interact with the AI</p> <p class="instruction-hint svelte-47l5b6">Real-time transcription and sentiment analysis will appear automatically</p></div></div> <div class="instruction-item svelte-47l5b6"><span class="instruction-number svelte-47l5b6">3</span> <div class="svelte-47l5b6"><p class="instruction-text svelte-47l5b6">Watch for AI assistance suggestions</p> <p class="instruction-hint svelte-47l5b6">Suggested responses, compliance warnings, and coaching tips will appear as you speak</p></div></div></div></article>'),ra=j('<section class="agent-operations-page svelte-47l5b6"><header class="page-header svelte-47l5b6"><div class="svelte-47l5b6"><h1 class="page-title svelte-47l5b6">AI Agent Workspace</h1> <p class="page-description svelte-47l5b6">Production-ready agent interface with real-time AI assistance, sentiment analysis, and live transcription.</p></div> <div class="header-actions svelte-47l5b6"><!></div></header> <!> <div class="status-bar svelte-47l5b6"><div class="status-item svelte-47l5b6"><!> <span class="svelte-47l5b6">Session: <strong class="svelte-47l5b6"> </strong></span></div> <div class="status-item svelte-47l5b6"><!> <span class="svelte-47l5b6">Audio: <strong class="svelte-47l5b6"> </strong></span></div> <div class="status-item svelte-47l5b6"><span></span> <span class="svelte-47l5b6">Call: <strong class="svelte-47l5b6"> </strong></span></div></div> <div class="workspace-container svelte-47l5b6"><!></div> <!></section>');function Fa(P,s){Re(s,!0);const n=Pt({provider:"gemini"});let l=ne(We(n.getState()));const o=n.subscribe(v=>{g(l,v,!0)}),h=yt();let u=ne(We(h.getState()));const H=h.subscribe(v=>{g(u,v,!0)});let A=ne(!1),I=ne(!1),L=ne(null),q=ne(!1);h.sendCapturedFrame(v=>{if(a(l).status==="connected")try{const y=btoa(String.fromCharCode(...new Uint8Array(v.buffer)));n.send(JSON.stringify({type:"audio-data",audioData:y}))}catch(y){console.error("Failed to send captured audio frame",y)}}),Oe(()=>{if(a(A)&&a(l).status==="connected"&&!a(q)&&(n.send(JSON.stringify({type:"start-session",voice:"Puck",model:"gemini-2.0-flash-exp",language:"en",aiInstructions:"You are a helpful AI assistant for a call center. Provide professional and courteous support to callers.",company:{name:"Demo Company",phone:"+1234567890"}})),g(q,!0)),!a(l).lastEventAt)return;const v=a(l).lastEvent;if(v&&typeof v=="object"&&"type"in v){const y=v;y.type==="audio"&&y.audio&&h.playBase64Audio(y.audio,y.mimeType).catch(Q=>{console.error("Failed to play realtime audio chunk",Q)})}});async function Y(){if(g(L,null),a(u).status!=="recording"){const v=await h.startMicrophone();if(!v.success){g(L,v.error??"Unable to start microphone.",!0);return}}n.connect(),g(A,!0),g(q,!1)}function D(){n.disconnect(),h.stop(),g(A,!1),g(q,!1)}function W(v){g(I,v,!0),console.log(v?"Muted":"Unmuted")}function K(v){console.log(v?"On hold":"Resumed")}function se(){console.log("Transfer requested")}async function C(){n.connect(),a(A)&&g(q,!1)}Ve(()=>{n.disconnect(),h.cleanup(),o(),H()});var _=ra(),c=t(_),p=i(t(c),2),x=t(p);{var M=v=>{var y=ta();y.__click=Y;var Q=t(y);zt(Q,{class:"size-5"}),ue(),e(y),b(v,y)},T=v=>{var y=sa();y.__click=D;var Q=t(y);Jt(Q,{class:"size-5"}),ue(),e(y),b(v,y)};O(x,v=>{a(A)?v(T,!1):v(M)})}e(p),e(c);var B=i(c,2);{var X=v=>{var y=aa(),Q=t(y,!0);e(y),ve(()=>k(Q,a(L))),b(v,y)};O(B,v=>{a(L)&&v(X)})}var F=i(B,2),N=t(F),U=t(N);nt(U,{class:"size-4"});var re=i(U,2),ae=i(t(re)),le=t(ae,!0);e(ae),e(re),e(N);var Z=i(N,2),ce=t(Z);{var V=v=>{Bt(v,{class:"size-4 text-red-500"})},de=v=>{Qt(v,{class:"size-4 text-green-500"})};O(ce,v=>{a(I)?v(V):v(de,!1)})}var $=i(ce,2),pe=i(t($)),ie=t(pe,!0);e(pe),e($),e(Z);var f=i(Z,2),E=t(f);let ee;var d=i(E,2),S=i(t(d)),R=t(S,!0);e(S),e(d),e(f),e(F);var r=i(F,2),w=t(r);ea(w,{onEndCall:D,onMute:W,onHold:K,onTransfer:se,onRetryConnection:C,get session(){return a(l)},set session(v){g(l,v,!0)}}),e(r);var m=i(r,2);{var G=v=>{var y=na();b(v,y)};O(m,v=>{a(A)||v(G)})}e(_),ve(()=>{k(le,a(l).status),k(ie,a(u).status),ee=xe(E,1,"status-dot svelte-47l5b6",null,ee,{active:a(A)}),k(R,a(A)?"Active":"Inactive")}),b(P,_),Me()}$e(["click"]);export{Fa as component};
