import{f as g,a as _}from"../chunks/pFl1CK35.js";import"../chunks/CnJ-dsFT.js";import{o as vt}from"../chunks/0VtO9hYy.js";import{p as ut,e as o,t as J,c as pt,g as e,J as C,f as u,M as p,d as r,r as t,n as B,k as Oe,N as Y}from"../chunks/aQ_ifger.js";import{s as O}from"../chunks/DBuqHHqM.js";import{i as R}from"../chunks/BTxJJ6eU.js";import{e as xe,i as ye}from"../chunks/oqRKM5NY.js";import{r as w,b as Re}from"../chunks/BqAhscvM.js";import{s as bt}from"../chunks/DGR2HyJN.js";import{d as mt}from"../chunks/C918u5xm.js";import{b as x,a as ft}from"../chunks/CDxeFDgn.js";import{i as _t}from"../chunks/ft9JqUN4.js";import{g as gt}from"../chunks/CTjsJUPt.js";import{A as xt}from"../chunks/B8eVYxVA.js";import{S as yt}from"../chunks/DFpgVvj5.js";import{P as ht}from"../chunks/DxRKn0x_.js";import{M as wt}from"../chunks/N5dFV4YX.js";import{P as kt}from"../chunks/BqbmOBb5.js";import{T as Ie}from"../chunks/F1e28-8V.js";import{P as Nt}from"../chunks/W1CsE6Bq.js";var Tt=g('<div class="p-8 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-blue-600"></div> <p class="mt-2 text-gray-600">Loading flow...</p></div>'),Pt=g('<div class="text-center py-8"><!> <p class="text-gray-600">No nodes yet. Click "Add Node" to start building your flow.</p></div>'),Ft=g('<div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors"><div class="flex items-center justify-between"><div class="flex items-center gap-3 flex-1"><span> </span> <div class="flex-1"><div class="font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div></div> <div class="flex items-center gap-2"><button class="p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors" title="Edit"><!></button> <button class="p-2 text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete"><!></button></div></div></div>'),Mt=g('<div class="space-y-3"></div>'),St=g("<option> </option>"),Ct=g('<div class="flex gap-2 items-start"><input type="text" placeholder="Key (0-9,*,#)" maxlength="1" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"/> <select class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"><option>Navigate</option><option>Transfer</option><option>Voicemail</option><option>End Call</option></select> <button class="p-1 text-red-600 hover:bg-red-50 rounded"><!></button></div>'),Et=g('<div><div class="flex items-center justify-between mb-2"><label class="block text-sm font-medium text-gray-700">Menu Options</label> <button class="text-sm text-blue-600 hover:text-blue-700">+ Add Option</button></div> <div class="space-y-2"></div></div>'),jt=g('<div><label class="block text-sm font-medium text-gray-700 mb-1">Transfer Destination</label> <input type="text" placeholder="+1234567890 or agent_id" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div>'),At=g('<div><label class="block text-sm font-medium text-gray-700 mb-1">Webhook URL</label> <input type="url" placeholder="https://api.example.com/webhook" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div>'),Ot=g('<div class="bg-white rounded-lg border border-gray-200 p-6 sticky top-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Edit Node</h2> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Node Type</label> <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Node Name</label> <input type="text" placeholder="e.g., Welcome Message" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Prompt Text</label> <textarea placeholder="What to say to the caller..." rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea></div> <!> <!> <!> <div class="grid grid-cols-2 gap-2"><div><label class="block text-sm font-medium text-gray-700 mb-1">Timeout (s)</label> <input type="number" min="5" max="300" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Max Retries</label> <input type="number" min="1" max="10" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div></div></div></div>'),Rt=g('<div class="bg-gray-50 rounded-lg border border-gray-200 p-6 text-center"><!> <p class="text-gray-600">Select a node to edit its properties</p></div>'),It=g('<div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="bg-white rounded-lg border border-gray-200 p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Flow Configuration</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Flow Name *</label> <input type="text" placeholder="e.g., Main Menu" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Description</label> <textarea placeholder="Describe the purpose of this IVR flow..." rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Timeout (seconds)</label> <input type="number" min="5" max="300" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Max Retries</label> <input type="number" min="1" max="10" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div class="flex items-center"><input type="checkbox" id="is_active" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/> <label for="is_active" class="ml-2 text-sm text-gray-700">Active (enable this flow)</label></div></div></div> <div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-gray-900">Flow Nodes</h2> <button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><!> Add Node</button></div> <!></div></div> <div class="lg:col-span-1"><!></div></div>'),Dt=g('<div class="p-6 max-w-7xl mx-auto"><div class="mb-6 flex items-center justify-between"><div class="flex items-center gap-4"><a href="/operations/ivr" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"><!></a> <div><h1 class="text-3xl font-bold text-gray-900"> </h1> <p class="text-gray-600">Design your interactive voice response flow</p></div></div> <button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors"><!> </button></div> <!></div>');function or(De,Ve){ut(Ve,!1);let f=C(null),n=C({name:"",description:"",team_id:1,is_active:!0,timeout_seconds:30,max_retries:3,entry_node_id:null}),y=C([]),a=C(null),G=C(!1),Z=C(!1),K=C(!1);const he=[{value:"menu",label:"Menu",description:"Present options to caller"},{value:"play",label:"Play Message",description:"Play audio message"},{value:"gather",label:"Gather Input",description:"Collect DTMF/speech input"},{value:"transfer",label:"Transfer",description:"Transfer to phone/agent"},{value:"voicemail",label:"Voicemail",description:"Send to voicemail"},{value:"webhook",label:"Webhook",description:"Call external API"},{value:"conditional",label:"Conditional",description:"Branch based on condition"},{value:"variable",label:"Set Variable",description:"Store value in variable"},{value:"end",label:"End Call",description:"Terminate the call"}];vt(async()=>{const d=new URLSearchParams(window.location.search).get("id");d&&(u(f,parseInt(d)),await Le())});async function Le(){if(e(f)){u(Z,!0);try{const i=await fetch(`http://localhost:8000/api/ivr/flows/${e(f)}`);if(!i.ok)throw new Error("Failed to load flow");const d=await i.json();u(n,d);const b=await fetch(`http://localhost:8000/api/ivr/flows/${e(f)}/nodes`);b.ok&&u(y,await b.json())}catch(i){alert(i instanceof Error?i.message:"Failed to load flow")}finally{u(Z,!1)}}}async function Ue(){if(!e(n).name.trim()){alert("Please enter a flow name");return}u(K,!0);try{const i=e(f)?"PUT":"POST",d=e(f)?`http://localhost:8000/api/ivr/flows/${e(f)}`:"http://localhost:8000/api/ivr/flows",b=await fetch(d,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(e(n))});if(!b.ok)throw new Error("Failed to save flow");const k=await b.json();e(f)||(u(f,k.id),p(n,e(n).id=k.id));for(const E of e(y))await We(E);alert("Flow saved successfully!"),gt("/operations/ivr")}catch(i){alert(i instanceof Error?i.message:"Failed to save flow")}finally{u(K,!1)}}async function We(i){if(!e(f))return;const d=i.id?"PUT":"POST",b=i.id?`http://localhost:8000/api/ivr/nodes/${i.id}`:"http://localhost:8000/api/ivr/nodes",k=await fetch(b,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,flow_id:e(f)})});if(!k.ok)throw new Error("Failed to save node");const E=await k.json();i.id||(i.id=E.id)}function Je(){const i={flow_id:e(f)||void 0,node_type:"menu",name:`Node ${e(y).length+1}`,prompt_text:"",audio_url:null,timeout_seconds:30,max_retries:3,next_node_id:null,menu_options:[],transfer_destination:null,variable_name:null,condition_expression:null,webhook_url:null};u(y,[...e(y),i]),u(a,i),u(G,!0)}function Be(i){u(a,i),u(G,!0)}function Ge(i){confirm("Are you sure you want to delete this node?")&&(u(y,e(y).filter((d,b)=>b!==i)),e(a)===e(y)[i]&&(u(a,null),u(G,!1)))}function Ke(){e(a)&&(e(a).menu_options||p(a,e(a).menu_options=[]),p(a,e(a).menu_options=[...e(a).menu_options,{key:"",action:"navigate",next_node_id:null,transfer_destination:null}]))}function $e(i){e(a)&&p(a,e(a).menu_options=e(a).menu_options.filter((d,b)=>b!==i))}function qe(i){return he.find(d=>d.value===i)?.label||i}function ze(i){return{menu:"bg-blue-100 border-blue-300 text-blue-800",play:"bg-green-100 border-green-300 text-green-800",gather:"bg-purple-100 border-purple-300 text-purple-800",transfer:"bg-orange-100 border-orange-300 text-orange-800",voicemail:"bg-yellow-100 border-yellow-300 text-yellow-800",webhook:"bg-pink-100 border-pink-300 text-pink-800",conditional:"bg-indigo-100 border-indigo-300 text-indigo-800",variable:"bg-teal-100 border-teal-300 text-teal-800",end:"bg-red-100 border-red-300 text-red-800"}[i]||"bg-gray-100 border-gray-300 text-gray-800"}_t();var ee=Dt(),te=r(ee),re=r(te),ae=r(re),He=r(ae);xt(He,{class:"w-5 h-5"}),t(ae);var we=o(ae,2),ke=r(we),Qe=r(ke,!0);t(ke),B(2),t(we),t(re);var $=o(re,2);$.__click=Ue;var Ne=r($);yt(Ne,{class:"w-4 h-4"});var Xe=o(Ne);t($),t(te);var Ye=o(te,2);{var Ze=i=>{var d=Tt();_(i,d)},et=i=>{var d=It(),b=r(d),k=r(b),E=o(r(k),2),oe=r(E),Te=o(r(oe),2);w(Te),t(oe);var ie=o(oe,2),Pe=o(r(ie),2);Oe(Pe),t(ie);var le=o(ie,2),Fe=o(r(le),2);w(Fe),t(le);var se=o(le,2),Me=o(r(se),2);w(Me),t(se);var Se=o(se,2),Ce=r(Se);w(Ce),B(2),t(Se),t(E),t(k);var Ee=o(k,2),ne=r(Ee),de=o(r(ne),2);de.__click=Je;var tt=r(de);ht(tt,{class:"w-4 h-4"}),B(),t(de),t(ne);var rt=o(ne,2);{var at=s=>{var m=Pt(),N=r(m);wt(N,{class:"w-12 h-12 text-gray-300 mx-auto mb-2"}),B(2),t(m),_(s,m)},ot=s=>{var m=Mt();xe(m,5,()=>e(y),ye,(N,h,I)=>{var P=Ft(),D=r(P),F=r(D),M=r(F),q=r(M,!0);t(M);var z=o(M,2),j=r(z),ce=r(j,!0);t(j);var V=o(j,2),ve=r(V,!0);t(V),t(z),t(F);var L=o(F,2),T=r(L);T.__click=()=>Be(e(h));var H=r(T);kt(H,{class:"w-4 h-4"}),t(T);var A=o(T,2);A.__click=()=>Ge(I);var Q=r(A);Ie(Q,{class:"w-4 h-4"}),t(A),t(L),t(D),t(P),J((l,c,v)=>{bt(M,1,`px-3 py-1 rounded-full border text-xs font-medium ${l??""}`),O(q,c),O(ce,e(h).name),O(ve,v)},[()=>ze(e(h).node_type),()=>qe(e(h).node_type),()=>e(h).prompt_text?e(h).prompt_text.substring(0,60)+"...":"No prompt text"]),_(N,P)}),t(m),_(s,m)};R(rt,s=>{e(y).length===0?s(at):s(ot,!1)})}t(Ee),t(b);var je=o(b,2),it=r(je);{var lt=s=>{var m=Ot(),N=o(r(m),2),h=r(N),I=o(r(h),2);J(()=>{e(a),Y(()=>{})}),xe(I,5,()=>he,ye,(l,c)=>{var v=St(),S=r(v,!0);t(v);var U={};J(()=>{O(S,e(c).label),U!==(U=e(c).value)&&(v.value=(v.__value=e(c).value)??"")}),_(l,v)}),t(I),t(h);var P=o(h,2),D=o(r(P),2);w(D),t(P);var F=o(P,2),M=o(r(F),2);Oe(M),t(F);var q=o(F,2);{var z=l=>{var c=Et(),v=r(c),S=o(r(v),2);S.__click=Ke,t(v);var U=o(v,2);xe(U,5,()=>e(a).menu_options||[],ye,(nt,W,dt)=>{var ue=Ct(),pe=r(ue);w(pe);var X=o(pe,2);J(()=>{e(W),Y(()=>{})});var be=r(X);be.value=be.__value="navigate";var me=o(be);me.value=me.__value="transfer";var fe=o(me);fe.value=fe.__value="voicemail";var Ae=o(fe);Ae.value=Ae.__value="end",t(X);var _e=o(X,2);_e.__click=()=>$e(dt);var ct=r(_e);Ie(ct,{class:"w-4 h-4"}),t(_e),t(ue),x(pe,()=>e(W).key,ge=>(e(W).key=ge,Y(()=>e(a)))),Re(X,()=>e(W).action,ge=>(e(W).action=ge,Y(()=>e(a)))),_(nt,ue)}),t(U),t(c),_(l,c)};R(q,l=>{e(a).node_type==="menu"&&l(z)})}var j=o(q,2);{var ce=l=>{var c=jt(),v=o(r(c),2);w(v),t(c),x(v,()=>e(a).transfer_destination,S=>p(a,e(a).transfer_destination=S)),_(l,c)};R(j,l=>{e(a).node_type==="transfer"&&l(ce)})}var V=o(j,2);{var ve=l=>{var c=At(),v=o(r(c),2);w(v),t(c),x(v,()=>e(a).webhook_url,S=>p(a,e(a).webhook_url=S)),_(l,c)};R(V,l=>{e(a).node_type==="webhook"&&l(ve)})}var L=o(V,2),T=r(L),H=o(r(T),2);w(H),t(T);var A=o(T,2),Q=o(r(A),2);w(Q),t(A),t(L),t(N),t(m),Re(I,()=>e(a).node_type,l=>p(a,e(a).node_type=l)),x(D,()=>e(a).name,l=>p(a,e(a).name=l)),x(M,()=>e(a).prompt_text,l=>p(a,e(a).prompt_text=l)),x(H,()=>e(a).timeout_seconds,l=>p(a,e(a).timeout_seconds=l)),x(Q,()=>e(a).max_retries,l=>p(a,e(a).max_retries=l)),_(s,m)},st=s=>{var m=Rt(),N=r(m);Nt(N,{class:"w-12 h-12 text-gray-300 mx-auto mb-2"}),B(2),t(m),_(s,m)};R(it,s=>{e(G)&&e(a)?s(lt):s(st,!1)})}t(je),t(d),x(Te,()=>e(n).name,s=>p(n,e(n).name=s)),x(Pe,()=>e(n).description,s=>p(n,e(n).description=s)),x(Fe,()=>e(n).timeout_seconds,s=>p(n,e(n).timeout_seconds=s)),x(Me,()=>e(n).max_retries,s=>p(n,e(n).max_retries=s)),ft(Ce,()=>e(n).is_active,s=>p(n,e(n).is_active=s)),_(i,d)};R(Ye,i=>{e(Z)?i(Ze):i(et,!1)})}t(ee),J(()=>{O(Qe,e(f)?"Edit IVR Flow":"Create IVR Flow"),$.disabled=e(K),O(Xe,` ${e(K)?"Saving...":"Save Flow"}`)}),_(De,ee),pt()}mt(["click"]);export{or as component};
