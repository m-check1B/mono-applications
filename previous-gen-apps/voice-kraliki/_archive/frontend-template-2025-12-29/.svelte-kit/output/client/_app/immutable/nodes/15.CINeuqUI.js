import{c as re,a as i,f as v}from"../chunks/pFl1CK35.js";import{o as Ke}from"../chunks/0VtO9hYy.js";import{h as ae,p as Qe,s as C,a as be,e as n,c as Ue,f as o,g as e,j as We,d as r,r as t,n as he,t as y}from"../chunks/aQ_ifger.js";import{s as f}from"../chunks/DBuqHHqM.js";import{i as x}from"../chunks/BTxJJ6eU.js";import{e as je,i as Re}from"../chunks/oqRKM5NY.js";import{a as Xe}from"../chunks/BqAhscvM.js";import{c as Ze,s as et}from"../chunks/DGR2HyJN.js";import{d as tt}from"../chunks/C918u5xm.js";import{s as rt,a as at}from"../chunks/BPSUqZ7R.js";import{g as st}from"../chunks/CTjsJUPt.js";import{p as nt}from"../chunks/ahVOO_2e.js";import{A as ot}from"../chunks/B8eVYxVA.js";import{R as Te}from"../chunks/DVBVNVSq.js";import{C as it}from"../chunks/CPLHLQIe.js";import{C as dt}from"../chunks/CCzAia_M.js";import"../chunks/CnJ-dsFT.js";import{s as lt}from"../chunks/DaxPoLM8.js";import{l as ct,s as vt}from"../chunks/DzqNI6-e.js";import{I as pt}from"../chunks/D7pKbUF5.js";function ut(se,K){const ne=ct(K,["children","$$slots","$$events","$$legacy"]);const oe=[["polygon",{points:"5 4 15 12 5 20 5 4"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19"}]];pt(se,vt({name:"skip-forward"},()=>ne,{get iconNode(){return oe},children:(ie,P)=>{var p=re(),S=ae(p);lt(S,K,"default",{}),i(ie,p)},$$slots:{default:!0}}))}var _t=v('<p class="text-[10px] font-bold uppercase tracking-[0.2em] text-muted-foreground mt-1"> <span> </span></p>'),ft=v('<div class="brutal-card p-12 text-center bg-void text-terminal-green"><div class="inline-block animate-spin h-10 w-10 border-4 border-terminal-green/30 border-t-terminal-green"></div> <p class="mt-4 font-bold uppercase tracking-widest animate-pulse">Loading Simulation...</p></div>'),mt=v('<div class="text-6xl font-display text-terminal-green mt-4"> </div>'),xt=v('<div class="p-6 bg-muted/10 border-2 border-muted mb-8"><pre class="whitespace-pre-wrap font-mono text-sm leading-relaxed"> </pre></div>'),gt=v('<span class="text-terminal-green ml-2"> </span>'),bt=v('<div class="flex items-start gap-3 text-sm"><span class="text-muted-foreground font-mono text-xs"></span> <span class="text-lg"> </span> <div class="flex-1"><span class="font-bold"> </span> <!></div></div>'),ht=v('<div class="mt-8 pt-8 border-t-2 border-muted"><h3 class="text-lg font-display uppercase tracking-tight mb-4">Your Journey</h3> <div class="space-y-3 max-h-64 overflow-y-auto"></div></div>'),yt=v('<div class="brutal-card p-8 border-terminal-green shadow-[6px_6px_0px_0px_rgba(51,255,0,1)]"><div class="text-center mb-8"><!> <h2 class="text-4xl font-display uppercase tracking-tight mb-2">Session Complete</h2> <!></div> <!> <div class="flex justify-center gap-4"><button class="brutal-btn bg-terminal-green text-void"><!> Try Again</button> <a href="/scenarios" class="brutal-btn bg-muted">Back to Scenarios</a></div> <!></div>'),wt=v('<div class="p-6 bg-muted/10 border-2 border-muted mb-6"><pre class="whitespace-pre-wrap font-mono text-lg leading-relaxed"> </pre></div>'),kt=v('<button class="brutal-btn w-full bg-terminal-green text-void text-lg py-4 group">Continue <!></button>'),$t=v('<button class="brutal-card w-full p-4 text-left hover:border-terminal-green hover:shadow-[4px_4px_0px_0px_rgba(51,255,0,1)] transition-all group"><div class="flex items-start gap-4"><span class="flex-shrink-0 w-8 h-8 border-2 border-foreground flex items-center justify-center font-bold group-hover:bg-terminal-green group-hover:text-void transition-colors"> </span> <span class="flex-1 font-mono text-sm leading-relaxed"> </span></div></button>'),Ct=v('<div class="space-y-3"><p class="text-xs font-bold uppercase text-muted-foreground tracking-widest mb-4">Choose your response:</p> <!></div>'),St=v('<div class="text-[10px] text-muted-foreground"><span class="uppercase font-bold tracking-wider">Previous:</span> </div>'),Nt=v('<div class="space-y-6"><div class="flex items-center gap-2 text-[10px] font-bold uppercase text-muted-foreground"><span class="px-2 py-0.5 bg-terminal-green text-void"> </span> <span> </span></div> <div class="brutal-card p-8 relative overflow-hidden"><div class="scanline opacity-5"></div> <div class="flex items-center gap-2 mb-6"><span class="text-2xl"> </span> <span class="px-2 py-0.5 border-2 border-foreground text-[10px] font-bold uppercase"> </span></div> <!> <!></div> <!></div>'),jt=v('<div class="brutal-card p-12 text-center"><!> <h2 class="text-2xl font-display uppercase">No Scenario Data</h2> <p class="text-muted-foreground mt-2">This scenario has no nodes defined.</p> <a class="mt-4 inline-block text-terminal-green font-bold uppercase text-sm hover:underline">Open in Builder</a></div>'),Rt=v('<div class="min-h-screen bg-grid-pattern"><div class="max-w-4xl mx-auto p-6"><header class="mb-8 flex items-center justify-between border-b-4 border-foreground pb-6"><div class="flex items-center gap-4"><a href="/scenarios" class="p-2 border-2 border-foreground hover:bg-terminal-green hover:text-void transition-all bg-card"><!></a> <div><h1 class="text-3xl font-display uppercase tracking-tighter">Practice <span class="text-terminal-green">Mode</span></h1> <!></div></div> <button class="brutal-btn py-2 px-4 text-sm bg-muted hover:bg-accent transition-colors" title="Restart Scenario"><!> Restart</button></header> <!></div></div>');function Ut(se,K){Qe(K,!0);const ne=()=>at(nt,"$page",oe),[oe,ie]=rt();let P=C(null),p=C(null),S=C(be([])),a=C(null),de=C(be({})),g=C(be([])),le=C(!0),D=C(!1),Q=C(null);const L=We(()=>new Map(e(S).map(s=>[s.id,s])));Ke(async()=>{const s=ne().url.searchParams.get("id");if(!s){st("/scenarios");return}o(P,parseInt(s),!0),await Me()});async function Me(){if(e(P)){o(le,!0);try{const[s,l]=await Promise.all([fetch(`/api/scenarios/${e(P)}`),fetch(`/api/scenarios/${e(P)}/nodes`)]);if(!s.ok)throw new Error("Failed to load scenario");o(p,await s.json(),!0),l.ok&&o(S,await l.json(),!0),e(p)?.entry_node_id&&e(L).has(e(p).entry_node_id)?(o(a,e(L).get(e(p).entry_node_id),!0),O()):e(S).length>0&&(o(a,e(S)[0],!0),O())}catch(s){console.error(s)}finally{o(le,!1)}}}function O(){if(e(a)){if(e(a).node_type==="setVariable")e(a).variable_name&&e(a).variable_value&&(e(de)[e(a).variable_name]=e(a).variable_value),A(e(a).next_node_id);else if(e(a).node_type==="conditional"){const l=(e(a).condition_expression||"").match(/(\w+)\s*==\s*['"]?(\w+)['"]?/);let T=!1;if(l){const[,w,z]=l;T=e(de)[w]===z}if(T)A(e(a).next_node_id);else{const w=e(a).options[0]?.next_node_id;A(w)}}else if(e(a).node_type==="goTo")A(e(a).next_node_id);else if(e(a).node_type==="end"){o(D,!0);const s=e(a).text_content?.match(/Score:\s*(\d+\/\d+)/i);s&&o(Q,s[1],!0)}}}function Pe(s){e(a)&&(o(g,[...e(g),{node:e(a),choice:s.label}],!0),A(s.next_node_id))}function Ae(){e(a)&&(o(g,[...e(g),{node:e(a)}],!0),A(e(a).next_node_id))}function A(s){if(s==null){o(D,!0);return}const l=e(L).get(s);if(!l){o(D,!0);return}o(a,l,!0),setTimeout(()=>O(),100)}function ye(){o(de,{},!0),o(g,[],!0),o(D,!1),o(Q,null),e(p)?.entry_node_id&&e(L).has(e(p).entry_node_id)?(o(a,e(L).get(e(p).entry_node_id),!0),O()):e(S).length>0&&(o(a,e(S)[0],!0),O())}function we(s){switch(s){case"statement":return"ðŸ’¬";case"question":return"â“";case"end":return"ðŸ";default:return"ðŸ“"}}function Ie(s){switch(s?.toLowerCase()){case"easy":return"text-terminal-green";case"medium":return"text-accent";case"hard":return"text-system-red";case"expert":return"text-cyan-data";default:return"text-muted-foreground"}}var ce=Rt(),ke=r(ce),ve=r(ke),pe=r(ve),ue=r(pe),qe=r(ue);ot(qe,{class:"w-5 h-5"}),t(ue);var $e=n(ue,2),Be=n(r($e),2);{var De=s=>{var l=_t(),T=r(l),w=n(T),z=r(w,!0);t(w),t(l),y(N=>{f(T,`${e(p).name??""} // ${e(p).category??""} // `),et(w,1,N),f(z,e(p).difficulty)},[()=>Ze(Ie(e(p).difficulty))]),i(s,l)};x(Be,s=>{e(p)&&s(De)})}t($e),t(pe);var _e=n(pe,2);_e.__click=ye;var Le=r(_e);Te(Le,{class:"w-4 h-4 inline mr-1"}),he(),t(_e),t(ve);var Oe=n(ve,2);{var ze=s=>{var l=ft();i(s,l)},Ee=s=>{var l=re(),T=ae(l);{var w=N=>{var I=yt(),E=r(I),U=r(E);it(U,{class:"w-16 h-16 mx-auto text-terminal-green mb-4"});var fe=n(U,4);{var j=u=>{var _=mt(),$=r(_,!0);t(_),y(()=>f($,e(Q))),i(u,_)};x(fe,u=>{e(Q)&&u(j)})}t(E);var b=n(E,2);{var R=u=>{var _=xt(),$=r(_),q=r($,!0);t($),t(_),y(()=>f(q,e(a).text_content)),i(u,_)};x(b,u=>{e(a)?.text_content&&u(R)})}var k=n(b,2),F=r(k);F.__click=ye;var W=r(F);Te(W,{class:"w-4 h-4 inline mr-2"}),he(),t(F),he(2),t(k);var me=n(k,2);{var J=u=>{var _=ht(),$=n(r(_),2);je($,21,()=>e(g),Re,(q,B,X)=>{var V=bt(),Z=r(V);Z.textContent=`${X+1}.`;var Y=n(Z,2),xe=r(Y,!0);t(Y);var ee=n(Y,2),G=r(ee),d=r(G,!0);t(G);var c=n(G,2);{var h=m=>{var M=gt(),H=r(M);t(M),y(()=>f(H,`â†’ ${e(B).choice??""}`)),i(m,M)};x(c,m=>{e(B).choice&&m(h)})}t(ee),t(V),y(m=>{f(xe,m),f(d,e(B).node.name)},[()=>we(e(B).node.node_type)]),i(q,V)}),t($),t(_),i(u,_)};x(me,u=>{e(g).length>0&&u(J)})}t(I),i(N,I)},z=N=>{var I=re(),E=ae(I);{var U=j=>{var b=Nt(),R=r(b),k=r(R),F=r(k);t(k);var W=n(k,2),me=r(W,!0);t(W),t(R);var J=n(R,2),u=n(r(J),2),_=r(u),$=r(_,!0);t(_);var q=n(_,2),B=r(q,!0);t(q),t(u);var X=n(u,2);{var V=d=>{var c=wt(),h=r(c),m=r(h,!0);t(h),t(c),y(()=>f(m,e(a).text_content)),i(d,c)};x(X,d=>{e(a).text_content&&d(V)})}var Z=n(X,2);{var Y=d=>{var c=kt();c.__click=Ae;var h=n(r(c));ut(h,{class:"w-5 h-5 inline ml-2 group-hover:translate-x-1 transition-transform"}),t(c),i(d,c)},xe=d=>{var c=re(),h=ae(c);{var m=M=>{var H=Ct(),Fe=n(r(H),2);je(Fe,17,()=>e(a).options,Re,(Je,Ce,Ve)=>{var te=$t();te.__click=()=>Pe(e(Ce));var Se=r(te),ge=r(Se),Ye=r(ge,!0);t(ge);var Ne=n(ge,2),Ge=r(Ne,!0);t(Ne),t(Se),t(te),y(He=>{f(Ye,He),f(Ge,e(Ce).label)},[()=>String.fromCharCode(65+Ve)]),i(Je,te)}),t(H),i(M,H)};x(h,M=>{e(a).node_type==="question"&&M(m)},!0)}i(d,c)};x(Z,d=>{e(a).node_type==="statement"?d(Y):d(xe,!1)})}t(J);var ee=n(J,2);{var G=d=>{var c=St(),h=n(r(c));t(c),y(m=>f(h,` ${m??""}`),[()=>e(g).slice(-3).map(m=>m.node.name).join(" â†’ ")]),i(d,c)};x(ee,d=>{e(g).length>0&&d(G)})}t(b),y(d=>{f(F,`Step ${e(g).length+1}`),f(me,e(a).name),f($,d),f(B,e(a).node_type)},[()=>we(e(a).node_type)]),i(j,b)},fe=j=>{var b=jt(),R=r(b);dt(R,{class:"w-16 h-16 mx-auto text-system-red mb-4"});var k=n(R,6);t(b),y(()=>Xe(k,"href",`/scenarios/builder?id=${e(P)??""}`)),i(j,b)};x(E,j=>{e(a)?j(U):j(fe,!1)},!0)}i(N,I)};x(T,N=>{e(D)?N(w):N(z,!1)},!0)}i(s,l)};x(Oe,s=>{e(le)?s(ze):s(Ee,!1)})}t(ke),t(ce),i(se,ce),Ue(),ie()}tt(["click"]);export{Ut as component};
