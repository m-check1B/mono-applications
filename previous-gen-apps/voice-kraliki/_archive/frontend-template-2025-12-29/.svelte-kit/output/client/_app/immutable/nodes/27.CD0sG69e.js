import{c as yt,a as p,f as w}from"../chunks/pFl1CK35.js";import"../chunks/CnJ-dsFT.js";import{o as Fe}from"../chunks/0VtO9hYy.js";import{h as mt,p as Ne,K as De,L as Ie,t as C,d as r,e as s,g as t,c as Oe,J as m,f as _,M as I,r as e,N as Vt,q as l,n as zt,j as Me,l as qe,O as Be}from"../chunks/aQ_ifger.js";import{s as d}from"../chunks/DBuqHHqM.js";import{i as ft}from"../chunks/BTxJJ6eU.js";import{e as Kt,i as Qt}from"../chunks/oqRKM5NY.js";import{b as Yt,r as Je,a as Ht}from"../chunks/BqAhscvM.js";import{s as bt,c as Ue}from"../chunks/DGR2HyJN.js";import{d as Ge}from"../chunks/C918u5xm.js";import{b as Ve}from"../chunks/CDxeFDgn.js";import{i as ze}from"../chunks/ft9JqUN4.js";import{G as j}from"../chunks/CxwkgPG0.js";import{P as Wt}from"../chunks/BumCI67k.js";import{s as Ke}from"../chunks/DaxPoLM8.js";import{l as Qe,s as Ye}from"../chunks/DzqNI6-e.js";import{I as He}from"../chunks/D7pKbUF5.js";import{S as We}from"../chunks/BztEPeEE.js";import{P as Xe}from"../chunks/DxRKn0x_.js";import{S as Ze}from"../chunks/DdJ5BR_D.js";import{T as tr}from"../chunks/F1e28-8V.js";function er(O,P){const k=Qe(P,["children","$$slots","$$events","$$legacy"]);const c=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];He(O,Ye({name:"arrow-up-down"},()=>k,{get iconNode(){return c},children:(E,L)=>{var u=yt(),g=mt(u);Ke(g,P,"default",{}),p(E,u)},$$slots:{default:!0}}))}var rr=w("<option> </option>"),ar=w('<div class="p-8 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-blue-600"></div> <p class="mt-2 text-gray-600">Loading routing rules...</p></div>'),sr=w('<div class="p-8 text-center"><p class="text-red-600"> </p> <button class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Retry</button></div>'),ir=w('<div class="p-8 text-center"><!> <p class="text-gray-600">No routing rules found</p> <a href="/operations/routing/builder" class="mt-4 inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Create Your First Rule</a></div>'),or=w('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium"> </span></div></td><td class="px-6 py-4"><div class="flex items-center"><!> <div><div class="text-sm font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"> </td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><div class="flex items-center gap-2"><button class="text-blue-600 hover:text-blue-900" title="Test Rule"><!></button> <a class="text-indigo-600 hover:text-indigo-900" title="Edit Rule"><!></a> <button><!></button> <button class="text-red-600 hover:text-red-900" title="Delete Rule"><!></button></div></td></tr>'),lr=w('<table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rule Name</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Strategy</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conditions</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Targets</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Updated</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table>'),nr=w('<div class="p-6 max-w-7xl mx-auto"><div class="mb-6"><h1 class="text-3xl font-bold text-gray-900 mb-2">Call Routing Rules</h1> <p class="text-gray-600">Configure intelligent call routing strategies to connect callers with the right agents</p></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"><div class="bg-white rounded-lg border border-gray-200 p-4"><div class="flex items-center justify-between"><div><p class="text-sm text-gray-600">Total Rules</p> <p class="text-2xl font-bold text-gray-900"> </p></div> <!></div></div> <div class="bg-white rounded-lg border border-gray-200 p-4"><div class="flex items-center justify-between"><div><p class="text-sm text-gray-600">Active Rules</p> <p class="text-2xl font-bold text-green-600"> </p></div> <!></div></div> <div class="bg-white rounded-lg border border-gray-200 p-4"><div class="flex items-center justify-between"><div><p class="text-sm text-gray-600">Inactive Rules</p> <p class="text-2xl font-bold text-gray-600"> </p></div> <!></div></div> <div class="bg-white rounded-lg border border-gray-200 p-4"><div class="flex items-center justify-between"><div><p class="text-sm text-gray-600">Avg Priority</p> <p class="text-2xl font-bold text-blue-600"> </p></div> <!></div></div></div> <div class="bg-white rounded-lg border border-gray-200 p-4 mb-4"><div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1"><!> <input type="text" placeholder="Search rules..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Status</option><option>Active</option><option>Inactive</option></select> <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Strategies</option><!></select></div> <a href="/operations/routing/builder" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><!> Create Rule</a></div></div> <div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><!></div></div>');function jr(O,P){Ne(P,!1);const k=m();let c=m([]),E=m(!0),L=m(null),u=m(""),g=m("all"),S=m("all"),n=m({total_rules:0,active_rules:0,inactive_rules:0,avg_priority:0});const ht={skill_based:"Skill-Based",least_busy:"Least Busy",longest_idle:"Longest Idle",round_robin:"Round Robin",priority:"Priority",language:"Language",vip:"VIP",custom:"Custom"};Fe(async()=>{await T()});async function T(){_(E,!0),_(L,null);try{const a=await fetch("http://localhost:8000/api/routing/rules");if(!a.ok)throw new Error("Failed to load routing rules");_(c,await a.json()),Xt()}catch(a){_(L,a instanceof Error?a.message:"Unknown error occurred")}finally{_(E,!1)}}function Xt(){I(n,t(n).total_rules=t(c).length),I(n,t(n).active_rules=t(c).filter(a=>a.is_active).length),I(n,t(n).inactive_rules=t(c).filter(a=>!a.is_active).length),I(n,t(n).avg_priority=t(c).length>0?Math.round(t(c).reduce((a,o)=>a+o.priority,0)/t(c).length):0)}async function Zt(a){try{const o=t(c).find(f=>f.id===a);if(!o)return;if(!(await fetch(`http://localhost:8000/api/routing/rules/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,is_active:!o.is_active})})).ok)throw new Error("Failed to update rule status");await T()}catch(o){alert(o instanceof Error?o.message:"Failed to update rule status")}}async function te(a){if(confirm("Are you sure you want to delete this routing rule?"))try{if(!(await fetch(`http://localhost:8000/api/routing/rules/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete rule");await T()}catch(o){alert(o instanceof Error?o.message:"Failed to delete rule")}}async function ee(a){try{const o=await fetch(`http://localhost:8000/api/routing/rules/${a}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({caller_phone:"+1234567890",required_skills:["sales"],language:"en"})});if(!o.ok)throw new Error("Failed to test rule");const x=await o.json();alert(`Test Result:
${JSON.stringify(x,null,2)}`)}catch(o){alert(o instanceof Error?o.message:"Failed to test rule")}}function re(a){return new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function ae(a){return a?"text-green-600":"text-gray-400"}function se(a){return a?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-600 border-gray-200"}function ie(a){return{skill_based:"bg-blue-100 text-blue-800 border-blue-200",least_busy:"bg-purple-100 text-purple-800 border-purple-200",longest_idle:"bg-indigo-100 text-indigo-800 border-indigo-200",round_robin:"bg-green-100 text-green-800 border-green-200",priority:"bg-red-100 text-red-800 border-red-200",language:"bg-yellow-100 text-yellow-800 border-yellow-200",vip:"bg-pink-100 text-pink-800 border-pink-200",custom:"bg-gray-100 text-gray-800 border-gray-200"}[a]||"bg-gray-100 text-gray-800 border-gray-200"}De(()=>(t(c),t(u),t(g),t(S)),()=>{_(k,t(c).filter(a=>{const o=t(u)===""||a.name.toLowerCase().includes(t(u).toLowerCase())||a.description&&a.description.toLowerCase().includes(t(u).toLowerCase()),x=t(g)==="all"||t(g)==="active"&&a.is_active||t(g)==="inactive"&&!a.is_active,f=t(S)==="all"||a.strategy===t(S);return o&&x&&f}).sort((a,o)=>a.priority-o.priority))}),Ie(),ze();var M=nr(),q=s(r(M),2),B=r(q),wt=r(B),J=r(wt),kt=s(r(J),2),oe=r(kt,!0);e(kt),e(J);var le=s(J,2);j(le,{class:"w-8 h-8 text-blue-500"}),e(wt),e(B);var U=s(B,2),St=r(U),G=r(St),Rt=s(r(G),2),ne=r(Rt,!0);e(Rt),e(G);var de=s(G,2);Wt(de,{class:"w-8 h-8 text-green-500"}),e(St),e(U);var V=s(U,2),$t=r(V),z=r($t),Ct=s(r(z),2),ce=r(Ct,!0);e(Ct),e(z);var ve=s(z,2);j(ve,{class:"w-8 h-8 text-gray-400"}),e($t),e(V);var Et=s(V,2),Lt=r(Et),K=r(Lt),jt=s(r(K),2),pe=r(jt,!0);e(jt),e(K);var ue=s(K,2);er(ue,{class:"w-8 h-8 text-blue-400"}),e(Lt),e(Et),e(q);var Q=s(q,2),Pt=r(Q),Y=r(Pt),H=r(Y),Tt=r(H);We(Tt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"});var At=s(Tt,2);Je(At),e(H);var A=s(H,2);C(()=>{t(g),Vt(()=>{})});var W=r(A);W.value=W.__value="all";var X=s(W);X.value=X.__value="active";var Ft=s(X);Ft.value=Ft.__value="inactive",e(A);var Z=s(A,2);C(()=>{t(S),Vt(()=>{})});var tt=r(Z);tt.value=tt.__value="all";var ge=s(tt);Kt(ge,1,()=>l(()=>Object.entries(ht)),Qt,(a,o)=>{var x=Me(()=>qe(t(o),2));let f=()=>t(x)[0],et=()=>t(x)[1];var v=rr(),b=r(v,!0);e(v);var y={};C(()=>{d(b,et()),y!==(y=f())&&(v.value=(v.__value=f())??"")}),p(a,v)}),e(Z),e(Y);var Nt=s(Y,2),xe=r(Nt);Xe(xe,{class:"w-4 h-4"}),zt(),e(Nt),e(Pt),e(Q);var Dt=s(Q,2),_e=r(Dt);{var fe=a=>{var o=ar();p(a,o)},be=a=>{var o=yt(),x=mt(o);{var f=v=>{var b=sr(),y=r(b),rt=r(y,!0);e(y);var at=s(y,2);at.__click=T,e(b),C(()=>d(rt,t(L))),p(v,b)},et=v=>{var b=yt(),y=mt(b);{var rt=R=>{var h=ir(),F=r(h);j(F,{class:"w-12 h-12 text-gray-300 mx-auto mb-2"}),zt(4),e(h),p(R,h)},at=R=>{var h=lr(),F=s(r(h));Kt(F,5,()=>t(k),Qt,(ye,i)=>{var st=or(),it=r(st),It=r(it),Ot=r(It),me=r(Ot,!0);e(Ot),e(It),e(it);var ot=s(it),Mt=r(ot),qt=r(Mt);{let _t=Be(()=>(t(i),l(()=>ae(t(i).is_active))));j(qt,{get class(){return`w-5 h-5 ${t(_t)??""} mr-2`}})}var Bt=s(qt,2),lt=r(Bt),he=r(lt,!0);e(lt);var Jt=s(lt,2),we=r(Jt,!0);e(Jt),e(Bt),e(Mt),e(ot);var nt=s(ot),dt=r(nt),ke=r(dt,!0);e(dt),e(nt);var ct=s(nt),Se=r(ct,!0);e(ct);var vt=s(ct),Re=r(vt,!0);e(vt);var pt=s(vt),ut=r(pt),$e=r(ut,!0);e(ut),e(pt);var gt=s(pt),Ce=r(gt,!0);e(gt);var Ut=s(gt),Gt=r(Ut),N=r(Gt);N.__click=()=>ee(t(i).id);var Ee=r(N);Wt(Ee,{class:"w-4 h-4"}),e(N);var D=s(N,2),Le=r(D);Ze(Le,{class:"w-4 h-4"}),e(D);var $=s(D,2);$.__click=()=>Zt(t(i).id);var je=r($);j(je,{class:"w-4 h-4"}),e($);var xt=s($,2);xt.__click=()=>te(t(i).id);var Pe=r(xt);tr(Pe,{class:"w-4 h-4"}),e(xt),e(Gt),e(Ut),e(st),C((_t,Te,Ae)=>{d(me,(t(i),l(()=>t(i).priority))),d(he,(t(i),l(()=>t(i).name))),d(we,(t(i),l(()=>t(i).description||"No description"))),bt(dt,1,`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full border ${_t??""}`),d(ke,(t(i),l(()=>ht[t(i).strategy]||t(i).strategy))),d(Se,(t(i),l(()=>t(i).conditions?.length||0))),d(Re,(t(i),l(()=>t(i).targets?.length||0))),bt(ut,1,`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full border ${Te??""}`),d($e,(t(i),l(()=>t(i).is_active?"Active":"Inactive"))),d(Ce,Ae),Ht(D,"href",`/operations/routing/builder?id=${t(i),l(()=>t(i).id)??""}`),bt($,1,Ue((t(i),l(()=>t(i).is_active?"text-gray-600 hover:text-gray-900":"text-green-600 hover:text-green-900")))),Ht($,"title",(t(i),l(()=>t(i).is_active?"Deactivate":"Activate")))},[()=>(t(i),l(()=>ie(t(i).strategy))),()=>(t(i),l(()=>se(t(i).is_active))),()=>(t(i),l(()=>re(t(i).updated_at)))]),p(ye,st)}),e(F),e(h),p(R,h)};ft(y,R=>{t(k),l(()=>t(k).length===0)?R(rt):R(at,!1)},!0)}p(v,b)};ft(x,v=>{t(L)?v(f):v(et,!1)},!0)}p(a,o)};ft(_e,a=>{t(E)?a(fe):a(be,!1)})}e(Dt),e(M),C(()=>{d(oe,(t(n),l(()=>t(n).total_rules))),d(ne,(t(n),l(()=>t(n).active_rules))),d(ce,(t(n),l(()=>t(n).inactive_rules))),d(pe,(t(n),l(()=>t(n).avg_priority)))}),Ve(At,()=>t(u),a=>_(u,a)),Yt(A,()=>t(g),a=>_(g,a)),Yt(Z,()=>t(S),a=>_(S,a)),p(O,M),Oe()}Ge(["click"]);export{jr as component};
