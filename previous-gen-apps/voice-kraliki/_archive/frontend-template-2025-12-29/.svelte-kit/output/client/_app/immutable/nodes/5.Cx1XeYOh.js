import{f as m,a as l,c as B}from"../chunks/pFl1CK35.js";import{o as ze,a as He}from"../chunks/0VtO9hYy.js";import{p as Ke,s as S,a as fe,t as M,c as Qe,d as s,e as c,g as t,f as n,r as a,n as j,h as A,u as Xe}from"../chunks/aQ_ifger.js";import{s as T}from"../chunks/DBuqHHqM.js";import{i as _}from"../chunks/BTxJJ6eU.js";import{e as be,i as ge}from"../chunks/oqRKM5NY.js";import{r as Ze}from"../chunks/BqAhscvM.js";import{s as N}from"../chunks/DGR2HyJN.js";import{d as et}from"../chunks/C918u5xm.js";import{b as tt}from"../chunks/CDxeFDgn.js";import"../chunks/DLb8tBY9.js";import"../chunks/8UtF8RsF.js";import{A as rt}from"../chunks/B8eVYxVA.js";import{U as at}from"../chunks/BS24MMqf.js";import{P as st}from"../chunks/BumCI67k.js";import{P as ot}from"../chunks/W1CsE6Bq.js";import{R as _e}from"../chunks/DVBVNVSq.js";import{P as it}from"../chunks/C8ipYI_7.js";import{M as nt}from"../chunks/DQwSrkCv.js";import{M as dt}from"../chunks/BcyIxIqt.js";var lt=m('<div class="flex items-center gap-2 px-3 py-1 bg-system-red/10 border-2 border-system-red text-system-red"><span class="w-2 h-2 bg-system-red rounded-full animate-pulse"></span> <span class="text-xs font-bold uppercase"> </span></div>'),ct=m('<div class="p-8 text-center"><div class="inline-block w-8 h-8 border-4 border-terminal-green/30 border-t-terminal-green animate-spin"></div> <p class="mt-2 text-xs font-bold uppercase text-muted-foreground">Loading personas...</p></div>'),vt=m('<button><div class="flex items-start gap-3"><div><!></div> <div class="flex-1"><div class="font-display text-sm uppercase"> </div> <div class="text-[10px] text-muted-foreground line-clamp-2 mt-1"> </div></div></div></button>'),pt=m('<div class="space-y-3"></div>'),ut=m("<button><!> Start Session</button>"),mt=m('<button disabled class="w-full brutal-btn bg-muted text-muted-foreground cursor-wait"><!> Connecting...</button>'),ft=m("<!> Muted",1),bt=m("<!> Mic On",1),gt=m('<div class="flex gap-2"><button><!></button> <button class="flex-1 brutal-btn bg-system-red text-white"><!> End</button></div>'),_t=m('<button class="w-full brutal-btn bg-primary text-primary-foreground"><!> New Session</button>'),xt=m('<div class="p-3 bg-muted/10 border border-muted text-xs"><div class="font-bold uppercase text-muted-foreground mb-1">Selected:</div> <div class="font-display"> </div> <div class="text-muted-foreground mt-1"> </div></div>'),ht=m('<div class="flex items-center gap-2 text-system-red"><span class="w-2 h-2 bg-system-red rounded-full animate-pulse"></span> <span class="text-[10px] font-bold uppercase">Recording</span></div>'),yt=m('<div class="text-center py-12 text-muted-foreground"><!> <p class="text-xs font-bold uppercase">Select a persona and start the session</p></div>'),wt=m('<div class="text-[9px] font-bold uppercase opacity-70 mb-1"> </div>'),St=m('<div><div><!> <div class="text-sm"> </div> <div class="text-[9px] opacity-50 mt-1"> </div></div></div>'),kt=m('<div class="flex gap-2"><input type="text" placeholder="Type your response..." class="flex-1 brutal-input"/> <button>Send</button></div> <p class="text-[10px] text-muted-foreground mt-2">Press Enter to send your message. The AI persona will respond based on the scenario.</p>',1),It=m('<div class="p-6 max-w-7xl mx-auto min-h-screen space-y-6"><header class="flex flex-col md:flex-row md:items-center justify-between gap-4 border-b-4 border-foreground pb-6"><div class="flex items-center gap-4"><a href="/scenarios" class="p-2 border-2 border-foreground hover:bg-terminal-green hover:text-void transition-all bg-card"><!></a> <div><h1 class="text-4xl font-display text-foreground tracking-tighter uppercase">Voice <span class="text-terminal-green">Arena</span></h1> <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-muted-foreground mt-1"> </p></div></div> <div class="flex items-center gap-4"><!></div></header> <div class="grid grid-cols-1 lg:grid-cols-12 gap-6"><div class="lg:col-span-4 space-y-6"><div class="brutal-card"><div class="flex items-center gap-2 mb-4 border-b-2 border-foreground pb-2"><div class="w-3 h-3 bg-terminal-green"></div> <h2 class="text-xl font-display uppercase tracking-tight">Select Persona</h2></div> <!></div> <div class="brutal-card"><div class="flex items-center gap-2 mb-4 border-b-2 border-foreground pb-2"><div class="w-3 h-3 bg-cyan-data"></div> <h2 class="text-xl font-display uppercase tracking-tight">Controls</h2></div> <div class="space-y-4"><!> <!></div></div></div> <div class="lg:col-span-8"><div class="brutal-card h-full flex flex-col"><div class="flex items-center justify-between gap-2 mb-4 border-b-2 border-foreground pb-2"><div class="flex items-center gap-2"><div class="w-3 h-3 bg-primary"></div> <h2 class="text-xl font-display uppercase tracking-tight">Conversation</h2></div> <!></div> <div class="flex-1 min-h-[400px] max-h-[600px] overflow-y-auto space-y-3 mb-4 p-4 bg-muted/5 border border-muted"><!></div> <!></div></div></div></div>');function Yt(xe,he){Ke(he,!0);let te=S(fe([])),b=S(null),W=S(null),p=S("idle"),k=S(fe([])),C=S(""),G=S(!0),L=S(!1),V=S(!1),f=null,F=S(0),$=null;ze(async()=>{await ye()}),He(()=>{f&&f.close(),$&&clearInterval($)});async function ye(){n(G,!0);try{const e=await fetch("/api/arena/personas");if(e.ok){const r=await e.json();n(te,r.personas||[],!0)}}catch(e){console.error("Failed to load personas:",e),y("Failed to load personas. Please refresh the page.")}finally{n(G,!1)}}async function we(){if(!t(b)){y("Please select a persona first.");return}n(p,"connecting"),y(`Creating session with ${t(b).name}...`);try{const e=await fetch("/api/arena/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({persona_type:t(b).id})});if(!e.ok)throw new Error("Failed to create session");const r=await e.json();n(W,r.session_id,!0),Se()}catch(e){console.error("Failed to create session:",e),y("Failed to create session. Please try again."),n(p,"idle")}}function Se(){if(!t(W))return;const r=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/arena/ws/${t(W)}`;f=new WebSocket(r),f.onopen=()=>{y("Connected to arena. Starting session..."),f?.send(JSON.stringify({type:"start-arena"}))},f.onmessage=o=>{const v=JSON.parse(o.data);ke(v)},f.onclose=()=>{t(p)==="active"&&(y("Connection lost. Session ended."),ae())},f.onerror=o=>{console.error("WebSocket error:",o),y("Connection error occurred.")}}function ke(e){switch(e.type){case"arena-started":n(p,"active"),n(V,!0),Pe(),y(`Session started with ${e.persona}. Begin speaking!`);break;case"persona-response":n(k,[...t(k),{role:"persona",content:e.response,timestamp:new Date().toISOString()}],!0);break;case"arena-ended":n(p,"ended"),n(V,!1),se();const r=oe(e.duration||t(F));y(`Session ended. Duration: ${r}`);break;case"error":y(`Error: ${e.error}`);break}}function re(){!t(C).trim()||!f||t(p)!=="active"||(n(k,[...t(k),{role:"trainee",content:t(C),timestamp:new Date().toISOString()}],!0),f.send(JSON.stringify({type:"get-response",input:t(C)})),n(C,""))}function ae(){f&&t(p)==="active"&&f.send(JSON.stringify({type:"end-arena",scorecard:{empathy:5,clarity:4,resolution:5}})),n(p,"ended"),se()}function Ie(){n(W,null),n(p,"idle"),n(k,[],!0),n(F,0),n(b,null),f&&(f.close(),f=null)}function y(e){n(k,[...t(k),{role:"system",content:e,timestamp:new Date().toISOString()}],!0)}function Pe(){n(F,0),$=setInterval(()=>{Xe(F)},1e3)}function se(){$&&(clearInterval($),$=null)}function oe(e){const r=Math.floor(e/60),o=e%60;return`${r}:${o.toString().padStart(2,"0")}`}function Me(e){return new Date(e).toLocaleTimeString()}function Te(e){return{angry_customer:"bg-system-red",curious_learner:"bg-primary",confused_user:"bg-accent",satisfied_client:"bg-terminal-green",persistent_issue_reporter:"bg-cyan-data"}[e]||"bg-muted"}var Y=It(),q=s(Y),z=s(q),H=s(z),Ce=s(H);rt(Ce,{class:"w-5 h-5"}),a(H);var ie=c(H,2),ne=c(s(ie),2),Oe=s(ne);a(ne),a(ie),a(z);var de=c(z,2),De=s(de);{var je=e=>{var r=lt(),o=c(s(r),2),v=s(o,!0);a(o),a(r),M(i=>T(v,i),[()=>oe(t(F))]),l(e,r)};_(De,e=>{t(p)==="active"&&e(je)})}a(de),a(q);var le=c(q,2),K=s(le),Q=s(K),Ae=c(s(Q),2);{var Ne=e=>{var r=ct();l(e,r)},$e=e=>{var r=pt();be(r,21,()=>t(te),ge,(o,v)=>{var i=vt();i.__click=()=>n(b,t(v),!0);var d=s(i),u=s(d),O=s(u);at(O,{class:"w-5 h-5"}),a(u);var U=c(u,2),I=s(U),w=s(I,!0);a(I);var g=c(I,2),x=s(g,!0);a(g),a(U),a(d),a(i),M(h=>{i.disabled=t(p)!=="idle",N(i,1,`w-full text-left p-4 border-2 transition-all ${t(b)?.id===t(v).id?"border-terminal-green bg-terminal-green/5 shadow-[4px_4px_0px_0px_rgba(51,255,0,1)]":"border-border hover:border-muted-foreground"} ${t(p)!=="idle"?"opacity-50 cursor-not-allowed":""}`),N(u,1,`w-10 h-10 ${h??""} flex items-center justify-center text-void`),T(w,t(v).name),T(x,t(v).description)},[()=>Te(t(v).id)]),l(o,i)}),a(r),l(e,r)};_(Ae,e=>{t(G)?e(Ne):e($e,!1)})}a(Q);var ce=c(Q,2),ve=c(s(ce),2),pe=s(ve);{var Ue=e=>{var r=ut();r.__click=we;var o=s(r);st(o,{class:"w-5 h-5 inline mr-2"}),j(),a(r),M(()=>{r.disabled=!t(b),N(r,1,`w-full brutal-btn bg-terminal-green text-void ${t(b)?"":"opacity-50 cursor-not-allowed"}`)}),l(e,r)},Ee=e=>{var r=B(),o=A(r);{var v=d=>{var u=mt(),O=s(u);_e(O,{class:"w-5 h-5 inline mr-2 animate-spin"}),j(),a(u),l(d,u)},i=d=>{var u=B(),O=A(u);{var U=w=>{var g=gt(),x=s(g);x.__click=()=>n(L,!t(L));var h=s(x);{var P=E=>{var R=ft(),ee=A(R);nt(ee,{class:"w-5 h-5 inline mr-2"}),j(),l(E,R)},D=E=>{var R=bt(),ee=A(R);dt(ee,{class:"w-5 h-5 inline mr-2"}),j(),l(E,R)};_(h,E=>{t(L)?E(P):E(D,!1)})}a(x);var J=c(x,2);J.__click=ae;var qe=s(J);it(qe,{class:"w-5 h-5 inline mr-2"}),j(),a(J),a(g),M(()=>N(x,1,`flex-1 brutal-btn ${t(L)?"bg-system-red text-white":"bg-muted text-foreground"}`)),l(w,g)},I=w=>{var g=B(),x=A(g);{var h=P=>{var D=_t();D.__click=Ie;var J=s(D);_e(J,{class:"w-5 h-5 inline mr-2"}),j(),a(D),l(P,D)};_(x,P=>{t(p)==="ended"&&P(h)},!0)}l(w,g)};_(O,w=>{t(p)==="active"?w(U):w(I,!1)},!0)}l(d,u)};_(o,d=>{t(p)==="connecting"?d(v):d(i,!1)},!0)}l(e,r)};_(pe,e=>{t(p)==="idle"?e(Ue):e(Ee,!1)})}var Fe=c(pe,2);{var Je=e=>{var r=xt(),o=c(s(r),2),v=s(o,!0);a(o);var i=c(o,2),d=s(i);a(i),a(r),M(()=>{T(v,t(b).name),T(d,`Mood: ${t(b).emotional_state??""}`)}),l(e,r)};_(Fe,e=>{t(b)&&t(p)==="idle"&&e(Je)})}a(ve),a(ce),a(K);var ue=c(K,2),me=s(ue),X=s(me),Re=c(s(X),2);{var We=e=>{var r=ht();l(e,r)};_(Re,e=>{t(V)&&e(We)})}a(X);var Z=c(X,2),Le=s(Z);{var Be=e=>{var r=yt(),o=s(r);ot(o,{class:"w-12 h-12 mx-auto mb-4 opacity-20"}),j(2),a(r),l(e,r)},Ge=e=>{var r=B(),o=A(r);be(o,17,()=>t(k),ge,(v,i)=>{var d=St(),u=s(d),O=s(u);{var U=h=>{var P=wt(),D=s(P,!0);a(P),M(()=>T(D,t(i).role==="trainee"?"You":t(b)?.name||"AI")),l(h,P)};_(O,h=>{t(i).role!=="system"&&h(U)})}var I=c(O,2),w=s(I,!0);a(I);var g=c(I,2),x=s(g,!0);a(g),a(u),a(d),M(h=>{N(d,1,`flex ${t(i).role==="trainee"?"justify-end":"justify-start"}`),N(u,1,`max-w-[80%] p-3 ${t(i).role==="trainee"?"bg-terminal-green/20 border-terminal-green text-foreground":t(i).role==="persona"?"bg-primary/20 border-primary text-foreground":"bg-muted/20 border-muted text-muted-foreground italic"} border-2`),T(w,t(i).content),T(x,h)},[()=>Me(t(i).timestamp)]),l(v,d)}),l(e,r)};_(Le,e=>{t(k).length===0?e(Be):e(Ge,!1)})}a(Z);var Ve=c(Z,2);{var Ye=e=>{var r=kt(),o=A(r),v=s(o);Ze(v),v.__keydown=d=>d.key==="Enter"&&re();var i=c(v,2);i.__click=re,a(o),j(2),M((d,u)=>{i.disabled=d,N(i,1,`brutal-btn bg-terminal-green text-void ${u??""}`)},[()=>!t(C).trim(),()=>t(C).trim()?"":"opacity-50"]),tt(v,()=>t(C),d=>n(C,d)),l(e,r)};_(Ve,e=>{t(p)==="active"&&e(Ye)})}a(me),a(ue),a(le),a(Y),M(e=>T(Oe,`1:1 AI TRAINING // STATUS: ${e??""}`),[()=>t(p).toUpperCase()]),l(xe,Y),Qe()}et(["click","keydown"]);export{Yt as component};
