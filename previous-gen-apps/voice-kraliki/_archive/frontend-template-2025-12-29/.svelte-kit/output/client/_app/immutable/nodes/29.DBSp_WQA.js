import{f as g,a as v,c as mt}from"../chunks/pFl1CK35.js";import"../chunks/CnJ-dsFT.js";import{o as Wt}from"../chunks/0VtO9hYy.js";import{p as Xt,t as T,d as o,e as s,g as e,c as Zt,J as E,f as b,N as te,r as a,h as bt,n as ee}from"../chunks/aQ_ifger.js";import{s as u}from"../chunks/DBuqHHqM.js";import{i as y}from"../chunks/BTxJJ6eU.js";import{e as ae,i as re}from"../chunks/oqRKM5NY.js";import{b as oe,r as yt,d as wt}from"../chunks/BqAhscvM.js";import{s as kt}from"../chunks/DGR2HyJN.js";import{d as se}from"../chunks/C918u5xm.js";import{i as ie}from"../chunks/ft9JqUN4.js";var ne=g('<div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8"><div class="bg-white rounded-lg shadow p-6"><div class="text-sm text-gray-500 mb-1">Total</div> <div class="text-3xl font-bold text-gray-900"> </div></div> <div class="bg-white rounded-lg shadow p-6"><div class="text-sm text-gray-500 mb-1">New</div> <div class="text-3xl font-bold text-blue-600"> </div></div> <div class="bg-white rounded-lg shadow p-6"><div class="text-sm text-gray-500 mb-1">Heard</div> <div class="text-3xl font-bold text-gray-600"> </div></div> <div class="bg-white rounded-lg shadow p-6"><div class="text-sm text-gray-500 mb-1">Saved</div> <div class="text-3xl font-bold text-green-600"> </div></div> <div class="bg-white rounded-lg shadow p-6"><div class="text-sm text-gray-500 mb-1">Avg Duration</div> <div class="text-3xl font-bold text-purple-600"> </div></div></div>'),le=g('<div class="flex gap-2"><button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">Mark as Heard</button> <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">Save</button> <button class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">Archive</button></div>'),de=g('<div class="p-8 text-center text-gray-500"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div> Loading voicemails...</div>'),ce=g('<div class="p-8 text-center text-red-600"><p class="text-lg font-semibold mb-2">Error</p> <p> </p></div>'),ve=g('<div class="p-8 text-center text-gray-500"><p class="text-lg mb-2">No voicemails</p> <p class="text-sm">Your voicemail inbox is empty</p></div>'),pe=g('<span class="mr-2"> </span>'),ue=g('<span class="ml-2" title="Has transcript">üìù</span>'),ge=g('<button class="text-green-600 hover:text-green-900">Transcript</button>'),_e=g('<tr><td class="px-6 py-4 whitespace-nowrap"><input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"/></td><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><!> <div><div class="text-sm font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><span> </span> <!></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"><button class="text-blue-600 hover:text-blue-900">‚ñ∂ Play</button> <!> <button class="text-red-600 hover:text-red-900">Delete</button></td></tr>'),xe=g('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left"><input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"/></th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">From</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Received</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div>'),he=g('<div class="container mx-auto px-4 py-8"><div class="mb-8"><h1 class="text-3xl font-bold text-gray-900 mb-2">Voicemail Inbox</h1> <p class="text-gray-600">Manage your voicemail messages</p></div> <!> <div class="bg-white rounded-lg shadow mb-6 p-6"><div class="flex flex-wrap items-center gap-4"><div class="flex-1"><select class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All Messages</option><option>New</option><option>Heard</option><option>Saved</option><option>Archived</option></select></div> <!> <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Refresh</button></div></div> <div class="bg-white rounded-lg shadow overflow-hidden"><!></div></div>');function Me(St,$t){Xt($t,!1);let S=E([]),w=E(null),V=E(!0),R=E(""),M=E(""),O=1,i=E(new Set);const At={new:"bg-blue-100 text-blue-800 font-semibold",heard:"bg-gray-100 text-gray-800",saved:"bg-green-100 text-green-800",archived:"bg-yellow-100 text-yellow-800",deleted:"bg-red-100 text-red-600"},Tt={1:"‚ö†Ô∏è"};Wt(async()=>{await $(),await I()});async function $(){try{const t=localStorage.getItem("token"),r=new URLSearchParams({agent_id:O.toString()});e(M)&&r.append("status",e(M));const n=await fetch(`http://localhost:8000/api/voicemails?${r}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error("Failed to load voicemails");b(S,await n.json()),b(V,!1)}catch(t){b(R,t instanceof Error?t.message:"Failed to load voicemails"),b(V,!1)}}async function I(){try{const t=localStorage.getItem("token"),r=await fetch(`http://localhost:8000/api/voicemails/agent/${O}/stats`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to load stats");b(w,await r.json())}catch(t){console.error("Failed to load stats:",t)}}async function Et(t){try{const r=localStorage.getItem("token");await fetch(`http://localhost:8000/api/voicemails/${t.id}/heard`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),alert(`Playing voicemail from ${t.caller_phone}
Duration: ${J(t.recording_duration_seconds)}
URL: ${t.recording_url}`),await $(),await I()}catch(r){alert(r instanceof Error?r.message:"Failed to play voicemail")}}async function Mt(t){t.transcription_text?alert(`Transcript from ${t.caller_phone}:

${t.transcription_text}`):alert("No transcript available for this voicemail")}async function Dt(t){if(confirm("Are you sure you want to delete this voicemail?"))try{const r=localStorage.getItem("token");if(!(await fetch(`http://localhost:8000/api/voicemails/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete voicemail");await $(),await I()}catch(r){alert(r instanceof Error?r.message:"Failed to delete voicemail")}}async function U(t){if(e(i).size===0){alert("Please select voicemails first");return}try{const r=localStorage.getItem("token");if(!(await fetch(`http://localhost:8000/api/voicemails/bulk-mark?agent_id=${O}`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({voicemail_ids:Array.from(e(i)),status:t})})).ok)throw new Error("Failed to update voicemails");e(i).clear(),await $(),await I()}catch(r){alert(r instanceof Error?r.message:"Failed to update voicemails")}}function Ft(t){e(i).has(t)?e(i).delete(t):e(i).add(t),b(i,e(i))}function zt(){e(i).size===e(S).length?e(i).clear():e(S).forEach(t=>e(i).add(t.id)),b(i,e(i))}function J(t){const r=Math.floor(t/60),n=t%60;return`${r}:${n.toString().padStart(2,"0")}`}function jt(t){const r=new Date(t),x=new Date().getTime()-r.getTime(),h=Math.floor(x/6e4);if(h<60)return`${h}m ago`;const d=Math.floor(h/60);if(d<24)return`${d}h ago`;const p=Math.floor(d/24);return p<7?`${p}d ago`:r.toLocaleDateString()}ie();var Y=he(),nt=s(o(Y),2);{var Ct=t=>{var r=ne(),n=o(r),x=s(o(n),2),h=o(x,!0);a(x),a(n);var d=s(n,2),p=s(o(d),2),A=o(p,!0);a(p),a(d);var k=s(d,2),P=s(o(k),2),m=o(P,!0);a(P),a(k);var f=s(k,2),D=s(o(f),2),F=o(D,!0);a(D),a(f);var z=s(f,2),j=s(o(z),2),C=o(j,!0);a(j),a(z),a(r),T(B=>{u(h,e(w).total_messages),u(A,e(w).new_messages),u(m,e(w).heard_messages),u(F,e(w).saved_messages),u(C,B)},[()=>J(Math.round(e(w).average_duration_seconds))]),v(t,r)};y(nt,t=>{e(w)&&t(Ct)})}var q=s(nt,2),lt=o(q),G=o(lt),N=o(G);T(()=>{e(M),te(()=>{})}),N.__change=$;var K=o(N);K.value=K.__value="";var Q=s(K);Q.value=Q.__value="new";var W=s(Q);W.value=W.__value="heard";var X=s(W);X.value=X.__value="saved";var dt=s(X);dt.value=dt.__value="archived",a(N),a(G);var ct=s(G,2);{var It=t=>{var r=le(),n=o(r);n.__click=()=>U("heard");var x=s(n,2);x.__click=()=>U("saved");var h=s(x,2);h.__click=()=>U("archived"),a(r),v(t,r)};y(ct,t=>{e(i).size>0&&t(It)})}var Nt=s(ct,2);Nt.__click=$,a(lt),a(q);var vt=s(q,2),Pt=o(vt);{var Bt=t=>{var r=de();v(t,r)},Ht=t=>{var r=mt(),n=bt(r);{var x=d=>{var p=ce(),A=s(o(p),2),k=o(A,!0);a(A),a(p),T(()=>u(k,e(R))),v(d,p)},h=d=>{var p=mt(),A=bt(p);{var k=m=>{var f=ve();v(m,f)},P=m=>{var f=xe(),D=o(f),F=o(D),z=o(F),j=o(z),C=o(j);yt(C),C.__change=zt,a(j),ee(5),a(z),a(F);var B=s(F);ae(B,5,()=>e(S),re,(Lt,l)=>{var H=_e(),Z=o(H),tt=o(Z);yt(tt),tt.__change=()=>Ft(e(l).id),a(Z);var et=s(Z),pt=o(et),ut=o(pt);{var Vt=c=>{var _=pe(),it=o(_,!0);a(_),T(()=>u(it,Tt[1])),v(c,_)};y(ut,c=>{e(l).priority===1&&c(Vt)})}var gt=s(ut,2),at=o(gt),Rt=o(at,!0);a(at);var _t=s(at,2),Ot=o(_t,!0);a(_t),a(gt),a(pt),a(et);var rt=s(et),L=o(rt),Ut=o(L,!0);a(L);var Jt=s(L,2);{var Yt=c=>{var _=ue();v(c,_)};y(Jt,c=>{e(l).has_transcription&&c(Yt)})}a(rt);var ot=s(rt),qt=o(ot,!0);a(ot);var st=s(ot),Gt=o(st,!0);a(st);var xt=s(st),ht=o(xt);ht.__click=()=>Et(e(l));var ft=s(ht,2);{var Kt=c=>{var _=ge();_.__click=()=>Mt(e(l)),v(c,_)};y(ft,c=>{e(l).has_transcription&&c(Kt)})}var Qt=s(ft,2);Qt.__click=()=>Dt(e(l).id),a(xt),a(H),T((c,_,it)=>{kt(H,1,`hover:bg-gray-50 ${e(l).status==="new"?"bg-blue-50":""}`),wt(tt,c),u(Rt,e(l).caller_name||"Unknown"),u(Ot,e(l).caller_phone),kt(L,1,`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${(At[e(l).status]||"bg-gray-100 text-gray-800")??""}`),u(Ut,e(l).status),u(qt,_),u(Gt,it)},[()=>e(i).has(e(l).id),()=>J(e(l).recording_duration_seconds),()=>jt(e(l).created_at)]),v(Lt,H)}),a(B),a(D),a(f),T(()=>wt(C,e(i).size===e(S).length)),v(m,f)};y(A,m=>{e(S).length===0?m(k):m(P,!1)},!0)}v(d,p)};y(n,d=>{e(R)?d(x):d(h,!1)},!0)}v(t,r)};y(Pt,t=>{e(V)?t(Bt):t(Ht,!1)})}a(vt),a(Y),oe(N,()=>e(M),t=>b(M,t)),v(St,Y),Zt()}se(["change","click"]);export{Me as component};
