import{f as p,a as b}from"../chunks/pFl1CK35.js";import"../chunks/CnJ-dsFT.js";import{o as ra}from"../chunks/0VtO9hYy.js";import{p as oa,e as r,t as _,c as sa,g as e,J as z,f as O,d as l,r as a,n as H,k as ia,N as g,M as x}from"../chunks/aQ_ifger.js";import{s as k}from"../chunks/DBuqHHqM.js";import{i as G}from"../chunks/BTxJJ6eU.js";import{e as q,i as D}from"../chunks/oqRKM5NY.js";import{r as R,b as V}from"../chunks/BqAhscvM.js";import{d as na}from"../chunks/C918u5xm.js";import{b as I,a as Te}from"../chunks/CDxeFDgn.js";import{i as da}from"../chunks/ft9JqUN4.js";import{g as ua}from"../chunks/CTjsJUPt.js";import{A as va}from"../chunks/B8eVYxVA.js";import{S as ca}from"../chunks/DFpgVvj5.js";import{P as Ae}from"../chunks/DxRKn0x_.js";import{X as Se}from"../chunks/CMhIKE5Z.js";var ba=p('<div class="p-8 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-blue-600"></div> <p class="mt-2 text-gray-600">Loading rule...</p></div>'),pa=p("<option> </option>"),ga=p("<option> </option>"),_a=p('<p class="text-gray-500 text-center py-4">No conditions added. Rule will apply to all calls.</p>'),ma=p('<div class="md:col-span-4"><select class="px-3 py-1 border border-gray-300 rounded text-sm"><option>AND</option><option>OR</option></select></div>'),fa=p("<option> </option>"),xa=p("<option> </option>"),ya=p('<div class="border border-gray-200 rounded-lg p-4"><div class="grid grid-cols-1 md:grid-cols-4 gap-3"><!> <div><label class="block text-xs font-medium text-gray-600 mb-1">Field</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"></select></div> <div><label class="block text-xs font-medium text-gray-600 mb-1">Operator</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"></select></div> <div class="md:col-span-2 flex gap-2"><div class="flex-1"><label class="block text-xs font-medium text-gray-600 mb-1">Value</label> <input type="text" placeholder="Enter value..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"/></div> <button class="self-end p-2 text-red-600 hover:bg-red-50 rounded transition-colors" title="Remove Condition"><!></button></div></div></div>'),ha=p('<div class="space-y-3"></div>'),wa=p('<p class="text-gray-500 text-center py-4">No targets added. Please add at least one routing target.</p>'),ka=p("<option> </option>"),Ra=p('<div class="border border-gray-200 rounded-lg p-4"><div class="grid grid-cols-1 md:grid-cols-4 gap-3"><div><label class="block text-xs font-medium text-gray-600 mb-1">Target Type</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"></select></div> <div><label class="block text-xs font-medium text-gray-600 mb-1">Target ID</label> <input type="number" placeholder="ID or leave blank" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"/></div> <div><label class="block text-xs font-medium text-gray-600 mb-1">Weight</label> <input type="number" min="1" max="1000" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"/></div> <div class="flex gap-2"><div class="flex-1"><label class="block text-xs font-medium text-gray-600 mb-1">Max Capacity</label> <input type="number" placeholder="Optional" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"/></div> <button class="self-end p-2 text-red-600 hover:bg-red-50 rounded transition-colors" title="Remove Target"><!></button></div></div></div>'),Ca=p('<div class="space-y-3"></div>'),Pa=p('<div class="space-y-6"><div class="bg-white rounded-lg border border-gray-200 p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Basic Configuration</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Rule Name *</label> <input type="text" placeholder="e.g., VIP Customer Routing" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Description</label> <textarea placeholder="Describe the purpose of this routing rule..." rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Routing Strategy *</label> <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></select> <p class="mt-1 text-sm text-gray-500"> </p></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Priority (Lower = Higher Priority)</label> <input type="number" min="1" max="1000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Fallback Action</label> <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></select></div> <div class="flex items-center gap-4"><div class="flex items-center"><input type="checkbox" id="is_active" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/> <label for="is_active" class="ml-2 text-sm text-gray-700">Active</label></div> <div class="flex items-center"><input type="checkbox" id="business_hours" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/> <label for="business_hours" class="ml-2 text-sm text-gray-700">Business Hours Only</label></div></div></div></div> <div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-gray-900">Routing Conditions</h2> <button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><!> Add Condition</button></div> <!></div> <div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-gray-900">Routing Targets *</h2> <button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><!> Add Target</button></div> <!></div></div>'),Ta=p('<div class="p-6 max-w-5xl mx-auto"><div class="mb-6 flex items-center justify-between"><div class="flex items-center gap-4"><a href="/operations/routing" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"><!></a> <div><h1 class="text-3xl font-bold text-gray-900"> </h1> <p class="text-gray-600">Configure intelligent call routing</p></div></div> <button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors"><!> </button></div> <!></div>');function Qa(Ne,qe){oa(qe,!1);let C=z(null),t=z({name:"",description:"",team_id:1,priority:100,strategy:"skill_based",is_active:!0,conditions:[],targets:[],fallback_action:"voicemail",business_hours_only:!1}),X=z(!1),Q=z(!1);const be=[{value:"skill_based",label:"Skill-Based",description:"Route based on agent skills"},{value:"least_busy",label:"Least Busy",description:"Route to agent with fewest calls"},{value:"longest_idle",label:"Longest Idle",description:"Route to agent idle longest"},{value:"round_robin",label:"Round Robin",description:"Distribute calls evenly"},{value:"priority",label:"Priority",description:"Route by priority level"},{value:"language",label:"Language",description:"Match caller language"},{value:"vip",label:"VIP",description:"Prioritize VIP callers"},{value:"custom",label:"Custom",description:"Custom routing logic"}],De=[{value:"caller_phone",label:"Caller Phone"},{value:"caller_country",label:"Caller Country"},{value:"time_of_day",label:"Time of Day"},{value:"day_of_week",label:"Day of Week"},{value:"queue_wait_time",label:"Queue Wait Time"},{value:"required_skills",label:"Required Skills"},{value:"language",label:"Language"},{value:"campaign_id",label:"Campaign"},{value:"custom_field",label:"Custom Field"}],Ie=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"contains",label:"Contains"},{value:"starts_with",label:"Starts With"},{value:"greater_than",label:"Greater Than"},{value:"less_than",label:"Less Than"},{value:"in_list",label:"In List"}],Fe=[{value:"agent",label:"Agent"},{value:"team",label:"Team"},{value:"queue",label:"Queue"},{value:"phone",label:"Phone Number"},{value:"ivr",label:"IVR Flow"}],Le=[{value:"voicemail",label:"Send to Voicemail"},{value:"queue",label:"Add to Queue"},{value:"transfer",label:"Transfer to Number"},{value:"hangup",label:"Hangup"},{value:"callback",label:"Offer Callback"}];ra(async()=>{const m=new URLSearchParams(window.location.search).get("id");m&&(O(C,parseInt(m)),await Ee())});async function Ee(){if(e(C)){O(X,!0);try{const n=await fetch(`http://localhost:8000/api/routing/rules/${e(C)}`);if(!n.ok)throw new Error("Failed to load rule");O(t,await n.json())}catch(n){alert(n instanceof Error?n.message:"Failed to load rule")}finally{O(X,!1)}}}async function Oe(){if(!e(t).name.trim()){alert("Please enter a rule name");return}if(e(t).targets.length===0){alert("Please add at least one routing target");return}O(Q,!0);try{const n=e(C)?"PUT":"POST",m=e(C)?`http://localhost:8000/api/routing/rules/${e(C)}`:"http://localhost:8000/api/routing/rules";if(!(await fetch(m,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(e(t))})).ok)throw new Error("Failed to save rule");alert("Rule saved successfully!"),ua("/operations/routing")}catch(n){alert(n instanceof Error?n.message:"Failed to save rule")}finally{O(Q,!1)}}function Ve(){x(t,e(t).conditions=[...e(t).conditions,{field:"caller_phone",operator:"equals",value:"",logic_operator:"AND"}])}function je(n){x(t,e(t).conditions=e(t).conditions.filter((m,w)=>w!==n))}function Be(){x(t,e(t).targets=[...e(t).targets,{target_type:"agent",target_id:null,weight:100,max_capacity:null}])}function Me(n){x(t,e(t).targets=e(t).targets.filter((m,w)=>w!==n))}da();var K=Ta(),Y=l(K),Z=l(Y),$=l(Z),We=l($);va(We,{class:"w-5 h-5"}),a($);var pe=r($,2),ge=l(pe),He=l(ge,!0);a(ge),H(2),a(pe),a(Z);var J=r(Z,2);J.__click=Oe;var _e=l(J);ca(_e,{class:"w-4 h-4"});var Qe=r(_e);a(J),a(Y);var Je=r(Y,2);{var Ue=n=>{var m=ba();b(n,m)},ze=n=>{var m=Pa(),w=l(m),me=r(l(w),2),ee=l(me),fe=r(l(ee),2);R(fe),a(ee);var ae=r(ee,2),xe=r(l(ae),2);ia(xe),a(ae);var te=r(ae,2),U=r(l(te),2);_(()=>{e(t),g(()=>{})}),q(U,5,()=>be,D,(o,u)=>{var v=pa(),s=l(v,!0);a(v);var y={};_(()=>{k(s,e(u).label),y!==(y=e(u).value)&&(v.value=(v.__value=e(u).value)??"")}),b(o,v)}),a(U);var ye=r(U,2),Ge=l(ye,!0);a(ye),a(te);var le=r(te,2),he=r(l(le),2);R(he),a(le);var re=r(le,2),oe=r(l(re),2);_(()=>{e(t),g(()=>{})}),q(oe,5,()=>Le,D,(o,u)=>{var v=ga(),s=l(v,!0);a(v);var y={};_(()=>{k(s,e(u).label),y!==(y=e(u).value)&&(v.value=(v.__value=e(u).value)??"")}),b(o,v)}),a(oe),a(re);var we=r(re,2),se=l(we),ke=l(se);R(ke),H(2),a(se);var Re=r(se,2),Ce=l(Re);R(Ce),H(2),a(Re),a(we),a(me),a(w);var ie=r(w,2),ne=l(ie),de=r(l(ne),2);de.__click=Ve;var Xe=l(de);Ae(Xe,{class:"w-4 h-4"}),H(),a(de),a(ne);var Ke=r(ne,2);{var Ye=o=>{var u=_a();b(o,u)},Ze=o=>{var u=ha();q(u,5,()=>e(t).conditions,D,(v,s,y)=>{var P=ya(),j=l(P),F=l(j);{var B=i=>{var c=ma(),d=l(c);_(()=>{e(s),g(()=>{})});var h=l(d);h.value=h.__value="AND";var f=r(h);f.value=f.__value="OR",a(d),a(c),V(d,()=>e(s).logic_operator,la=>(e(s).logic_operator=la,g(()=>e(t)))),b(i,c)};G(F,i=>{y>0&&i(B)})}var T=r(F,2),L=r(l(T),2);_(()=>{e(s),g(()=>{})}),q(L,5,()=>De,D,(i,c)=>{var d=fa(),h=l(d,!0);a(d);var f={};_(()=>{k(h,e(c).label),f!==(f=e(c).value)&&(d.value=(d.__value=e(c).value)??"")}),b(i,d)}),a(L),a(T);var A=r(T,2),E=r(l(A),2);_(()=>{e(s),g(()=>{})}),q(E,5,()=>Ie,D,(i,c)=>{var d=xa(),h=l(d,!0);a(d);var f={};_(()=>{k(h,e(c).label),f!==(f=e(c).value)&&(d.value=(d.__value=e(c).value)??"")}),b(i,d)}),a(E),a(A);var M=r(A,2),S=l(M),W=r(l(S),2);R(W),a(S);var N=r(S,2);N.__click=()=>je(y);var ce=l(N);Se(ce,{class:"w-4 h-4"}),a(N),a(M),a(j),a(P),V(L,()=>e(s).field,i=>(e(s).field=i,g(()=>e(t)))),V(E,()=>e(s).operator,i=>(e(s).operator=i,g(()=>e(t)))),I(W,()=>e(s).value,i=>(e(s).value=i,g(()=>e(t)))),b(v,P)}),a(u),b(o,u)};G(Ke,o=>{e(t).conditions.length===0?o(Ye):o(Ze,!1)})}a(ie);var Pe=r(ie,2),ue=l(Pe),ve=r(l(ue),2);ve.__click=Be;var $e=l(ve);Ae($e,{class:"w-4 h-4"}),H(),a(ve),a(ue);var ea=r(ue,2);{var aa=o=>{var u=wa();b(o,u)},ta=o=>{var u=Ca();q(u,5,()=>e(t).targets,D,(v,s,y)=>{var P=Ra(),j=l(P),F=l(j),B=r(l(F),2);_(()=>{e(s),g(()=>{})}),q(B,5,()=>Fe,D,(i,c)=>{var d=ka(),h=l(d,!0);a(d);var f={};_(()=>{k(h,e(c).label),f!==(f=e(c).value)&&(d.value=(d.__value=e(c).value)??"")}),b(i,d)}),a(B),a(F);var T=r(F,2),L=r(l(T),2);R(L),a(T);var A=r(T,2),E=r(l(A),2);R(E),a(A);var M=r(A,2),S=l(M),W=r(l(S),2);R(W),a(S);var N=r(S,2);N.__click=()=>Me(y);var ce=l(N);Se(ce,{class:"w-4 h-4"}),a(N),a(M),a(j),a(P),V(B,()=>e(s).target_type,i=>(e(s).target_type=i,g(()=>e(t)))),I(L,()=>e(s).target_id,i=>(e(s).target_id=i,g(()=>e(t)))),I(E,()=>e(s).weight,i=>(e(s).weight=i,g(()=>e(t)))),I(W,()=>e(s).max_capacity,i=>(e(s).max_capacity=i,g(()=>e(t)))),b(v,P)}),a(u),b(o,u)};G(ea,o=>{e(t).targets.length===0?o(aa):o(ta,!1)})}a(Pe),a(m),_(o=>k(Ge,o),[()=>be.find(o=>o.value===e(t).strategy)?.description||""]),I(fe,()=>e(t).name,o=>x(t,e(t).name=o)),I(xe,()=>e(t).description,o=>x(t,e(t).description=o)),V(U,()=>e(t).strategy,o=>x(t,e(t).strategy=o)),I(he,()=>e(t).priority,o=>x(t,e(t).priority=o)),V(oe,()=>e(t).fallback_action,o=>x(t,e(t).fallback_action=o)),Te(ke,()=>e(t).is_active,o=>x(t,e(t).is_active=o)),Te(Ce,()=>e(t).business_hours_only,o=>x(t,e(t).business_hours_only=o)),b(n,m)};G(Je,n=>{e(X)?n(Ue):n(ze,!1)})}a(K),_(()=>{k(He,e(C)?"Edit Routing Rule":"Create Routing Rule"),J.disabled=e(Q),k(Qe,` ${e(Q)?"Saving...":"Save Rule"}`)}),b(Ne,K),sa()}na(["click"]);export{Qa as component};
