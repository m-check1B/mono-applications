import{c as T,a as u,f as y,t as xt}from"./pFl1CK35.js";import{h as A,p as bt,c as yt,d as p,e as k,n as q,r as f,g as o,s as wt,t as St,f as G}from"./aQ_ifger.js";import{s as H}from"./DBuqHHqM.js";import{i as b}from"./BTxJJ6eU.js";import{e as kt,i as Pt}from"./oqRKM5NY.js";import{a as $t}from"./BqAhscvM.js";import{s as zt}from"./DGR2HyJN.js";import{d as Ct}from"./C918u5xm.js";import{l as X,s as tt,p as D}from"./DzqNI6-e.js";import{Z as Ft}from"./CL1TQdwR.js";import"./CnJ-dsFT.js";import{s as et}from"./DaxPoLM8.js";import{I as at}from"./D7pKbUF5.js";import{w as Nt,g as K}from"./B4dMqloI.js";import{R as Et}from"./Zr3TcUzR.js";import{b as Lt}from"./J6IVVljB.js";import{e as Mt,s as Rt,b as It}from"./a4jP7ArO.js";function Tt(P,c){const w=X(c,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M20 6 9 17l-5-5"}]];at(P,tt({name:"check"},()=>w,{get iconNode(){return s},children:(a,d)=>{var i=T(),v=A(i);et(v,c,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Q(P,c){const w=X(c,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];at(P,tt({name:"loader-circle"},()=>w,{get iconNode(){return s},children:(a,d)=>{var i=T(),v=A(i);et(v,c,"default",{}),u(a,i)},$$slots:{default:!0}}))}var At=y('<span class="inline-flex items-center gap-1.5 text-primary"><span class="size-1.5 animate-pulse rounded-full bg-primary"></span> Switch enabled</span>'),Bt=y('<p class="text-sm text-text-muted">No providers configured</p>'),Ot=y("<span>Realtime</span>"),Ut=y("<span>â€¢ Multimodal</span>"),Zt=y("<span>â€¢ Functions</span>"),jt=y('<div class="mt-1 flex gap-2 text-xs text-text-muted"><!> <!> <!></div>'),Dt=y('<button type="button"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><span class="text-2xl" role="img"> </span> <div><p class="text-sm font-semibold text-text-primary"> </p> <!></div></div> <div><!></div></div></button>'),Jt=y('<p class="mt-3 text-xs text-text-muted">ðŸ’¡ You can switch providers during an active call for seamless comparison</p>'),Vt=y('<div class="flex items-center gap-2 rounded-lg bg-primary/10 px-3 py-2 text-sm text-primary"><!> Switching provider...</div>'),Wt=y('<article class="card"><div class="card-header"><div class="flex items-center gap-2"><!> <h2 class="text-lg font-semibold text-text-primary">Voice Provider</h2></div> <span class="text-xs text-text-muted"><!></span></div> <div class="space-y-2"><!> <!> <!></div></article>');function de(P,c){bt(c,!0);let w=D(c,"providers",19,()=>[]),s=D(c,"currentProvider",3,null),a=D(c,"isLive",3,!1),d=wt(!1);async function i(e){if(!(o(d)||e===s())&&c.onSwitch){G(d,!0);try{await c.onSwitch(e)}catch(l){console.error("Failed to switch provider:",l)}finally{G(d,!1)}}}function v(e){switch(e){case"active":return"border-primary bg-primary/10";case"available":return"border-divider bg-secondary/50 hover:border-primary/50 hover:bg-primary/5";case"unavailable":return"border-divider bg-secondary/20 opacity-50 cursor-not-allowed";default:return"border-divider bg-secondary/50"}}function S(e){return e.includes("gemini")?"ðŸ¤–":e.includes("openai")?"ðŸ”·":e.includes("deepgram")?"ðŸŽ™ï¸":"âš¡"}var h=Wt(),x=p(h),N=p(x),M=p(N);Ft(M,{class:"size-5 text-text-primary"}),q(2),f(N);var E=k(N,2),B=p(E);{var t=e=>{var l=At();u(e,l)},r=e=>{var l=xt("Not in call");u(e,l)};b(B,e=>{a()?e(t):e(r,!1)})}f(E),f(x);var n=k(x,2),z=p(n);{var st=e=>{var l=Bt();u(e,l)},rt=e=>{var l=T(),O=A(l);kt(O,17,w,Pt,(lt,m)=>{var C=Dt();C.__click=()=>i(o(m).id);var V=p(C),U=p(V),R=p(U),ct=p(R,!0);f(R);var W=k(R,2),Z=p(W),dt=p(Z,!0);f(Z);var ut=k(Z,2);{var vt=_=>{var $=jt(),I=p($);{var j=g=>{var L=Ot();u(g,L)};b(I,g=>{o(m).capabilities.realtime&&g(j)})}var F=k(I,2);{var _t=g=>{var L=Ut();u(g,L)};b(F,g=>{o(m).capabilities.multimodal&&g(_t)})}var gt=k(F,2);{var ht=g=>{var L=Zt();u(g,L)};b(gt,g=>{o(m).capabilities.functionCalling&&g(ht)})}f($),u(_,$)};b(ut,_=>{o(m).capabilities&&_(vt)})}f(W),f(U);var Y=k(U,2),pt=p(Y);{var ft=_=>{Tt(_,{class:"size-5 text-primary"})},mt=_=>{var $=T(),I=A($);{var j=F=>{Q(F,{class:"size-5 animate-spin text-text-muted"})};b(I,F=>{o(d)&&o(m).id!==s()&&F(j)},!0)}u(_,$)};b(pt,_=>{o(m).status==="active"?_(ft):_(mt,!1)})}f(Y),f(V),f(C),St((_,$)=>{zt(C,1,_),C.disabled=o(m).status==="unavailable"||o(d),$t(R,"aria-label",o(m).name),H(ct,$),H(dt,o(m).name)},[()=>`w-full rounded-xl border-2 p-4 text-left transition-all ${v(o(m).status)}`,()=>S(o(m).id)]),u(lt,C)}),u(e,l)};b(z,e=>{w().length===0?e(st):e(rt,!1)})}var J=k(z,2);{var it=e=>{var l=Jt();u(e,l)};b(J,e=>{a()&&!o(d)&&e(it)})}var nt=k(J,2);{var ot=e=>{var l=Vt(),O=p(l);Q(O,{class:"size-4 animate-spin"}),q(),f(l),u(e,l)};b(nt,e=>{o(d)&&e(ot)})}f(n),f(h),u(P,h),yt()}Ct(["click"]);function ue(P={}){const c=P.provider||"gemini",w={status:"idle",provider:c},s=Nt(w);let a=null,d=c,i,v,S=null,h=!1,x=null;function N(){return Lt.getSnapshot().tokens?.accessToken}async function M(t){if(i&&v&&d===t&&x)return x;S||(S=It({provider_type:t,provider:t}));let r;try{r=await S}finally{S=null}const n=(()=>{try{return new URL(r.websocket_url)}catch{return null}})();return i=r.session_id,v=n?`${n.pathname}${n.search}`:`/ws/sessions/${i}`,h=!1,x=r,s.update(z=>({...z,provider:t,sessionId:i,metadata:r.metadata,websocketPath:v})),r}function E(){if(a)return a;if(!v)throw new Error("Session not initialized");return a=new Et({path:v,token:()=>N(),reconnect:P.reconnect??!1}),a.onOpen(()=>{s.update(t=>({...t,status:"connected",error:void 0}))}),a.onMessage(t=>{let r=t.data;try{typeof t.data=="string"&&(r=JSON.parse(t.data))}catch(n){console.warn("Failed to parse realtime payload",n)}s.update(n=>({...n,lastEvent:r,lastEventAt:Date.now()}))}),a.onError(t=>{const r=t instanceof ErrorEvent?t.message:"WebSocket error";s.update(n=>({...n,status:"error",error:r}))}),a.onClose(t=>{s.update(r=>({...r,status:"disconnected",error:t.wasClean?void 0:`Connection closed (${t.code})`}))}),a}async function B(t){if(t===d)return;a&&(a.disconnect(),a=null),i=void 0,v=void 0,S=null,h=!1,x=null,d=t,s.update(n=>({...n,provider:t,status:"idle",sessionId:void 0}));const r=K(s);(r.status==="connected"||r.status==="connecting")&&(s.update(n=>({...n,status:"connecting"})),M(t).then(()=>E().connect()).catch(n=>{console.error("Failed to bootstrap session on provider switch",n),s.update(z=>({...z,status:"error",error:String(n)}))}))}return{subscribe:s.subscribe,connect(){s.update(t=>({...t,status:"connecting"})),M(d).then(async()=>{if(i&&!h)try{await Rt(i),h=!0}catch(t){console.error("Failed to start session",t)}E().connect()}).catch(t=>{console.error("Failed to bootstrap session",t),s.update(r=>({...r,status:"error",error:String(t)}))})},disconnect(){i&&Mt(i).catch(t=>{console.error("Failed to end session",t)}),a?.disconnect(),a=null,i=void 0,v=void 0,S=null,h=!1,x=null,s.update(t=>({...t,status:"disconnected",sessionId:void 0}))},send(t){a?.send(t)},reset(){a?.disconnect(),a=null,i=void 0,v=void 0,S=null,h=!1,x=null,s.set({...w,provider:d})},getState(){return K(s)},async switchProvider(t){await B(t)}}}export{Q as L,de as P,ue as c};
