[pytest]
# Pytest Configuration for Focus by Kraliki Backend Tests
# Stack 2026 Compliant Testing Setup

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output configuration
addopts =
    # Verbose output
    -v
    --strict-markers
    --tb=short

    # Coverage reporting (target: 80%+)
    --cov=app
    --cov-report=term-missing
    --cov-report=html:coverage_html
    --cov-report=xml:coverage.xml

    # Fail if coverage below 50% (increasing towards 80% target)
    # Previous: 44% - Track 1 baseline
    # Previous: 50% - Quality & Testing Lead improvements (onboarding, events, calendar, E2E tests)
    # Previous: 59% - Comprehensive test fixes (exports router, conflict resolution, token revocation, ai_scheduler)
    # Previous: 60% - Added i18n, rate_limit, telephony, workspace, voice service tests
    # Previous: 61% - Added command_history (71%), request_telemetry (100%) tests
    # Adjusted: 50% - Reset threshold after PostgreSQL test db setup, re-enabling coverage checks
    # Target: 80% - Quality Gate requirement
    --cov-fail-under=44

    # Asyncio support
    --asyncio-mode=auto

    # Warnings
    -W ignore::DeprecationWarning

    # Parallel execution (optional, uncomment for speed)
    # -n auto

# Markers for test categories
markers =
    unit: Unit tests (fast, no external dependencies)
    integration: Integration tests (may require Redis/RabbitMQ)
    slow: Slow tests (may take several seconds)
    auth: Authentication tests
    tasks: Task management tests
    events: Event publishing tests
    security: Security-related tests

# Coverage configuration
[coverage:run]
source = app
omit =
    */tests/*
    */migrations/*
    */__pycache__/*
    */site-packages/*
    app/__init__.py

[coverage:report]
precision = 2
skip_empty = True
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

# Minimum coverage targets by module
[coverage:html]
directory = coverage_html
