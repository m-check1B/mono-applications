import{c as he,a as l,f as v}from"../chunks/pejWV2dy.js";import"../chunks/CQ2dU6u5.js";import{f as we,p as Qe,o as We,Y as Xe,s as d,t as _,c as i,g as t,a as er,b as s,m as u,n as D,r as o,Z as rr}from"../chunks/DgM1AnfY.js";import{d as tr,s as m}from"../chunks/pi1oX53H.js";import{i as x}from"../chunks/B5hbs7lp.js";import{I as ar,s as or,l as ae,e as ir}from"../chunks/RjzcECkQ.js";import{a as _e,b as sr,s as xe}from"../chunks/DGcJkfPx.js";import{i as dr}from"../chunks/CUTbOrLX.js";import{a as oe}from"../chunks/CBf0kXIe.js";import{l as nr,s as lr}from"../chunks/BQCnAYr2.js";import{C as cr,M as ye}from"../chunks/WZCJAQcJ.js";function vr(Y,U){const h=nr(U,["children","$$slots","$$events","$$legacy"]);const y=[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"}],["circle",{cx:"12",cy:"12",r:"2"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19"}]];ar(Y,lr({name:"radio"},()=>h,{get iconNode(){return y},children:(f,k)=>{var I=he(),C=we(I);or(C,U,"default",{}),l(f,I)},$$slots:{default:!0}}))}var pr=v('<span class="text-[10px] font-black uppercase px-2 py-1 border border-black dark:border-white bg-white dark:bg-black"> </span>'),ur=v('<div class="border-2 border-black dark:border-white bg-secondary/20 p-4 space-y-2"><div class="text-xs font-bold uppercase text-muted-foreground">Transcript</div> <p class="font-mono text-sm"> </p> <!></div>'),mr=v('<p class="text-xs text-muted-foreground mt-1"> </p>'),fr=v('<p class="text-xs text-destructive mt-1"> </p>'),gr=v('<p class="text-sm text-destructive"> </p>'),br=v('<div class="w-full max-w-2xl p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-yellow-900 dark:text-yellow-100">Recording... click stop to send audio to the assistant.</div>'),_r=v('<div class="w-full max-w-2xl p-4 bg-card border border-border rounded-lg">Processing audio, please wait...</div>'),xr=v('<div class="w-full max-w-2xl p-4 bg-card border border-border rounded-lg"><p class="text-sm text-muted-foreground mb-1">You said:</p> <p class="font-medium"> </p></div>'),yr=v('<div class="w-full max-w-2xl p-4 bg-primary/5 border border-primary/20 rounded-lg"><p class="text-sm text-muted-foreground mb-1">Assistant reply:</p> <p> </p></div>'),hr=v('<div><div class="text-xs text-muted-foreground mb-1"> </div> <p> </p></div>'),wr=v('<div class="bg-card border border-border rounded-lg p-6"><h2 class="text-xl font-semibold mb-4">Conversation History</h2> <div class="space-y-3 max-h-96 overflow-y-auto"></div></div>'),Rr=v('<div class="space-y-6"><div class="flex items-center justify-between"><div><h1 class="text-3xl font-bold flex items-center gap-2"><!> Voice Interface</h1> <p class="text-muted-foreground mt-1">Upload or record audio to let the assistant respond.</p></div> <button class="px-4 py-2 text-sm bg-accent text-accent-foreground rounded-md hover:bg-accent/80 transition-colors">Clear History</button></div> <!> <div class="bg-card border border-border rounded-lg p-6 space-y-4"><div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between"><div><label class="text-sm font-medium">Voice Provider</label> <select class="mt-1 px-3 py-2 bg-background border border-input rounded-md"><option>Gemini Native</option><option>OpenAI Realtime</option></select> <!></div> <div class="flex flex-col sm:flex-row gap-4 items-start w-full md:w-auto"><div class="flex flex-col items-start flex-1"><input type="file" class="hidden" id="voice-file" accept="audio/*"/> <button class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"><!> Upload Audio</button> <p class="text-xs text-muted-foreground mt-1">Supported formats: webm, wav, mp3</p></div> <div class="flex flex-col items-start flex-1"><button><!> </button> <p class="text-xs text-muted-foreground mt-1"> </p> <!></div></div></div> <!></div> <div class="bg-gradient-to-r from-primary/10 to-purple-500/10 border border-primary/20 rounded-lg p-8 space-y-4"><div class="flex flex-col items-center space-y-4"><div class="w-24 h-24 rounded-full bg-primary flex items-center justify-center"><!></div> <p class="text-lg font-semibold">Choose a provider and upload audio to receive an AI response.</p></div> <!> <!> <!></div> <!></div>');function Ur(Y,U){Qe(U,!1);let h=u("gemini-native"),y=u([]),f=u(""),k=u(""),I=u(null),C=u(null),T=null,B=!1,$=u(null),w=u(null),N=u(!1),p=u(!1),A=u(!1),g=null,H=null,j=[],z=!0;const ie="voice-provider-select";We(async()=>{s(N,typeof navigator<"u"&&typeof navigator.mediaDevices?.getUserMedia=="function"&&typeof MediaRecorder<"u"),Re(),await O()}),Xe(()=>{J(!0),P()});function Re(){const e=localStorage.getItem("voice_conversation");if(e)try{s(y,JSON.parse(e).map(r=>({...r,timestamp:new Date(r.timestamp)})))}catch(r){ae.error("Failed to parse history",r)}}async function O(){if(!B){B=!0,s($,null);try{const e=await oe.assistant.getProviders();s(C,e),T="ready"}catch(e){s($,e.message||"Failed to check voice providers."),ae.error("Failed to initialize voice session",e)}finally{B=!1}}}async function ke(e){const r=e.target,a=r.files?.[0];if(a)try{await Ie(a)}finally{r.value=""}}async function Ie(e){await se(e,e.type||"audio/webm")}async function se(e,r){if(!(!T&&(await O(),!T))){s($,null),s(w,null),s(A,!0);try{const a=await oe.assistant.transcribeAudio(e,"en",t(h)==="gemini-native"?"gemini":t(h)==="openai-realtime"?"deepgram":void 0);s(f,a.transcript||"No transcript available");const n=await oe.assistant.processVoice({transcript:t(f),recordingId:a.id});s(k,n.response||"Understood."),s(I,n.intent||null),s(y,[...t(y),{role:"user",content:t(f),timestamp:new Date},{role:"assistant",content:t(k),timestamp:new Date}]),localStorage.setItem("voice_conversation",JSON.stringify(t(y)))}catch(a){s($,a.message||"Failed to process audio"),ae.error("Failed to process audio",a)}finally{s(A,!1)}}}function P(){H?.getTracks().forEach(e=>e.stop()),H=null,g=null,j=[]}function $e(){if(typeof MediaRecorder>"u"||typeof MediaRecorder.isTypeSupported!="function")return;const e=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus"];for(const r of e)if(MediaRecorder.isTypeSupported(r))return{mimeType:r}}async function Me(){if(!t(p)){if(s(w,null),!t(N)){s(w,"Live recording is not supported in this browser.");return}try{if(!T&&(await O(),!T))return;const e=await navigator.mediaDevices.getUserMedia({audio:!0});H=e;const r=$e();g=new MediaRecorder(e,r),j=[],z=!0,g.ondataavailable=a=>{a.data&&a.data.size>0&&j.push(a.data)},g.onerror=a=>{s(w,a.error?.message||"Recording failed."),J(!0)},g.onstop=async()=>{const a=[...j],n=g?.mimeType||r?.mimeType||"audio/webm";P();const c=z&&a.length>0;z=!0;const b=new Blob(a,{type:n});c&&await se(b,n),s(p,!1)},g.start(),s(p,!0)}catch(e){s(w,e?.message||"Unable to access microphone."),P()}}}function J(e=!1){if(!g){P(),s(p,!1);return}e&&(z=!1),g.state!=="inactive"?g.stop():P(),s(p,!1)}function Se(){confirm("Clear conversation history?")&&(s(y,[]),s(f,""),s(k,""),localStorage.removeItem("voice_conversation"))}dr();var L=Rr(),G=i(L),Z=i(G),de=i(Z),Ce=i(de);vr(Ce,{class:"w-8 h-8 text-primary"}),D(),o(de),D(2),o(Z);var Te=d(Z,2);Te.__click=Se,o(G);var ne=d(G,2);{var Ae=e=>{var r=ur(),a=d(i(r),2),n=i(a,!0);o(a);var c=d(a,2);{var b=R=>{var F=pr(),E=i(F);o(F),_(()=>m(E,`Intent: ${t(I)??""}`)),l(R,F)};x(c,R=>{t(I)&&R(b)})}o(r),_(()=>m(n,t(f))),l(e,r)};x(ne,e=>{t(f)&&e(Ae)})}var q=d(ne,2),K=i(q),Q=i(K),le=i(Q);_e(le,"for",ie);var M=d(le,2);_(()=>{t(h),rr(()=>{})}),_e(M,"id",ie),M.__change=O;var W=i(M);W.value=W.__value="gemini-native";var ce=d(W);ce.value=ce.__value="openai-realtime",o(M);var Pe=d(M,2);{var Fe=e=>{var r=mr(),a=i(r);o(r),_(n=>m(a,`Available: ${n??""}`),[()=>Object.keys(t(C).providers||{}).join(", ")||"none"]),l(e,r)};x(Pe,e=>{t(C)&&e(Fe)})}o(Q);var ve=d(Q,2),X=i(ve),pe=i(X);pe.__change=ke;var V=d(pe,2);V.__click=()=>document.getElementById("voice-file")?.click();var De=i(V);cr(De,{class:"w-4 h-4"}),D(),o(V),D(2),o(X);var ue=d(X,2),S=i(ue);S.__click=()=>t(p)?J():Me();var me=i(S);ye(me,{class:"w-4 h-4"});var Ue=d(me);o(S);var ee=d(S,2),Ne=i(ee,!0);o(ee);var je=d(ee,2);{var ze=e=>{var r=fr(),a=i(r,!0);o(r),_(()=>m(a,t(w))),l(e,r)};x(je,e=>{t(w)&&e(ze)})}o(ue),o(ve),o(K);var Oe=d(K,2);{var Ve=e=>{var r=gr(),a=i(r,!0);o(r),_(()=>m(a,t($))),l(e,r)};x(Oe,e=>{t($)&&e(Ve)})}o(q);var re=d(q,2),te=i(re),fe=i(te),Ee=i(fe);ye(Ee,{class:"w-12 h-12 text-primary-foreground"}),o(fe),D(2),o(te);var ge=d(te,2);{var Ye=e=>{var r=br();l(e,r)},Be=e=>{var r=he(),a=we(r);{var n=c=>{var b=_r();l(c,b)};x(a,c=>{t(A)&&c(n)},!0)}l(e,r)};x(ge,e=>{t(p)?e(Ye):e(Be,!1)})}var be=d(ge,2);{var He=e=>{var r=xr(),a=d(i(r),2),n=i(a,!0);o(a),o(r),_(()=>m(n,t(f))),l(e,r)};x(be,e=>{t(f)&&e(He)})}var Je=d(be,2);{var Le=e=>{var r=yr(),a=d(i(r),2),n=i(a,!0);o(a),o(r),_(()=>m(n,t(k))),l(e,r)};x(Je,e=>{t(k)&&e(Le)})}o(re);var Ge=d(re,2);{var Ze=e=>{var r=wr(),a=d(i(r),2);ir(a,5,()=>t(y),n=>n.timestamp.getTime(),(n,c)=>{var b=hr(),R=i(b),F=i(R);o(R);var E=d(R,2),qe=i(E,!0);o(E),o(b),_(Ke=>{xe(b,1,`p-3 rounded-lg ${t(c).role==="user"?"bg-primary/10 ml-8":"bg-accent/50 mr-8"}`),m(F,`${t(c).role==="user"?"You":"Assistant"} â€¢
              ${Ke??""}`),m(qe,t(c).content)},[()=>new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}).format(t(c).timestamp)]),l(n,b)}),o(a),o(r),l(e,r)};x(Ge,e=>{t(y).length>0&&e(Ze)})}o(L),_(()=>{V.disabled=t(A),xe(S,1,`px-4 py-2 rounded-md flex items-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${t(p)?"bg-destructive text-destructive-foreground hover:bg-destructive/80":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`),S.disabled=!t(N)||t(A)&&!t(p),m(Ue,` ${t(p)?"Stop Recording":"Record Live Audio"}`),m(Ne,t(N)?t(p)?"Recording in progress...":"Capture audio directly from your microphone.":"Your browser does not support live recording.")}),sr(M,()=>t(h),e=>s(h,e)),l(Y,L),er()}tr(["click","change"]);export{Ur as component};
