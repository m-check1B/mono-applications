import{c as T,a as k}from"./pejWV2dy.js";import"./CQ2dU6u5.js";import{f as h}from"./DgM1AnfY.js";import{I as $,s as L}from"./RjzcECkQ.js";import{l as M,s as v}from"./BQCnAYr2.js";import{w as K}from"./CABBFY_M.js";import{a as i}from"./CBf0kXIe.js";import{i as c,a as l,q as g,c as y,O as I,b as p}from"./DOSPKQyx.js";function q(m,u){const a=M(u,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];$(m,v({name:"plus"},()=>a,{get iconNode(){return s},children:(t,e)=>{var r=T(),o=h(r);L(o,u,"default",{}),k(t,r)},$$slots:{default:!0}}))}function C(m,u){const a=M(u,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5"}],["path",{d:"m9 11 3 3L22 4"}]];$(m,v({name:"square-check-big"},()=>a,{get iconNode(){return s},children:(t,e)=>{var r=T(),o=h(r);L(o,u,"default",{}),k(t,r)},$$slots:{default:!0}}))}const S={items:[],itemTypes:[],isLoading:!1,error:null,selectedTypeId:null};function O(){const{subscribe:m,set:u,update:a}=K(S);return{subscribe:m,async loadItemTypes(){a(s=>({...s,isLoading:!0,error:null}));try{if(!c()){const e=await p.getAll();return a(r=>({...r,itemTypes:e,isLoading:!1})),{success:!0,itemTypes:e}}const t=(await i.knowledge.listItemTypes()).itemTypes||[];await y(I.KNOWLEDGE_TYPES);for(const e of t)await p.save(e);return a(e=>({...e,itemTypes:t,isLoading:!1})),{success:!0,itemTypes:t}}catch(s){const t=s.detail||"Failed to load item types";return a(e=>({...e,isLoading:!1,error:t})),{success:!1,error:t}}},async createItemType(s){try{if(!c())return{success:!1,error:"Offline mode: cannot create item types."};const t=await i.knowledge.createItemType(s);return await p.save(t),a(e=>({...e,itemTypes:[...e.itemTypes,t]})),{success:!0,itemType:t}}catch(t){return{success:!1,error:t.detail||"Failed to create item type"}}},async updateItemType(s,t){try{if(!c())return{success:!1,error:"Offline mode: cannot update item types."};const e=await i.knowledge.updateItemType(s,t);return await p.save(e),a(r=>({...r,itemTypes:r.itemTypes.map(o=>o.id===s?e:o)})),{success:!0,itemType:e}}catch(e){return{success:!1,error:e.detail||"Failed to update item type"}}},async deleteItemType(s){try{return c()?(await i.knowledge.deleteItemType(s),await p.delete(s),a(t=>({...t,itemTypes:t.itemTypes.filter(e=>e.id!==s)})),{success:!0}):{success:!1,error:"Offline mode: cannot delete item types."}}catch(t){return{success:!1,error:t.detail||"Failed to delete item type"}}},async loadKnowledgeItems(s){a(t=>({...t,isLoading:!0,error:null}));try{if(!c()){const o=(await l.getAll()).filter(n=>!(s?.typeId&&n.typeId!==s.typeId||s?.completed!==void 0&&n.completed!==s.completed));return a(n=>({...n,items:o,isLoading:!1})),{success:!0,items:o}}const e=(await i.knowledge.listKnowledgeItems(s)).items||[];await y(I.KNOWLEDGE);for(const r of e)await l.save(r);return a(r=>({...r,items:e,isLoading:!1})),{success:!0,items:e}}catch(t){const e=t.detail||"Failed to load knowledge items";return a(r=>({...r,isLoading:!1,error:e})),{success:!1,error:e}}},async createKnowledgeItem(s){try{if(!c()){const e=new Date().toISOString(),r={id:crypto.randomUUID?.()||`offline-${Date.now()}`,userId:"offline",typeId:s.typeId,title:s.title,content:s.content,item_metadata:s.item_metadata,completed:s.completed??!1,createdAt:e,updatedAt:e};return await l.save(r),await g({type:"create",entity:"knowledge",data:s,endpoint:"/knowledge/items"}),a(o=>({...o,items:[r,...o.items]})),{success:!0,item:r}}const t=await i.knowledge.createKnowledgeItem(s);return await l.save(t),a(e=>({...e,items:[t,...e.items]})),{success:!0,item:t}}catch(t){return{success:!1,error:t.detail||"Failed to create knowledge item"}}},async updateKnowledgeItem(s,t){try{if(!c()){const r=new Date().toISOString();let o=null;return a(n=>{const f=n.items.map(d=>{if(d.id!==s)return d;const w={...d,...t,updatedAt:r};return o=w,w});return{...n,items:f}}),o&&await l.save(o),await g({type:"update",entity:"knowledge",data:t,endpoint:`/knowledge/items/${s}`}),{success:!0,item:o}}const e=await i.knowledge.updateKnowledgeItem(s,t);return await l.save(e),a(r=>({...r,items:r.items.map(o=>o.id===s?e:o)})),{success:!0,item:e}}catch(e){return{success:!1,error:e.detail||"Failed to update knowledge item"}}},async toggleKnowledgeItem(s){try{if(!c()){let e=null;return a(r=>{const o=r.items.map(n=>n.id!==s?n:(e={...n,completed:!n.completed,updatedAt:new Date().toISOString()},e));return{...r,items:o}}),e&&await l.save(e),await g({type:"create",entity:"knowledge",data:{},endpoint:`/knowledge/items/${s}/toggle`}),{success:!0,item:e}}const t=await i.knowledge.toggleKnowledgeItem(s);return await l.save(t),a(e=>({...e,items:e.items.map(r=>r.id===s?t:r)})),{success:!0,item:t}}catch(t){return{success:!1,error:t.detail||"Failed to toggle knowledge item"}}},async deleteKnowledgeItem(s){try{return c()?(await i.knowledge.deleteKnowledgeItem(s),a(t=>({...t,items:t.items.filter(e=>e.id!==s)})),{success:!0}):(await l.delete(s),await g({type:"delete",entity:"knowledge",data:{},endpoint:`/knowledge/items/${s}`}),a(t=>({...t,items:t.items.filter(e=>e.id!==s)})),{success:!0})}catch(t){return{success:!1,error:t.detail||"Failed to delete knowledge item"}}},async searchKnowledgeItems(s,t){a(e=>({...e,isLoading:!0}));try{if(!c()){const o=await l.getAll(),n=s.toLowerCase(),f=o.filter(d=>t&&d.typeId!==t?!1:d.title.toLowerCase().includes(n)||(d.content||"").toLowerCase().includes(n));return a(d=>({...d,items:f,isLoading:!1})),{success:!0,items:f}}const r=(await i.knowledge.searchKnowledgeItems(s,t)).items||[];return a(o=>({...o,items:r,isLoading:!1})),{success:!0,items:r}}catch(e){const r=e.detail||"Search failed";return a(o=>({...o,isLoading:!1,error:r})),{success:!1,error:r}}},setSelectedTypeId(s){a(t=>({...t,selectedTypeId:s}))},clearError(){a(s=>({...s,error:null}))}}}const z=O();export{q as P,C as S,z as k};
