import{w as k}from"./CABBFY_M.js";import{a as n}from"./CBf0kXIe.js";const c={user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},g="focus_token",f=3600*24*30,h=()=>typeof window<"u"?`${window.location.origin}/auth/google/callback`:"",u=l=>{typeof document>"u"||(l?document.cookie=`${g}=${l}; Path=/; Max-Age=${f}; SameSite=Lax`:document.cookie=`${g}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax`)};function m(){const{subscribe:l,set:i,update:s}=k(c);return{subscribe:l,async login(r,o){s(e=>({...e,isLoading:!0,error:null}));try{const e=await n.auth.login({email:r,password:o}),t={user:e.user,token:e.token,isAuthenticated:!0,isLoading:!1,error:null};return n.setToken(e.token),localStorage.setItem("token",e.token),u(e.token),i(t),{success:!0}}catch(e){const t=e.detail||"Login failed";return s(a=>({...a,isLoading:!1,error:t})),{success:!1,error:t}}},async register(r,o,e){s(t=>({...t,isLoading:!0,error:null}));try{const t=await n.auth.register({email:r,password:o,name:e}),a={user:t.user,token:t.token,isAuthenticated:!0,isLoading:!1,error:null};return n.setToken(t.token),localStorage.setItem("token",t.token),u(t.token),i(a),{success:!0}}catch(t){const a=t.detail||"Registration failed";return s(d=>({...d,isLoading:!1,error:a})),{success:!1,error:a}}},async getGoogleAuthUrl(r){try{return await n.google.getAuthUrl({redirect_uri:h(),state:r})}catch(o){throw o}},async loginWithGoogle(r,o){s(e=>({...e,isLoading:!0,error:null}));try{const e=await n.google.login({code:r,redirect_uri:o}),t={user:e.user,token:e.token,isAuthenticated:!0,isLoading:!1,error:null};return n.setToken(e.token),localStorage.setItem("token",e.token),u(e.token),i(t),{success:!0}}catch(e){const t=e.detail||"Google login failed";return s(a=>({...a,isLoading:!1,error:t})),{success:!1,error:t}}},async restoreSession(r){s(o=>({...o,isLoading:!0}));try{n.setToken(r);const o=await n.auth.me();return i({user:o,token:r,isAuthenticated:!0,isLoading:!1,error:null}),u(r),{success:!0}}catch{return localStorage.removeItem("token"),n.setToken(null),u(null),i(c),{success:!1}}},async logout(){try{await n.auth.logout()}catch{}localStorage.removeItem("token"),n.setToken(null),u(null),i(c)},clearError(){s(r=>({...r,error:null}))}}}const L=m();export{L as a};
