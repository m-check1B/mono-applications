import{d as ge,w as fe,g as re}from"../chunks/CABBFY_M.js";import{c as U,a as h,f as D,t as Y}from"../chunks/pejWV2dy.js";import{p as V,f as z,a as X,t as oe,u as Z,B as E,s as j,o as ae,W as H,X as ve,b as u,m as he,g,i as R,c as M,r as O,n as we,y as be}from"../chunks/DgM1AnfY.js";import{d as ke,s as ye}from"../chunks/pi1oX53H.js";import{i as L}from"../chunks/B5hbs7lp.js";import{s as ne,d as _e,a as Se,b as xe,c as ie,e as Ce,i as Te,f as Ie,g as Ne,t as Ee,h as Pe,l as Me,m as le,j as ce,D as Oe,k as We,n as je}from"../chunks/B9v-mvxn.js";import{p as y,a as ue,b as ee,l as Ae,s as Ke}from"../chunks/BQCnAYr2.js";import"../chunks/CQ2dU6u5.js";import{i as se}from"../chunks/CUTbOrLX.js";import{a as me}from"../chunks/DGcJkfPx.js";import{h as Le,a as De}from"../chunks/Bl8ZdI5p.js";import{a as te}from"../chunks/D1iePAOD.js";import{t as $e}from"../chunks/Ctee16U3.js";import{l as S,I as Re,s as He,t as ze}from"../chunks/RjzcECkQ.js";import{s as Fe}from"../chunks/D9mD-Og7.js";import{a as K}from"../chunks/CBf0kXIe.js";import{i as Q,s as Je,c as J,O as B,o as Be,d as Ue,a as Ve,b as Xe,e as qe}from"../chunks/DOSPKQyx.js";import{X as Ge}from"../chunks/BC-kAh8h.js";const pe=fe("en"),Ye={en:{"nav.tasks":"Tasks","nav.projects":"Projects","nav.calendar":"Calendar","task.priority.high":"High","task.priority.medium":"Medium","task.priority.low":"Low","task.status.todo":"To Do","task.status.in_progress":"In Progress","task.status.done":"Done","project.create":"Create Project"},cs:{"nav.tasks":"Úkoly","nav.projects":"Projekty","nav.calendar":"Kalendář","task.priority.high":"Vysoká","task.priority.medium":"Střední","task.priority.low":"Nízká","task.status.todo":"K vyřízení","task.status.in_progress":"Probíhá","task.status.done":"Hotovo","project.create":"Vytvořit projekt"}};ge(pe,r=>e=>Ye[r]?.[e]||e);const Qe=async()=>{{const r=localStorage.getItem("locale")||"en";pe.set(r)}},Ht=Object.freeze(Object.defineProperty({__proto__:null,load:Qe},Symbol.toStringTag,{value:"Module"}));var Ze=D('<meta name="theme-color"/>');function et(r,e){V(e,!1);let a=y(e,"themeColors",24,()=>{});se();var t=U(),n=z(t);{var i=l=>{var v=Ze();oe(()=>me(v,"content",(E(a()),Z(()=>a().dark)))),h(l,v)};L(n,l=>{a()&&l(i)})}h(r,t),X()}var tt=D('<meta name="theme-color"/>'),ot=D("<!> <!>",1);function at(r,e){V(e,!1);let a=y(e,"trueNonce",8,""),t=y(e,"initConfig",8),n=y(e,"themeColors",24,()=>{});se(),Le("kme15g",i=>{var l=ot(),v=z(l);{var w=b=>{var o=tt();oe(()=>me(o,"content",(E(n()),Z(()=>n().dark)))),h(b,o)};L(v,b=>{n()&&b(w)})}var x=j(v,2);De(x,()=>(E(a()),E(ne),E(t()),Z(()=>`<script${a()?` nonce=${a()}`:""}>(`+ne.toString()+")("+JSON.stringify(t())+");<\/script>"))),h(i,l)}),X()}function st(r,e){V(e,!1);const a=()=>ee(le,"$modeStorageKeyStore",n),t=()=>ee(ce,"$themeStorageKeyStore",n),[n,i]=ue(),l=he();let v=y(e,"track",8,!0),w=y(e,"defaultMode",8,"system"),x=y(e,"themeColors",24,()=>{}),b=y(e,"disableTransitions",8,!0),o=y(e,"darkClassNames",24,()=>["dark"]),m=y(e,"lightClassNames",24,()=>[]),k=y(e,"defaultTheme",8,""),C=y(e,"nonce",8,""),T=y(e,"themeStorageKey",8,"mode-watcher-theme"),I=y(e,"modeStorageKey",8,"mode-watcher-mode"),A=y(e,"disableHeadScriptInjection",8,!1);ae(()=>{const c=Se.subscribe(()=>{}),f=xe.subscribe(()=>{});ie.tracking(v()),ie.query();const p=localStorage.getItem(a());Ce(Te(p)?p:w());const P=localStorage.getItem(t());return Ie(P||k()),()=>{c(),f()}});const d=_e({defaultMode:w(),themeColors:x(),darkClassNames:o(),lightClassNames:m(),defaultTheme:k(),modeStorageKey:I(),themeStorageKey:T()});H(()=>E(b()),()=>{Ne.set(b())}),H(()=>E(x()),()=>{Ee.set(x())}),H(()=>E(o()),()=>{Pe.set(o())}),H(()=>E(m()),()=>{Me.set(m())}),H(()=>E(I()),()=>{le.set(I())}),H(()=>E(T()),()=>{ce.set(T())}),H(()=>E(C()),()=>{u(l,typeof window>"u"?C():"")}),ve(),se();var s=U(),_=z(s);{var N=c=>{et(c,{get themeColors(){return x()}})},W=c=>{at(c,{get trueNonce(){return g(l)},get initConfig(){return d},get themeColors(){return x()}})};L(_,c=>{A()?c(N):c(W,!1)})}h(r,s),X(),i()}const rt={isConnected:!1,isConnecting:!1,error:null,lastMessage:null};function nt(){const{subscribe:r,set:e,update:a}=fe(rt);let t=null,n=null,i=0;const l=5;function v(){const o=re(te);if(!o.isAuthenticated||!o.user||!o.token){S.debug("[WS] Not authenticated, skipping connection");return}const m=o.user.id,k=o.token,C=re({subscribe:r});if(C.isConnected||C.isConnecting)return;a(d=>({...d,isConnecting:!0,error:null}));const T=window.location.protocol==="https:"?"wss:":"ws:";let I=window.location.host;const A=`${T}//${I}/ws/${m}?token=${k}`;S.info(`[WS] Connecting to ${T}//${I}/ws/${m}`);try{t=new WebSocket(A),t.onopen=()=>{S.info("[WS] Connected"),a(d=>({...d,isConnected:!0,isConnecting:!1,error:null})),i=0},t.onmessage=d=>{try{const s=JSON.parse(d.data);a(_=>({..._,lastMessage:s})),x(s)}catch(s){S.error("[WS] Failed to parse message",s)}},t.onclose=d=>{if(S.warn(`[WS] Disconnected: ${d.code} ${d.reason}`),a(s=>({...s,isConnected:!1,isConnecting:!1})),t=null,d.code!==1e3&&i<l){const s=Math.min(1e3*Math.pow(2,i),3e4);S.info(`[WS] Reconnecting in ${s}ms (attempt ${i+1})`),n=setTimeout(()=>{i++,v()},s)}},t.onerror=d=>{S.error("[WS] Error",d),a(s=>({...s,error:"WebSocket connection error"}))}}catch(d){S.error("[WS] Exception during connection",d),a(s=>({...s,isConnecting:!1,error:d.message}))}}function w(){n&&(clearTimeout(n),n=null),t&&(t.close(1e3,"User logged out"),t=null),a(o=>({...o,isConnected:!1,isConnecting:!1}))}function x(o){switch(S.debug("[WS] Message received:",o),o.type){case"task_update":case"task_created":case"task_updated":case"task_completed":$e.loadTasks();break}}function b(o,m){return t&&t.readyState===WebSocket.OPEN?(t.send(JSON.stringify({type:o,data:m,timestamp:new Date().toISOString()})),!0):!1}return{subscribe:r,connect:v,disconnect:w,sendMessage:b,ping:()=>b("ping",{})}}const de=nt(),it=()=>{const r=Fe;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},lt={subscribe(r){return it().page.subscribe(r)}},ct="https://analytics.verduona.com",dt="focus.kraliki.com";function ft(){return!(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")||typeof navigator<"u"&&navigator.doNotTrack==="1")}function ut(r){if(!ft())return;const e=`${ct}/api/event`,a=JSON.stringify(r);if(navigator.sendBeacon){const t=new Blob([a],{type:"application/json"});navigator.sendBeacon(e,t)}else fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:a,keepalive:!0}).catch(()=>{})}function mt(r){typeof window>"u"||ut({n:"pageview",u:r||window.location.href,d:dt,r:document.referrer||null,w:window.innerWidth})}function pt(){return lt.subscribe(e=>{e.url&&mt(e.url.href)})}function gt(r,e){const a=Ae(e,["children","$$slots","$$events","$$legacy"]);const t=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2"}],["path",{d:"M12 18h.01"}]];Re(r,Ke({name:"smartphone"},()=>a,{get iconNode(){return t},children:(n,i)=>{var l=U(),v=z(l);He(v,e,"default",{}),h(n,l)},$$slots:{default:!0}}))}var vt=D('<p class="text-xs text-muted-foreground mt-1">Tap <span class="inline-block px-1 bg-muted">Share</span> then <span class="inline-block px-1 bg-muted">Add to Home Screen</span></p>'),ht=D('<p class="text-xs text-muted-foreground mt-1">Install for quick access and offline use</p>'),wt=D('<div class="flex gap-2"><button class="flex-1 px-4 py-2 text-xs font-black uppercase tracking-wider border-2 border-black dark:border-white hover:bg-muted transition-colors">Not now</button> <button class="flex-1 px-4 py-2 text-xs font-black uppercase tracking-wider bg-primary text-primary-foreground border-2 border-black dark:border-white hover:opacity-90 transition-opacity flex items-center justify-center gap-2"><!> Install</button></div>'),bt=D('<div class="fixed bottom-4 left-4 right-4 z-50 max-w-md mx-auto"><div class="flex flex-col gap-3 p-4 border-2 border-black dark:border-white bg-card shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,0.3)]"><div class="flex items-start gap-3"><div class="p-2 bg-primary text-primary-foreground"><!></div> <div class="flex-1"><h3 class="text-sm font-black uppercase tracking-wider">Install Focus</h3> <!></div> <button class="p-1 hover:bg-muted transition-colors" aria-label="Dismiss"><!></button></div> <!></div></div>');function kt(r,e){V(e,!0);let a=R(!1),t=R(null),n=R(!1),i=R(!1);ae(()=>{if(u(i,window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,!0),g(i))return;u(n,/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,!0);const o=localStorage.getItem("pwa-prompt-dismissed");if(o){const k=parseInt(o,10);if(Date.now()-k<1440*60*1e3)return}if(g(n)){setTimeout(()=>{u(a,!0)},5e3);return}const m=k=>{k.preventDefault(),u(t,k,!0),setTimeout(()=>{u(a,!0)},3e3)};return window.addEventListener("beforeinstallprompt",m),window.addEventListener("appinstalled",()=>{u(a,!1),u(t,null)}),()=>{window.removeEventListener("beforeinstallprompt",m)}});async function l(){if(g(t)){try{await g(t).prompt();const{outcome:o}=await g(t).userChoice;o==="accepted"&&u(a,!1)}catch(o){S.error("[PWA] Install prompt error",o)}u(t,null)}}function v(){u(a,!1),localStorage.setItem("pwa-prompt-dismissed",Date.now().toString())}var w=U(),x=z(w);{var b=o=>{var m=bt(),k=M(m),C=M(k),T=M(C),I=M(T);gt(I,{class:"w-5 h-5"}),O(T);var A=j(T,2),d=j(M(A),2);{var s=p=>{var P=vt();h(p,P)},_=p=>{var P=ht();h(p,P)};L(d,p=>{g(n)?p(s):p(_,!1)})}O(A);var N=j(A,2);N.__click=v;var W=M(N);Ge(W,{class:"w-4 h-4"}),O(N),O(C);var c=j(C,2);{var f=p=>{var P=wt(),q=M(P);q.__click=v;var F=j(q,2);F.__click=l;var $=M(F);Oe($,{class:"w-4 h-4"}),we(),O(F),O(P),h(p,P)};L(c,p=>{!g(n)&&g(t)&&p(f)})}O(k),O(m),ze(3,m,()=>We,()=>({y:100,duration:300})),h(o,m)};L(x,o=>{g(a)&&o(b)})}h(r,w),X()}ke(["click"]);var yt=D('<div class="border-b border-border bg-card px-4 py-2 text-xs uppercase tracking-[0.3em] text-muted-foreground"><!></div>'),_t=D('<!> <div class="min-h-screen flex flex-col bg-background bg-grid-pattern text-foreground font-mono"><div class="scanline"></div> <!> <div class="flex-1"><!></div> <footer class="border-t border-border py-4 px-6 text-center text-sm text-muted-foreground"><div class="flex items-center justify-center gap-4"><span>&copy; 2026 Verduona s.r.o.</span> <a href="/privacy" class="hover:text-foreground transition-colors">Privacy</a></div></footer> <!></div>',1);function zt(r,e){V(e,!0);const a=()=>ee(te,"$authStore",t),[t,n]=ue();let i=R(!0),l=R(!1),v=R(null),w=R(null);async function x(){if(!K.getToken())return;const[s,_,N,W,c]=await Promise.all([K.tasks.list(),K.projects.list(),K.knowledge.listKnowledgeItems(),K.knowledge.listItemTypes(),K.timeEntries.list({limit:100})]);await J(B.TASKS);for(const f of s.tasks||[])await Be.save(f);await J(B.PROJECTS);for(const f of _.projects||[])await Ue.save(f);await J(B.KNOWLEDGE);for(const f of N.items||[])await Ve.save(f);await J(B.KNOWLEDGE_TYPES);for(const f of W.itemTypes||[])await Xe.save(f);await J(B.TIME_ENTRIES);for(const f of c.entries||[])await qe.save(f)}async function b(){if(!(!Q()||g(l))&&K.getToken()){u(l,!0),u(w,null);try{const s=await Je(K);s.failed===0?(await x(),u(v,new Date().toISOString(),!0)):u(w,`${s.failed} offline changes failed to sync.`)}catch(s){u(w,s?.message||"Failed to sync offline changes.",!0)}finally{u(l,!1)}}}ae(()=>{const s=pt(),_=localStorage.getItem("token");_&&te.restoreSession(_).then(()=>{Q()&&b()}),u(i,Q(),!0),"serviceWorker"in navigator&&(navigator.serviceWorker.register("/service-worker.js").then(c=>{S.info("[PWA] Service worker registered:",{scope:c.scope}),setInterval(()=>{c.update()},3600*1e3)}).catch(c=>{S.error("[PWA] Service worker registration failed",c)}),window.addEventListener("beforeinstallprompt",c=>{c.preventDefault(),S.info("[PWA] Install prompt available")}),window.addEventListener("appinstalled",()=>{S.info("[PWA] App installed successfully")}));const N=()=>{u(i,!0),b()},W=()=>{u(i,!1)};return window.addEventListener("online",N),window.addEventListener("offline",W),g(i)&&K.getToken()&&b(),()=>{s(),window.removeEventListener("online",N),window.removeEventListener("offline",W)}}),be(()=>{a().isAuthenticated?de.connect():de.disconnect()});var o=_t(),m=z(o);st(m,{});var k=j(m,2),C=j(M(k),2);{var T=s=>{var _=yt(),N=M(_);{var W=f=>{var p=Y("Offline mode: changes will sync when connected.");h(f,p)},c=f=>{var p=U(),P=z(p);{var q=$=>{var G=Y("Syncing offline changes...");h($,G)},F=$=>{var G=Y();oe(()=>ye(G,g(w))),h($,G)};L(P,$=>{g(l)?$(q):$(F,!1)},!0)}h(f,p)};L(N,f=>{g(i)?f(c,!1):f(W)})}O(_),h(s,_)};L(C,s=>{(!g(i)||g(l)||g(w))&&s(T)})}var I=j(C,2),A=M(I);je(A,()=>e.children),O(I);var d=j(I,4);kt(d,{}),O(k),h(r,o),X(),n()}export{zt as component,Ht as universal};
