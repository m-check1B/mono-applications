# Sample Audit Output

This is a pre-generated audit output to use if live demo fails.

---

## Code Audit Report: sample-code.py

**Analyzed by:** Codex (audit) + Opus (synthesis)
**Issues found:** 15
**Critical:** 6 | High: 4 | Medium: 3 | Low: 2

---

## Critical Issues (Fix Immediately)

### 1. SQL Injection Vulnerability
**Location:** `get_user_data()` line 15
**Issue:** User input directly concatenated into SQL query
**Fix:**
```python
# Before (vulnerable)
query = f"SELECT * FROM users WHERE id = {user_id}"

# After (safe)
query = "SELECT * FROM users WHERE id = %s"
result = db.execute(query, (user_id,))
```

### 2. Command Injection Vulnerability
**Location:** `get_user_data()` line 21
**Issue:** User input passed to `os.system()` without sanitization
**Fix:**
```python
# Before (vulnerable)
os.system(f"log_access.sh {user_id}")

# After (safe)
import shlex
subprocess.run(["log_access.sh", shlex.quote(str(user_id))])
```

### 3. Hardcoded Credentials
**Location:** Lines 8-9
**Issue:** API keys and passwords in source code
**Fix:** Move to environment variables
```python
import os
API_KEY = os.environ.get('API_KEY')
DATABASE_PASSWORD = os.environ.get('DATABASE_PASSWORD')
```

### 4. Insecure Deserialization (Pickle)
**Location:** `get_user_data()` line 18
**Issue:** Pickle can execute arbitrary code during deserialization
**Fix:** Use JSON or another safe serialization format
```python
import json
user_prefs = json.load(open('prefs.json', 'r'))
```

### 5. Path Traversal Vulnerability
**Location:** `process_file()` line 29
**Issue:** User-controlled filename can access arbitrary files
**Fix:**
```python
import os
safe_filename = os.path.basename(filename)
filepath = os.path.join("/uploads", safe_filename)
```

### 6. Subprocess Shell Injection
**Location:** `process_file()` line 32
**Issue:** `shell=True` with user input enables command injection
**Fix:**
```python
subprocess.run(["process.sh", filename], shell=False)
```

---

## High Priority Issues

### 7. N+1 Query Pattern
**Location:** `calculate_total()` lines 39-41
**Issue:** Database query inside loop causes N+1 problem
**Fix:** Batch query before loop

### 8. Missing Error Handling
**Location:** Multiple functions
**Issue:** No try/except blocks, no validation
**Fix:** Add proper exception handling

### 9. Timing Attack Vulnerability
**Location:** `UserSession.validate_token()` line 59
**Issue:** String comparison timing reveals information
**Fix:** Use `secrets.compare_digest()`

### 10. Silent Exception Catching
**Location:** Main block lines 68-70
**Issue:** Catching all exceptions and silently passing
**Fix:** Log exceptions, handle specific types

---

## Medium Priority Issues

### 11. Debug Mode Enabled
**Location:** Line 63
**Issue:** DEBUG=True in production code
**Recommendation:** Use environment variable

### 12. Mutable Default Argument
**Location:** `UserSession.__init__()` line 52
**Issue:** Mutable default dict shared across instances
**Fix:** Use `None` as default, create dict in function

### 13. Memory Inefficiency
**Location:** `calculate_total()` line 46
**Issue:** Loading all records into memory
**Recommendation:** Use pagination or streaming

---

## Low Priority Issues

### 14. Unnecessary Loop
**Location:** `calculate_total()` line 44
**Issue:** Pointless nested loop (always 1000 iterations)
**Recommendation:** Remove or refactor

### 15. Code Style
**Location:** Multiple
**Issue:** Missing type hints, docstrings incomplete
**Recommendation:** Add type annotations

---

## Summary

| Category | Count |
|----------|-------|
| Security | 9 |
| Performance | 3 |
| Maintainability | 3 |
| **Total** | **15** |

**Recommended action:** Fix all Critical issues before deployment. Address High priority within 1 sprint. Medium and Low can be scheduled.

---

*Generated by Lab by Kraliki Pro - Build-Audit-Fix Pattern*
