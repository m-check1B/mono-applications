import{f as m,a as f}from"../chunks/CZY_NlAX.js";import{o as Dt}from"../chunks/BHyL2apj.js";import{ag as Nt,aj as h,ap as Ee,g as Ft,m as e,G as r,ak as a,al as s,an as R,ai as Gt,am as t,as as Ht,ao as Jt,ah as Pt}from"../chunks/CHIrzwsT.js";import{s as g}from"../chunks/DsvTbyZG.js";import{i as T}from"../chunks/DNv7RG3c.js";import{e as re,i as ie}from"../chunks/De-eo5w8.js";import{r as Ye,s as et}from"../chunks/Bf116p4L.js";import{s as G}from"../chunks/U6XQp83X.js";import{d as Ut,e as Oe}from"../chunks/CaHQap0G.js";import{b as Re}from"../chunks/C8UA6rw1.js";import{b as le}from"../chunks/_ujM_1n3.js";var Vt=m('<button class="search-clear svelte-1ribsee">X</button>'),Xt=m('<span class="updated svelte-1ribsee"> </span>'),Zt=m('<div class="loading svelte-1ribsee">Loading...</div>'),zt=m('<option class="svelte-1ribsee"> </option>'),Kt=m('<select class="agent-select svelte-1ribsee"></select>'),Qt=m('<input type="text" class="title-input svelte-1ribsee" placeholder="Title"/>'),qt=m('<span class="mic-icon recording-pulse svelte-1ribsee">‚èπ</span>'),Wt=m('<span class="mic-icon svelte-1ribsee">üé§</span>'),Yt=m('<button type="button"><!></button>'),es=m('<div class="file-item svelte-1ribsee"><span class="file-name svelte-1ribsee"> </span> <button class="remove-file svelte-1ribsee">√ó</button></div>'),ts=m('<div class="file-list svelte-1ribsee"></div>'),ss=m('<select class="option-select svelte-1ribsee"><option class="svelte-1ribsee">stream:cash-engine</option><option class="svelte-1ribsee">stream:asset-engine</option><option class="svelte-1ribsee">stream:apps</option></select> <select class="option-select svelte-1ribsee"><option class="svelte-1ribsee">Urgent</option><option class="svelte-1ribsee">High</option><option class="svelte-1ribsee">Medium</option><option class="svelte-1ribsee">Low</option></select> <select class="option-select svelte-1ribsee"><option class="svelte-1ribsee">AI Task</option><option class="svelte-1ribsee">Human Task</option><option class="svelte-1ribsee">Bug</option><option class="svelte-1ribsee">Feature</option><option class="svelte-1ribsee">GIN-DEV</option><option class="svelte-1ribsee">GIN-BIZ</option></select>',1),as=m('<select class="option-select svelte-1ribsee"><option class="svelte-1ribsee">General</option><option class="svelte-1ribsee">Ideas</option><option class="svelte-1ribsee">Bugs</option><option class="svelte-1ribsee">Help</option></select>'),rs=m("<div> </div>"),is=m('<p class="no-results svelte-1ribsee"> </p>'),ls=m('<div class="msg search-result svelte-1ribsee"><div class="msg-header svelte-1ribsee"><span class="msg-agent svelte-1ribsee"> </span> <span class="msg-topic svelte-1ribsee"> </span> <span class="msg-time svelte-1ribsee"> </span></div> <div class="msg-content svelte-1ribsee"> </div></div>'),os=m('<div class="feed svelte-1ribsee"></div>'),ns=m('<div class="card feed-card search-results-card svelte-1ribsee"><div class="search-header svelte-1ribsee"><h3 class="svelte-1ribsee"> </h3> <button class="clear-search-btn svelte-1ribsee">CLEAR</button></div> <!></div>'),vs=m('<p class="no-alerts svelte-1ribsee">No alerts in the recent feed.</p>'),cs=m('<div><div class="alert-meta svelte-1ribsee"><span class="svelte-1ribsee"> </span> <span class="svelte-1ribsee"> </span> <span class="svelte-1ribsee"> </span></div> <div class="alert-text svelte-1ribsee"> </div></div>'),ds=m('<div class="alert-list svelte-1ribsee"></div>'),ps=m('<div><div class="alert-header svelte-1ribsee"><h3 class="svelte-1ribsee">Alert Digest</h3> <span class="alert-count svelte-1ribsee"> </span></div> <div class="alert-stats svelte-1ribsee"><span class="stat-pill alert svelte-1ribsee"> </span> <span class="stat-pill critical svelte-1ribsee"> </span> <span class="stat-pill early svelte-1ribsee"> </span></div> <!></div>'),_s=m('<div><div class="msg-header svelte-1ribsee"><span class="msg-agent svelte-1ribsee"> </span> <span class="msg-topic svelte-1ribsee"> </span> <span class="msg-time svelte-1ribsee"> </span></div> <div class="msg-content svelte-1ribsee"> </div></div>'),us=m('<div class="card feed-card svelte-1ribsee"><h3 class="svelte-1ribsee">Recent Activity</h3> <div class="feed svelte-1ribsee"></div></div>'),bs=m('<div class="layout svelte-1ribsee"><div class="card send-card svelte-1ribsee"><div class="destination-tabs svelte-1ribsee"><button>Linear</button> <button>Blackboard</button> <button>Both</button> <button>Agent</button></div> <!> <!> <div class="input-container svelte-1ribsee"><textarea class="message-input svelte-1ribsee" rows="4"></textarea> <div class="side-controls svelte-1ribsee"><!> <div role="button" tabindex="0"><input type="file" id="file-upload" multiple class="hidden-input svelte-1ribsee"/> <span class="drop-icon svelte-1ribsee">üìé</span></div></div></div> <!> <div class="options-row svelte-1ribsee"><!> <!> <div class="spacer svelte-1ribsee"></div> <button class="send-btn svelte-1ribsee"> </button></div> <!></div> <!> <!> <!></div>'),fs=m('<div class="page svelte-1ribsee"><div class="page-header svelte-1ribsee"><h2 class="glitch svelte-1ribsee">Comms</h2> <div class="header-right svelte-1ribsee"><div class="search-box svelte-1ribsee"><input type="text" class="search-input svelte-1ribsee" placeholder="Search messages..."/> <!> <button class="search-btn svelte-1ribsee"> </button></div> <!></div></div> <!></div>');function Is(tt,st){Nt(st,!0);let z=h(null),$e=h(!0),oe=h(!1),F=h(null),K=h(Ee([])),ne=h(0),Be=h(0),je=h(0),U=h(""),ve=h(!1),q=h(Ee([])),W=h(!1),H=h(""),J=h(""),c=h("linear"),ge=h("3"),ce=h("ai-task"),de=h("stream:cash-engine"),ye=h("general"),Y=h("CC-orchestrator"),$=h(Ee([])),pe=h(!1),V=h(!1),L=null,xe=h(!1);const at=[{id:"CC-orchestrator",name:"Claude Orchestrator"},{id:"OC-orchestrator",name:"OpenCode Orchestrator"},{id:"GE-orchestrator",name:"Gemini Orchestrator"},{id:"CX-orchestrator",name:"Codex Orchestrator"},{id:"all-orchestrators",name:"All Orchestrators"},{id:"all-builders",name:"All Builders"}];function rt(l){const b=l.target;b.files&&r($,[...e($),...Array.from(b.files)],!0)}function it(l){l.preventDefault(),r(pe,!1),l.dataTransfer?.files&&r($,[...e($),...Array.from(l.dataTransfer.files)],!0)}function lt(l){r($,e($).filter((b,d)=>d!==l),!0)}Ft(()=>{if((e(c)==="linear"||e(c)==="both")&&e(H)&&!e(J)){const l=e(H).split(`
`)[0];l.length<=80&&r(J,l,!0)}});async function ot(){if(!e(H).trim()&&e($).length===0||(e(c)==="linear"||e(c)==="both")&&!e(J).trim())return;r(oe,!0),r(F,null);let l=e(H);e($).length>0&&(l+=`

Attachments:
`+e($).map(_=>`- ${_.name}`).join(`
`));const b=new Set;e(ce).trim()&&b.add(e(ce).trim()),e(de).trim()&&b.add(e(de).trim());const d=Array.from(b),k=[];let S=!1;try{if(e(c)==="linear"||e(c)==="both"){const _=await fetch("/api/jobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",title:e(J),description:l,priority:parseInt(e(ge)),labels:d})}),M=await _.json();_.ok&&M.success?k.push(`Linear: ${M.issue?.identifier||"Created"}`):(k.push(`Linear: ${M.error||"Failed"}`),S=!0)}if((e(c)==="blackboard"||e(c)==="both")&&((await fetch("/api/comms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent:"human",topic:e(ye),message:e(c)==="both"?`[${e(J)}] ${l}`:l})})).ok?(k.push("Blackboard: Sent"),await _e()):(k.push("Blackboard: Failed"),S=!0)),e(c)==="agent"){const _=`@${e(Y)}: ${l}`;(await fetch("/api/comms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent:"human",topic:"direct",message:_})})).ok?(k.push(`Sent to ${e(Y)}`),await _e()):(k.push("Agent message: Failed"),S=!0)}r(F,{text:k.join(" | "),type:S?"error":"success"},!0),S||(r(H,""),r(J,""),r($,[],!0))}catch{r(F,{text:"Connection failed",type:"error"},!0)}finally{r(oe,!1),setTimeout(()=>r(F,null),5e3)}}async function _e(){try{const d=((await(await fetch("/api/comms?limit=50")).json()).messages??[]).map(_=>({..._,time:_.time||_.timestamp||""})),k={},S={};for(const _ of d){const M=_.topic||"general",ee=_.agent||"unknown";k[M]=(k[M]||0)+1,S[ee]=(S[ee]||0)+1}r(z,{messages:d,stats:{total:d.length,by_topic:k,by_agent:S}},!0),r(K,d.filter(_=>_.topic==="alerts"||_.topic==="critical"),!0),r(ne,e(K).length,!0),r(Be,e(K).filter(_=>_.topic==="critical").length,!0),r(je,e(K).filter(_=>_.message.toLowerCase().includes("early exit")).length,!0)}catch(l){console.error("Failed to fetch:",l)}finally{r($e,!1)}}async function Le(){if(!e(U).trim()){ue();return}r(ve,!0),r(W,!0);try{const b=await(await fetch(`/api/comms?search=${encodeURIComponent(e(U))}&limit=50`)).json();r(q,b.messages.filter(d=>!d.raw).map(d=>({time:d.timestamp,agent:d.agent,topic:d.topic,message:d.message})),!0)}catch(l){console.error("Search failed:",l),r(q,[],!0)}finally{r(ve,!1)}}function ue(){r(U,""),r(q,[],!0),r(W,!1)}function nt(l){l.key==="Enter"?Le():l.key==="Escape"&&ue()}function vt(){const l=window.SpeechRecognition||window.webkitSpeechRecognition;if(!l){r(xe,!1);return}r(xe,!0),L=new l,L.continuous=!0,L.interimResults=!0,L.lang="en-US";let b="";L.onresult=d=>{let k="";for(let S=d.resultIndex;S<d.results.length;S++){const _=d.results[S][0].transcript;d.results[S].isFinal?b+=_+" ":k+=_}r(H,b+k)},L.onerror=d=>{console.error("STT error:",d.error),r(V,!1),d.error==="not-allowed"&&(r(F,{text:"Microphone access denied",type:"error"},!0),setTimeout(()=>r(F,null),3e3))},L.onend=()=>{e(V)&&L.start()}}function ct(){L&&(e(V)?(L.stop(),r(V,!1)):(L.start(),r(V,!0)))}Dt(()=>{_e(),vt();const l=setInterval(_e,15e3);return()=>clearInterval(l)});var ke=fs(),Se=a(ke),Me=s(a(Se),2),we=a(Me),be=a(we);Ye(be),be.__keydown=nt;var De=s(be,2);{var dt=l=>{var b=Vt();b.__click=ue,f(l,b)};T(De,l=>{e(U)&&l(dt)})}var fe=s(De,2);fe.__click=Le;var pt=a(fe,!0);t(fe),t(we);var _t=s(we,2);{var ut=l=>{var b=Xt(),d=a(b);t(b),R(()=>g(d,`${e(z).stats.total??""} messages`)),f(l,b)};T(_t,l=>{e(z)&&l(ut)})}t(Me),t(Se);var bt=s(Se,2);{var ft=l=>{var b=Zt();f(l,b)},mt=l=>{var b=bs(),d=a(b),k=a(d),S=a(k);let _;S.__click=()=>r(c,"linear");var M=s(S,2);let ee;M.__click=()=>r(c,"blackboard");var Ce=s(M,2);let Ne;Ce.__click=()=>r(c,"both");var Fe=s(Ce,2);let Ge;Fe.__click=()=>r(c,"agent"),t(k);var He=s(k,2);{var ht=i=>{var o=Kt();re(o,21,()=>at,ie,(n,u)=>{var v=zt(),y=a(v,!0);t(v);var p={};R(()=>{g(y,e(u).name),p!==(p=e(u).id)&&(v.value=(v.__value=e(u).id)??"")}),f(n,v)}),t(o),le(o,()=>e(Y),n=>r(Y,n)),f(i,o)};T(He,i=>{e(c)==="agent"&&i(ht)})}var Je=s(He,2);{var gt=i=>{var o=Qt();Ye(o),Re(o,()=>e(J),n=>r(J,n)),f(i,o)};T(Je,i=>{(e(c)==="linear"||e(c)==="both")&&i(gt)})}var Te=s(Je,2),me=a(Te);Ht(me);var Pe=s(me,2),Ue=a(Pe);{var yt=i=>{var o=Yt();let n;o.__click=ct;var u=a(o);{var v=p=>{var x=qt();f(p,x)},y=p=>{var x=Wt();f(p,x)};T(u,p=>{e(V)?p(v):p(y,!1)})}t(o),R(()=>{n=G(o,1,"mic-btn svelte-1ribsee",null,n,{recording:e(V)}),et(o,"title",e(V)?"Stop recording":"Start voice input")}),f(i,o)};T(Ue,i=>{e(xe)&&i(yt)})}var X=s(Ue,2);let Ve;X.__click=()=>document.getElementById("file-upload")?.click(),X.__keydown=i=>i.key==="Enter"&&document.getElementById("file-upload")?.click();var xt=a(X);xt.__change=rt,Jt(2),t(X),t(Pe),t(Te);var Xe=s(Te,2);{var kt=i=>{var o=ts();re(o,21,()=>e($),ie,(n,u,v)=>{var y=es(),p=a(y),x=a(p,!0);t(p);var E=s(p,2);E.__click=()=>lt(v),t(y),R(()=>g(x,e(u).name)),f(n,y)}),t(o),f(i,o)};T(Xe,i=>{e($).length>0&&i(kt)})}var Ae=s(Xe,2),Ze=a(Ae);{var St=i=>{var o=ss(),n=Pt(o),u=a(n);u.value=u.__value="stream:cash-engine";var v=s(u);v.value=v.__value="stream:asset-engine";var y=s(v);y.value=y.__value="stream:apps",t(n);var p=s(n,2),x=a(p);x.value=x.__value="1";var E=s(x);E.value=E.__value="2";var w=s(E);w.value=w.__value="3";var C=s(w);C.value=C.__value="4",t(p);var B=s(p,2),O=a(B);O.value=O.__value="ai-task";var D=s(O);D.value=D.__value="human-task";var j=s(D);j.value=j.__value="bug";var N=s(j);N.value=N.__value="feature";var A=s(N);A.value=A.__value="GIN-DEV";var I=s(A);I.value=I.__value="GIN-BIZ",t(B),le(n,()=>e(de),P=>r(de,P)),le(p,()=>e(ge),P=>r(ge,P)),le(B,()=>e(ce),P=>r(ce,P)),f(i,o)};T(Ze,i=>{(e(c)==="linear"||e(c)==="both")&&i(St)})}var ze=s(Ze,2);{var wt=i=>{var o=as(),n=a(o);n.value=n.__value="general";var u=s(n);u.value=u.__value="ideas";var v=s(u);v.value=v.__value="bugs";var y=s(v);y.value=y.__value="help",t(o),le(o,()=>e(ye),p=>r(ye,p)),f(i,o)};T(ze,i=>{(e(c)==="blackboard"||e(c)==="both")&&i(wt)})}var he=s(ze,4);he.__click=ot;var Ct=a(he,!0);t(he),t(Ae);var Tt=s(Ae,2);{var At=i=>{var o=rs();let n;var u=a(o,!0);t(o),R(()=>{n=G(o,1,"status svelte-1ribsee",null,n,{success:e(F).type==="success",error:e(F).type==="error"}),g(u,e(F).text)}),f(i,o)};T(Tt,i=>{e(F)&&i(At)})}t(d);var Ke=s(d,2);{var It=i=>{var o=ns(),n=a(o),u=a(n),v=a(u);t(u);var y=s(u,2);y.__click=ue,t(n);var p=s(n,2);{var x=w=>{var C=is(),B=a(C);t(C),R(()=>g(B,`No messages found matching "${e(U)??""}"`)),f(w,C)},E=w=>{var C=os();re(C,21,()=>e(q),ie,(B,O)=>{var D=ls(),j=a(D),N=a(j),A=a(N,!0);t(N);var I=s(N,2),P=a(I);t(I);var Z=s(I,2),Q=a(Z,!0);t(Z),t(j);var te=s(j,2),se=a(te,!0);t(te),t(D),R(ae=>{g(A,e(O).agent),g(P,`#${e(O).topic??""}`),g(Q,ae),g(se,e(O).message)},[()=>e(O).time?.slice(11,16)||""]),f(B,D)}),t(C),f(w,C)};T(p,w=>{e(q).length===0?w(x):w(E,!1)})}t(o),R(()=>g(v,`Search Results for "${e(U)??""}"`)),f(i,o)};T(Ke,i=>{e(W)&&i(It)})}var Qe=s(Ke,2);{var Et=i=>{var o=ps();let n;var u=a(o),v=s(a(u),2),y=a(v);t(v),t(u);var p=s(u,2),x=a(p),E=a(x);t(x);var w=s(x,2),C=a(w);t(w);var B=s(w,2),O=a(B);t(B),t(p);var D=s(p,2);{var j=A=>{var I=vs();f(A,I)},N=A=>{var I=ds();re(I,21,()=>e(K).slice(0,6),ie,(P,Z)=>{var Q=cs();let te;var se=a(Q),ae=a(se),$t=a(ae,!0);t(ae);var Ie=s(ae,2),Bt=a(Ie);t(Ie);var qe=s(Ie,2),jt=a(qe,!0);t(qe),t(se);var We=s(se,2),Lt=a(We,!0);t(We),t(Q),R(Mt=>{te=G(Q,1,"alert-item svelte-1ribsee",null,te,{critical:e(Z).topic==="critical"}),g($t,e(Z).agent),g(Bt,`#${e(Z).topic??""}`),g(jt,Mt),g(Lt,e(Z).message)},[()=>e(Z).time.slice(11,19)]),f(P,Q)}),t(I),f(A,I)};T(D,A=>{e(K).length===0?A(j):A(N,!1)})}t(o),R(()=>{n=G(o,1,"card alert-card svelte-1ribsee",null,n,{active:e(ne)>0}),g(y,`${e(ne)??""} in last 50`),g(E,`Alerts: ${e(ne)??""}`),g(C,`Critical: ${e(Be)??""}`),g(O,`Early Exits: ${e(je)??""}`)}),f(i,o)};T(Qe,i=>{e(W)||i(Et)})}var Ot=s(Qe,2);{var Rt=i=>{var o=us(),n=s(a(o),2);re(n,21,()=>e(z).messages,ie,(u,v)=>{var y=_s();let p;var x=a(y),E=a(x),w=a(E,!0);t(E);var C=s(E,2),B=a(C);t(C);var O=s(C,2),D=a(O,!0);t(O),t(x);var j=s(x,2),N=a(j,!0);t(j),t(y),R((A,I)=>{p=G(y,1,"msg svelte-1ribsee",null,p,A),g(w,e(v).agent),g(B,`#${e(v).topic??""}`),g(D,I),g(N,e(v).message)},[()=>({alert:e(v).topic==="alerts",critical:e(v).topic==="critical","early-exit":e(v).message.toLowerCase().includes("early exit")}),()=>e(v).time.slice(11,19)]),f(u,y)}),t(n),t(o),f(i,o)};T(Ot,i=>{!e(W)&&e(z)&&e(z).messages.length>0&&i(Rt)})}t(b),R(i=>{_=G(S,1,"dest-tab svelte-1ribsee",null,_,{active:e(c)==="linear"}),ee=G(M,1,"dest-tab svelte-1ribsee",null,ee,{active:e(c)==="blackboard"}),Ne=G(Ce,1,"dest-tab svelte-1ribsee",null,Ne,{active:e(c)==="both"}),Ge=G(Fe,1,"dest-tab svelte-1ribsee",null,Ge,{active:e(c)==="agent"}),et(me,"placeholder",e(c)==="agent"?`Message to ${e(Y)}...`:e(c)==="blackboard"?"Message to agents...":"Description..."),Ve=G(X,1,"drop-zone svelte-1ribsee",null,Ve,{dragging:e(pe)}),he.disabled=i,g(Ct,e(oe)?"Sending...":"Send")},[()=>e(oe)||!e(H).trim()||(e(c)==="linear"||e(c)==="both")&&!e(J).trim()]),Re(me,()=>e(H),i=>r(H,i)),Oe("dragover",X,i=>{i.preventDefault(),r(pe,!0)}),Oe("dragleave",X,()=>r(pe,!1)),Oe("drop",X,i=>it(i)),f(l,b)};T(bt,l=>{e($e)?l(ft):l(mt,!1)})}t(ke),R(()=>{fe.disabled=e(ve),g(pt,e(ve)?"...":"SEARCH")}),Re(be,()=>e(U),l=>r(U,l)),f(tt,ke),Gt()}Ut(["keydown","click","change"]);export{Is as component};
