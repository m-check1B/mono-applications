import{f as c,a as d,c as Ja}from"../chunks/CZY_NlAX.js";import{o as Xa}from"../chunks/BHyL2apj.js";import{ag as Za,aj as k,ap as sa,al as e,an as S,ai as at,G as f,ak as t,am as a,m as s,ah as ha,ao as R,aq as tt}from"../chunks/CHIrzwsT.js";import{s as l}from"../chunks/DsvTbyZG.js";import{i as x}from"../chunks/DNv7RG3c.js";import{e as ea,i as na}from"../chunks/De-eo5w8.js";import{s as m}from"../chunks/Bf116p4L.js";import{s as st}from"../chunks/U6XQp83X.js";import{d as et}from"../chunks/CaHQap0G.js";import{s as ra}from"../chunks/CuoGBMhC.js";var nt=c('<div class="loading svelte-8nqzdj">LOADING_CRM_DATA...</div>'),rt=c('<p class="error-detail svelte-8nqzdj"> </p>'),vt=c('<div class="offline-notice svelte-8nqzdj"><h3 class="svelte-8nqzdj">ESPOCRM IS OFFLINE</h3> <p>Start EspoCRM to see customer data:</p> <code class="svelte-8nqzdj">cd /github/tools/crm && docker compose up -d</code> <!></div>'),lt=c('<div class="card span-2 svelte-8nqzdj"><h3 class="svelte-8nqzdj">OVERVIEW</h3> <div class="stats-grid svelte-8nqzdj"><div class="stat-item svelte-8nqzdj"><span class="stat-value svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">LEADS</span></div> <div class="stat-item svelte-8nqzdj"><span class="stat-value svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">CONTACTS</span></div> <div class="stat-item svelte-8nqzdj"><span class="stat-value svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">ACCOUNTS</span></div> <div class="stat-item svelte-8nqzdj"><span class="stat-value svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">OPPORTUNITIES</span></div> <div class="stat-item svelte-8nqzdj"><span class="stat-value svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">TASKS</span></div> <div class="stat-item svelte-8nqzdj"><span class="stat-value green svelte-8nqzdj"> </span> <span class="stat-label svelte-8nqzdj">PIPELINE VALUE</span></div></div></div>'),it=c('<div class="empty svelte-8nqzdj">NO LEADS</div>'),dt=c('<a target="_blank" class="list-item svelte-8nqzdj"><div class="item-main svelte-8nqzdj"><span class="item-name svelte-8nqzdj"> </span> <span class="item-meta svelte-8nqzdj"> </span></div> <span class="status-tag svelte-8nqzdj"> </span></a>'),ot=c('<div class="list svelte-8nqzdj"></div>'),ct=c('<div class="empty svelte-8nqzdj">NO OPEN OPPORTUNITIES</div>'),pt=c('<a target="_blank" class="list-item svelte-8nqzdj"><div class="item-main svelte-8nqzdj"><span class="item-name svelte-8nqzdj"> </span> <span class="item-meta svelte-8nqzdj"> </span></div> <div class="opp-values svelte-8nqzdj"><span class="opp-amount svelte-8nqzdj"> </span> <span class="status-tag svelte-8nqzdj"> </span></div></a>'),_t=c('<div class="list svelte-8nqzdj"></div>'),ut=c('<div class="empty svelte-8nqzdj">NO PENDING TASKS</div>'),mt=c('<span class="task-parent svelte-8nqzdj"> </span>'),ft=c('<a target="_blank" class="task-item svelte-8nqzdj"><span class="task-priority svelte-8nqzdj"> </span> <div class="task-main svelte-8nqzdj"><span class="task-name svelte-8nqzdj"> </span> <!></div> <div class="task-due svelte-8nqzdj"> </div> <span class="task-status svelte-8nqzdj"> </span></a>'),jt=c('<div class="task-list svelte-8nqzdj"></div>'),qt=c('<div class="last-updated svelte-8nqzdj"> </div>'),zt=c('<div class="crm-grid svelte-8nqzdj"><!> <div class="card svelte-8nqzdj"><h3 class="svelte-8nqzdj">RECENT LEADS</h3> <!> <a target="_blank" class="brutal-btn view-all svelte-8nqzdj">VIEW ALL LEADS</a></div> <div class="card svelte-8nqzdj"><h3 class="svelte-8nqzdj">OPEN OPPORTUNITIES</h3> <!> <a target="_blank" class="brutal-btn view-all svelte-8nqzdj">VIEW ALL OPPORTUNITIES</a></div> <div class="card span-2 svelte-8nqzdj"><h3 class="svelte-8nqzdj">PENDING TASKS</h3> <!> <a target="_blank" class="brutal-btn view-all svelte-8nqzdj">VIEW ALL TASKS</a></div> <div class="card span-2 svelte-8nqzdj"><h3 class="svelte-8nqzdj">QUICK ACTIONS</h3> <div class="actions-grid svelte-8nqzdj"><a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">+</span> <span>NEW LEAD</span></a> <a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">+</span> <span>NEW CONTACT</span></a> <a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">+</span> <span>NEW OPPORTUNITY</span></a> <a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">+</span> <span>NEW TASK</span></a> <a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">+</span> <span>NEW MEETING</span></a> <a target="_blank" class="action-btn svelte-8nqzdj"><span class="action-icon svelte-8nqzdj">@</span> <span>EMAILS</span></a></div></div></div> <!>',1),gt=c('<div class="page svelte-8nqzdj"><div class="page-header svelte-8nqzdj"><h2 class="glitch">CRM // Customer Relations</h2> <div style="display: flex; gap: 12px; align-items: center;"><span> </span> <a target="_blank" class="brutal-btn">OPEN CRM</a> <button class="brutal-btn"> </button></div></div> <!></div>');function Tt(ba,Ea){Za(Ea,!0);let y=k(!1),O=k(null),Y=k(sa([])),F=k(sa([])),$=k(sa([])),w=k(!0),D=k(null),B=k(null);const Na="http://127.0.0.1:8080",xa={New:"var(--cyan-data, #00d4ff)",Assigned:"var(--terminal-green)","In Process":"var(--warning, #ffaa00)",Converted:"var(--terminal-green)",Dead:"var(--text-muted)",Recycled:"#888"},Oa={Prospecting:"var(--cyan-data, #00d4ff)",Qualification:"var(--cyan-data, #00d4ff)",Proposal:"var(--warning, #ffaa00)",Negotiation:"var(--warning, #ffaa00)","Closed Won":"var(--terminal-green)","Closed Lost":"#ff5555"},Ia={Low:"var(--text-muted)",Normal:"var(--text-main)",High:"var(--warning, #ffaa00)",Urgent:"#ff5555"};async function J(){f(w,!0),f(D,null);try{const i=await fetch("/api/crm");if(!i.ok)throw new Error("Failed to fetch CRM data");const p=await i.json();f(y,p.online,!0),f(O,p.stats,!0),f(Y,p.leads||[],!0),f(F,p.opportunities||[],!0),f($,p.tasks||[],!0),f(B,p.lastUpdated,!0),p.error&&f(D,p.error,!0)}catch(i){f(D,i instanceof Error?i.message:"Unknown error",!0),f(y,!1)}finally{f(w,!1)}}function va(i){return i?new Date(i).toLocaleDateString():"-"}function la(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format(i)}const ka=tt(()=>s(F).reduce((i,p)=>i+p.amount*p.probability/100,0));Xa(()=>{J();const i=setInterval(J,6e4);return()=>clearInterval(i)});var X=gt(),Z=t(X),ia=e(t(Z),2),V=t(ia);let da;var Sa=t(V,!0);a(V);var oa=e(V,2);m(oa,"href",Na);var G=e(oa,2);G.__click=J;var La=t(G,!0);a(G),a(ia),a(Z);var Ta=e(Z,2);{var ya=i=>{var p=nt();d(i,p)},Ca=i=>{var p=Ja(),Aa=ha(p);{var Pa=C=>{var A=vt(),U=e(t(A),6);{var K=M=>{var L=rt(),H=t(L,!0);a(L),S(()=>l(H,s(D))),d(M,L)};x(U,M=>{s(D)&&M(K)})}a(A),d(C,A)},Ra=C=>{var A=zt(),U=ha(A),K=t(U);{var M=r=>{var v=lt(),z=e(t(v),2),n=t(z),o=t(n),_=t(o,!0);a(o),R(2),a(n);var u=e(n,2),g=t(u),j=t(g,!0);a(g),R(2),a(u);var b=e(u,2),q=t(b),E=t(q,!0);a(q),R(2),a(b);var N=e(b,2),I=t(N),P=t(I,!0);a(I),R(2),a(N);var T=e(N,2),h=t(T),W=t(h,!0);a(h),R(2),a(T);var Q=e(T,2),ga=t(Q),$a=t(ga,!0);a(ga),R(2),a(Q),a(z),a(v),S(Ba=>{l(_,s(O).leads),l(j,s(O).contacts),l(E,s(O).accounts),l(P,s(O).opportunities),l(W,s(O).tasks),l($a,Ba)},[()=>la(s(ka))]),d(r,v)};x(K,r=>{s(O)&&r(M)})}var L=e(K,2),H=e(t(L),2);{var wa=r=>{var v=it();d(r,v)},Da=r=>{var v=ot();ea(v,21,()=>s(Y),na,(z,n)=>{var o=dt(),_=t(o),u=t(_),g=t(u,!0);a(u);var j=e(u,2),b=t(j,!0);a(j),a(_);var q=e(_,2),E=t(q,!0);a(q),a(o),S(()=>{m(o,"href",`http://127.0.0.1:8080/#Lead/view/${s(n).id??""}`),l(g,s(n).name),l(b,s(n).source||"Unknown source"),ra(q,`background: ${(xa[s(n).status]||"#888")??""}`),l(E,s(n).status)}),d(z,o)}),a(v),d(r,v)};x(H,r=>{s(Y).length===0?r(wa):r(Da,!1)})}var Ua=e(H,2);m(Ua,"href","http://127.0.0.1:8080/#Lead"),a(L);var aa=e(L,2),ca=e(t(aa),2);{var Ma=r=>{var v=ct();d(r,v)},Wa=r=>{var v=_t();ea(v,21,()=>s(F),na,(z,n)=>{var o=pt(),_=t(o),u=t(_),g=t(u,!0);a(u);var j=e(u,2),b=t(j);a(j),a(_);var q=e(_,2),E=t(q),N=t(E,!0);a(E);var I=e(E,2),P=t(I,!0);a(I),a(q),a(o),S((T,h)=>{m(o,"href",`http://127.0.0.1:8080/#Opportunity/view/${s(n).id??""}`),l(g,s(n).name),l(b,`${(s(n).accountName||"No account")??""} - ${T??""}`),l(N,h),ra(I,`background: ${(Oa[s(n).stage]||"#888")??""}`),l(P,s(n).stage)},[()=>va(s(n).closeDate),()=>la(s(n).amount)]),d(z,o)}),a(v),d(r,v)};x(ca,r=>{s(F).length===0?r(Ma):r(Wa,!1)})}var Fa=e(ca,2);m(Fa,"href","http://127.0.0.1:8080/#Opportunity"),a(aa);var ta=e(aa,2),pa=e(t(ta),2);{var Va=r=>{var v=ut();d(r,v)},Ga=r=>{var v=jt();ea(v,21,()=>s($),na,(z,n)=>{var o=ft(),_=t(o),u=t(_,!0);a(_);var g=e(_,2),j=t(g),b=t(j,!0);a(j);var q=e(j,2);{var E=h=>{var W=mt(),Q=t(W);a(W),S(()=>l(Q,`${s(n).parentType??""}: ${s(n).parentName??""}`)),d(h,W)};x(q,h=>{s(n).parentName&&h(E)})}a(g);var N=e(g,2),I=t(N,!0);a(N);var P=e(N,2),T=t(P,!0);a(P),a(o),S(h=>{m(o,"href",`http://127.0.0.1:8080/#Task/view/${s(n).id??""}`),ra(_,`background: ${(Ia[s(n).priority]||"#888")??""}`),l(u,s(n).priority),l(b,s(n).name),l(I,h),l(T,s(n).status)},[()=>va(s(n).dateEnd)]),d(z,o)}),a(v),d(r,v)};x(pa,r=>{s($).length===0?r(Va):r(Ga,!1)})}var Ka=e(pa,2);m(Ka,"href","http://127.0.0.1:8080/#Task"),a(ta);var _a=e(ta,2),ua=e(t(_a),2),ma=t(ua);m(ma,"href","http://127.0.0.1:8080/#Lead/create");var fa=e(ma,2);m(fa,"href","http://127.0.0.1:8080/#Contact/create");var ja=e(fa,2);m(ja,"href","http://127.0.0.1:8080/#Opportunity/create");var qa=e(ja,2);m(qa,"href","http://127.0.0.1:8080/#Task/create");var za=e(qa,2);m(za,"href","http://127.0.0.1:8080/#Meeting/create");var Ha=e(za,2);m(Ha,"href","http://127.0.0.1:8080/#Email"),a(ua),a(_a),a(U);var Qa=e(U,2);{var Ya=r=>{var v=qt(),z=t(v);a(v),S(n=>l(z,`Last updated: ${n??""}`),[()=>new Date(s(B)).toLocaleString()]),d(r,v)};x(Qa,r=>{s(B)&&r(Ya)})}d(C,A)};x(Aa,C=>{s(y)?C(Ra,!1):C(Pa)},!0)}d(i,p)};x(Ta,i=>{s(w)&&!s(O)?i(ya):i(Ca,!1)})}a(X),S(()=>{da=st(V,1,"status-badge svelte-8nqzdj",null,da,{online:s(y),offline:!s(y)}),l(Sa,s(y)?"ESPOCRM ONLINE":"ESPOCRM OFFLINE"),G.disabled=s(w),l(La,s(w)?"LOADING...":"REFRESH")}),d(ba,X),at()}et(["click"]);export{Tt as component};
