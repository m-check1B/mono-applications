import{f as d,a as c,c as Re}from"../chunks/CZY_NlAX.js";import{o as We}from"../chunks/BHyL2apj.js";import{ag as Qe,aj as I,ap as Ae,ai as Je,al as t,ak as s,m as e,am as a,G as u,an as f,ah as ie,ao as G,aq as Te,ar as Xe}from"../chunks/CHIrzwsT.js";import{s as r}from"../chunks/DsvTbyZG.js";import{i as g}from"../chunks/DNv7RG3c.js";import{e as _e,i as pe}from"../chunks/De-eo5w8.js";import{r as Ze}from"../chunks/Bf116p4L.js";import{s as Q}from"../chunks/U6XQp83X.js";import{d as ea}from"../chunks/CaHQap0G.js";import{b as aa}from"../chunks/C8UA6rw1.js";var sa=d('<div style="display: flex; gap: 12px; align-items: center;"><span class="pulse-dot green"></span> <span class="updated"> </span></div>'),ta=d('<div class="loading">RETRIEVING_NEURAL_PATTERNS...</div>'),ia=d('<div class="card error-card svelte-1h3yci6"><h2 style="color: var(--system-red);" class="svelte-1h3yci6">CONNECTION_FAILED</h2> <p> </p> <p class="hint svelte-1h3yci6">Ensure Recall service is active on port 3020.</p></div>'),ra=d('<div class="stat-card svelte-1h3yci6"><span class="stat-value svelte-1h3yci6"> </span> <span class="stat-label svelte-1h3yci6">STORES</span></div> <div class="stat-card svelte-1h3yci6"><span class="stat-value svelte-1h3yci6"> </span> <span class="stat-label svelte-1h3yci6">RETRIEVES</span></div> <div class="stat-card svelte-1h3yci6"><span class="stat-value svelte-1h3yci6"> </span> <span class="stat-label svelte-1h3yci6">ACTIVE_AGENTS</span></div>',1),la=d('<div><span> </span> <span class="stat-label svelte-1h3yci6">EPHEMERAL_FILES</span></div>'),va=d('<div><span> </span> <button class="dismiss-btn svelte-1h3yci6">DISMISS</button></div>'),na=d('<div class="merge-item svelte-1h3yci6"><span class="merge-target svelte-1h3yci6"> </span> <span class="merge-info svelte-1h3yci6"> </span></div>'),ca=d('<div class="merge-item more svelte-1h3yci6"> </div>'),oa=d('<div class="consolidation-details svelte-1h3yci6"><div class="detail-summary svelte-1h3yci6"><span class="detail-item svelte-1h3yci6"><span class="detail-value svelte-1h3yci6"> </span> <span class="detail-label svelte-1h3yci6">MEMORIES_TO_MOVE</span></span> <span class="detail-item svelte-1h3yci6"><span class="detail-value svelte-1h3yci6"> </span> <span class="detail-label svelte-1h3yci6">TARGET_FILES</span></span></div> <div class="consolidation-list svelte-1h3yci6"><h3 class="svelte-1h3yci6">MERGE_TARGETS:</h3> <!> <!></div></div>'),da=d('<div class="card consolidation-card svelte-1h3yci6"><div class="consolidation-header svelte-1h3yci6"><div><h2 class="svelte-1h3yci6"> </h2> <p class="hint svelte-1h3yci6">Merge ephemeral agent memories (CC-builder-08:30.26.12.AA) into role-based files (CC-builder) for better recall.</p></div> <div class="consolidation-actions svelte-1h3yci6"><button class="brutal-btn toggle-btn svelte-1h3yci6"> </button> <button class="brutal-btn execute-btn svelte-1h3yci6"> </button></div></div> <!> <!></div>'),_a=d('<div class="agent-row-recall svelte-1h3yci6"><span class="agent-name svelte-1h3yci6"> </span> <div class="agent-ops svelte-1h3yci6"><span class="store-count svelte-1h3yci6"> </span> <span class="retrieve-count svelte-1h3yci6"> </span></div></div>'),pa=d('<div class="card svelte-1h3yci6"><h2 class="svelte-1h3yci6">RECALL_USAGE // BY_AGENT</h2> <div class="agent-stats svelte-1h3yci6"></div></div>'),ha=d('<p class="hint svelte-1h3yci6"> </p>'),ua=d('<p class="hint svelte-1h3yci6">No recent recall operations detected in this sector.</p>'),ya=d('<div class="entry-text svelte-1h3yci6"> </div>'),ma=d('<div class="entry-size svelte-1h3yci6"> </div>'),fa=d('<div><div class="entry-header svelte-1h3yci6"><span> </span> <span class="entry-agent svelte-1h3yci6"> </span> <span class="entry-time svelte-1h3yci6"> </span></div> <div class="entry-key svelte-1h3yci6"> </div> <!> <!></div>'),ga=d('<div class="entries-list svelte-1h3yci6"></div>'),Ea=d('<div class="stats-grid svelte-1h3yci6"><!> <!></div> <!> <!> <div class="card svelte-1h3yci6"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;"><h2 style="margin: 0;" class="svelte-1h3yci6">RECENT_OPERATIONS // RECALL_STREAM</h2> <input type="text" placeholder="SEARCH_RECALL..." class="search-input svelte-1h3yci6"/></div> <!></div>',1),xa=d('<div class="page svelte-1h3yci6"><div class="page-header svelte-1h3yci6"><h2 class="glitch">Recall // Agent Knowledge Base</h2> <!></div> <!></div>');function wa(Ce,Se){Qe(Se,!0);let J=I(Ae([])),L=I(null),Ie=I(Ae([])),Oe=I(0),he=I(!0),B=I(null),F=I(""),E=I(null),X=I(!1),k=I(null),Z=I(!1);const Le="/api/memory",ue="/api/memory/consolidate";async function re(){try{const i=await fetch(Le);if(i.ok){const l=await i.json();u(J,l.entries||[],!0),u(L,l.stats||null,!0),u(Ie,l.inactiveAgents||[],!0),u(Oe,l.knownAgents?.length||0,!0),u(B,l.error||null,!0)}else u(B,"Failed to fetch recall data")}catch{u(B,"Recall by Kraliki service unavailable")}finally{u(he,!1)}}async function ye(){try{const i=await fetch(ue);if(i.ok){const l=await i.json();l.success&&u(E,l.plan,!0)}}catch{}}async function Ne(){u(X,!0),u(k,null);try{const l=await(await fetch(ue,{method:"POST"})).json();u(k,l,!0),l.success&&(await re(),await ye())}catch{u(k,{success:!1,message:"Failed to execute consolidation"},!0)}finally{u(X,!1)}}function we(){u(k,null)}let me=Te(()=>e(F).trim()===""?e(J):e(J).filter(i=>{const l=e(F).toLowerCase();return i.agent.toLowerCase().includes(l)||i.key.toLowerCase().includes(l)||i.text&&i.text.toLowerCase().includes(l)}));We(()=>{re(),ye();const i=setInterval(re,3e4);return()=>clearInterval(i)});var le=xa(),ve=s(le),ke=t(s(ve),2);{var Me=i=>{var l=sa(),ee=t(s(l),2),ne=s(ee);a(ee),a(l),f(()=>r(ne,`${e(L).total_entries??""} ENTRIES_STORED`)),c(i,l)};g(ke,i=>{e(L)&&i(Me)})}a(ve);var De=t(ve,2);{var Ge=i=>{var l=ta();c(i,l)},Pe=i=>{var l=Re(),ee=ie(l);{var ne=U=>{var V=ia(),$=t(s(V),2),ae=s($,!0);a($),G(2),a(V),f(()=>r(ae,e(B))),c(U,V)},je=U=>{var V=Ea(),$=ie(V),ae=s($);{var Fe=v=>{var n=ra(),_=ie(n),p=s(_),m=s(p,!0);a(p),G(2),a(_);var h=t(_,2),x=s(h),T=s(x,!0);a(x),G(2),a(h);var o=t(h,2),y=s(o),M=s(y,!0);a(y),G(2),a(o),f(C=>{r(m,e(L).total_stores),r(T,e(L).total_retrieves),r(M,C)},[()=>Object.keys(e(L).by_agent).length]),c(v,n)};g(ae,v=>{e(L)&&v(Fe)})}var Ue=t(ae,2);{var Ve=v=>{var n=la();let _;var p=s(n);let m;var h=s(p,!0);a(p),G(2),a(n),f(()=>{_=Q(n,1,"stat-card svelte-1h3yci6",null,_,{alert:e(E).ephemeral_files>5}),m=Q(p,1,"stat-value svelte-1h3yci6",null,m,{yellow:e(E).ephemeral_files>5}),r(h,e(E).ephemeral_files)}),c(v,n)};g(Ue,v=>{e(E)&&v(Ve)})}a($);var fe=t($,2);{var $e=v=>{var n=da(),_=s(n),p=s(_),m=s(p),h=s(m);a(m),G(2),a(p);var x=t(p,2),T=s(x);T.__click=()=>u(Z,!e(Z));var o=s(T);a(T);var y=t(T,2);y.__click=Ne;var M=s(y,!0);a(y),a(x),a(_);var C=t(_,2);{var O=b=>{var R=va();let N;var w=s(R),D=s(w,!0);a(w);var Y=t(w,2);Y.__click=we,a(R),f(()=>{N=Q(R,1,"result-banner svelte-1h3yci6",null,N,{success:e(k).success,failure:!e(k).success}),r(D,e(k).message)}),c(b,R)};g(C,b=>{e(k)&&b(O)})}var H=t(C,2);{var z=b=>{var R=oa(),N=s(R),w=s(N),D=s(w),Y=s(D,!0);a(D),G(2),a(w);var q=t(w,2),se=s(q),oe=s(se,!0);a(se),G(2),a(q),a(N);var te=t(N,2),A=t(s(te),2);_e(A,17,()=>e(E).consolidations.slice(0,10),pe,(K,j)=>{var W=na(),de=s(W),qe=s(de,!0);a(de);var be=t(de,2),Ke=s(be);a(be),a(W),f(()=>{r(qe,e(j).target),r(Ke,`${e(j).sources??""} sources / ${e(j).memories??""} memories`)}),c(K,W)});var S=t(A,2);{var P=K=>{var j=ca(),W=s(j);a(j),f(()=>r(W,`... and ${e(E).consolidations.length-10} more targets`)),c(K,j)};g(S,K=>{e(E).consolidations.length>10&&K(P)})}a(te),a(R),f(()=>{r(Y,e(E).memories_to_move),r(oe,e(E).target_files)}),c(b,R)};g(H,b=>{e(Z)&&b(z)})}a(n),f(()=>{r(h,`RECALL_CONSOLIDATION // ${e(E).ephemeral_files??""} FILES_TO_MERGE`),r(o,`${e(Z)?"HIDE":"SHOW"} PLAN`),y.disabled=e(X),r(M,e(X)?"CONSOLIDATING...":"CONSOLIDATE_NOW")}),c(v,n)};g(fe,v=>{e(E)&&e(E).ephemeral_files>0&&v($e)})}var ge=t(fe,2);{var He=v=>{var n=pa(),_=t(s(n),2);_e(_,21,()=>Object.entries(e(L).by_agent).sort((p,m)=>m[1].stores+m[1].retrieves-(p[1].stores+p[1].retrieves)),pe,(p,m)=>{var h=Te(()=>Xe(e(m),2));let x=()=>e(h)[0],T=()=>e(h)[1];var o=_a(),y=s(o),M=s(y,!0);a(y);var C=t(y,2),O=s(C),H=s(O);a(O);var z=t(O,2),b=s(z);a(z),a(C),a(o),f(R=>{r(M,R),r(H,`${T().stores??""} STORES`),r(b,`${T().retrieves??""} RETRIEVES`)},[()=>x().toUpperCase()]),c(p,o)}),a(_),a(n),c(v,n)};g(ge,v=>{e(L)&&v(He)})}var Ee=t(ge,2),ce=s(Ee),xe=t(s(ce),2);Ze(xe),a(ce);var ze=t(ce,2);{var Be=v=>{var n=ha(),_=s(n);a(n),f(()=>r(_,`No recall entries found matching "${e(F)??""}"`)),c(v,n)},Ye=v=>{var n=Re(),_=ie(n);{var p=h=>{var x=ua();c(h,x)},m=h=>{var x=ga();_e(x,21,()=>e(me),pe,(T,o)=>{var y=fa();let M;var C=s(y),O=s(C);let H;var z=s(O,!0);a(O);var b=t(O,2),R=s(b,!0);a(b);var N=t(b,2),w=s(N);a(N),a(C);var D=t(C,2),Y=s(D,!0);a(D);var q=t(D,2);{var se=A=>{var S=ya(),P=s(S,!0);a(S),f(()=>r(P,e(o).text)),c(A,S)};g(q,A=>{e(o).text&&A(se)})}var oe=t(q,2);{var te=A=>{var S=ma(),P=s(S);a(S),f(()=>r(P,`${e(o).size??""} BYTES_COMMITTED`)),c(A,S)};g(oe,A=>{e(o).size&&A(te)})}a(y),f((A,S,P)=>{M=Q(y,1,"entry svelte-1h3yci6",null,M,{store:e(o).action==="store",retrieve:e(o).action==="retrieve"}),H=Q(O,1,"entry-action svelte-1h3yci6",null,H,{store:e(o).action==="store",retrieve:e(o).action==="retrieve"}),r(z,A),r(R,S),r(w,`[${P??""}]`),r(Y,e(o).key)},[()=>e(o).action.toUpperCase(),()=>e(o).agent.toUpperCase(),()=>e(o).timestamp.slice(11,19)]),c(T,y)}),a(x),c(h,x)};g(_,h=>{e(J).length===0?h(p):h(m,!1)},!0)}c(v,n)};g(ze,v=>{e(me).length===0&&e(F).trim()!==""?v(Be):v(Ye,!1)})}a(Ee),aa(xe,()=>e(F),v=>u(F,v)),c(U,V)};g(ee,U=>{e(B)?U(ne):U(je,!1)},!0)}c(i,l)};g(De,i=>{e(he)?i(Ge):i(Pe,!1)})}a(le),c(Ce,le),Je()}ea(["click"]);export{wa as component};
