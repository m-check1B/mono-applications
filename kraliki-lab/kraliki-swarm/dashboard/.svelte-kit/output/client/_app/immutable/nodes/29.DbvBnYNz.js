import{f as y,a as w}from"../chunks/CZY_NlAX.js";import"../chunks/D1Luo-Nw.js";import{ag as j,G as N,aj as W,ak as n,am as s,al as v,m as E,an as R,ai as B,ao as F,e as Y,at as q}from"../chunks/CHIrzwsT.js";import{s as J}from"../chunks/DsvTbyZG.js";import{e as H}from"../chunks/De-eo5w8.js";import{h as Q}from"../chunks/B8M2gzuG.js";import{d as G}from"../chunks/CaHQap0G.js";import{i as Z}from"../chunks/DNR7sn_e.js";import{s as ee,a as te}from"../chunks/CKCuCExv.js";import{_ as K}from"../chunks/PPVm8Dsz.js";import{o as ae,a as se}from"../chunks/BHyL2apj.js";import{i as V}from"../chunks/DNv7RG3c.js";import{b as ne}from"../chunks/DWj8Yt1E.js";import{w as re}from"../chunks/DZKKosdP.js";var ie=y('<span class="status-dot online svelte-maclc7"></span> <span>Connected</span>',1),oe=y('<span class="status-dot offline svelte-maclc7"></span> <span>Disconnected</span>',1),le=y('<div class="error-banner svelte-maclc7"><span> </span></div>'),ce=y('<div class="terminal-wrapper svelte-maclc7"><div class="terminal-header svelte-maclc7"><div class="terminal-title svelte-maclc7"><span class="terminal-id svelte-maclc7"> </span> <div class="status svelte-maclc7"><!></div></div> <div class="actions svelte-maclc7"><button class="brutal-btn small">Reconnect</button> <button class="brutal-btn small danger svelte-maclc7">Kill</button></div></div> <!> <div class="terminal-container svelte-maclc7"></div></div>');function de(p,r){j(r,!0);let m,t,o,l=null,e=null,h=W(!1),f=W(null);ae(()=>{(async()=>{try{const{Terminal:a}=await K(async()=>{const{Terminal:d}=await import("../chunks/BsaJHqEK.js").then(g=>g.x);return{Terminal:d}},[],import.meta.url),{FitAddon:c}=await K(async()=>{const{FitAddon:d}=await import("../chunks/DX4qG4td.js");return{FitAddon:d}},[],import.meta.url);t=new a({cursorBlink:!0,fontSize:14,fontFamily:"JetBrains Mono, monospace",theme:{background:"#0a0a0a",foreground:"#33ff00",cursor:"#33ff00",black:"#000000",red:"#ff0000",green:"#33ff00",yellow:"#ffaa00",blue:"#0099ff",magenta:"#ff00ff",cyan:"#00ffff",white:"#ffffff"},scrollback:1e4,tabStopWidth:4}),o=new c,t.loadAddon(o),t.open(m),o.fit(),_(),t.onData(d=>{e&&e.readyState===WebSocket.OPEN&&e.send(JSON.stringify({type:"input",data:d,terminalId:r.id}))}),l=()=>{if(o.fit(),e&&e.readyState===WebSocket.OPEN){const d={cols:t.cols,rows:t.rows};e.send(JSON.stringify({type:"resize",...d,terminalId:r.id}))}},window.addEventListener("resize",l),l()}catch(a){console.error(`[TERMINAL ${r.id}] Failed to initialize:`,a),N(f,"Failed to initialize terminal")}})()});function _(){const a=window.location.protocol==="https:"?"wss:":"ws:",c=`terminal-${r.id}`,d=`${a}//${window.location.host}/ws/terminal?sessionId=${c}`;t.writeln(`\x1B[1;32m[Connecting to session ${c}...]\x1B[0m`),e=new WebSocket(d),e.onopen=()=>{N(h,!0),N(f,null),t.writeln(`\x1B[1;32m[Connected]\x1B[0m\r
`),t.focus(),l?.()},e.onmessage=g=>{t.write(g.data)},e.onerror=g=>{console.error(`[TERMINAL ${r.id}] WebSocket error:`,g),N(f,"Connection error"),t.writeln(`\r
\x1B[1;31m[Connection error]\x1B[0m`)},e.onclose=()=>{N(h,!1),t.writeln(`\r
\x1B[1;33m[Disconnected]\x1B[0m`),setTimeout(()=>{t&&!e&&(t.writeln("\x1B[1;33m[Reconnecting...]\x1B[0m"),_())},3e3)}}function O(){e&&(e.onclose=null,e.close(),e=null),setTimeout(()=>_(),500)}function S(){e&&e.readyState===WebSocket.OPEN&&e.send(JSON.stringify({type:"kill"})),r.onDestroy&&r.onDestroy()}se(()=>{e&&(e.onclose=null,e.close()),t&&t.dispose(),l&&window.removeEventListener("resize",l)});var T=ce(),b=n(T),k=n(b),x=n(k),D=n(x);s(x);var i=v(x,2),u=n(i);{var I=a=>{var c=ie();F(2),w(a,c)},L=a=>{var c=oe();F(2),w(a,c)};V(u,a=>{E(h)?a(I):a(L,!1)})}s(i),s(k);var M=v(k,2),z=n(M);z.__click=O;var U=v(z,2);U.__click=S,s(M),s(b);var P=v(b,2);{var $=a=>{var c=le(),d=n(c),g=n(d);s(d),s(c),R(()=>J(g,`⚠️ ${E(f)??""}`)),w(a,c)};V(P,a=>{E(f)&&a($)})}var X=v(P,2);ne(X,a=>m=a,()=>m),s(T),R(()=>J(D,`Terminal ${r.id??""}`)),w(p,T),B()}G(["click"]);const A="kraliki-terminals";function me(){const p=localStorage.getItem(A);if(p)try{return JSON.parse(p)}catch{return[1]}return[1]}function ve(){const p=me(),{subscribe:r,set:m,update:t}=re(p);return{subscribe:r,add:o=>t(l=>{const e=[...l,o];return localStorage.setItem(A,JSON.stringify(e)),e}),remove:o=>t(l=>{const e=l.filter(h=>h!==o);return localStorage.setItem(A,JSON.stringify(e)),e}),set:o=>{localStorage.setItem(A,JSON.stringify(o)),m(o)}}}const C=ve();var fe=y('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css"/>'),pe=y('<div class="terminal-slot svelte-1dhdpeh"><!></div>'),ue=y('<div class="terminal-page svelte-1dhdpeh"><div class="page-header svelte-1dhdpeh"><h2 class="svelte-1dhdpeh">Terminal</h2> <div class="controls svelte-1dhdpeh"><button class="brutal-btn"> </button></div></div> <div class="terminals-grid svelte-1dhdpeh"></div> <div class="terminal-info svelte-1dhdpeh"><p class="svelte-1dhdpeh"><strong class="svelte-1dhdpeh">Status:</strong> Terminals are persistent. Navigating away will NOT close your sessions.</p> <p class="svelte-1dhdpeh"><strong class="svelte-1dhdpeh">Persistence:</strong> Use the "KILL" button to permanently end a session and its background process.</p> <p class="svelte-1dhdpeh"><strong class="svelte-1dhdpeh">Shortcuts:</strong> Ctrl+C (interrupt), Ctrl+D (exit), Ctrl+L (clear)</p> <p class="svelte-1dhdpeh"><strong class="svelte-1dhdpeh">Max terminals:</strong> </p></div></div>');function Ae(p,r){j(r,!1);const m=()=>te(C,"$activeTerminals",t),[t,o]=ee(),l=4;function e(){const i=m();if(i.length<l){const u=i.length>0?Math.max(...i)+1:1;C.add(u)}}function h(i){C.remove(i)}Z();var f=ue();Q("1dhdpeh",i=>{var u=fe();Y(()=>{q.title="Terminal - Kraliki Swarm"}),w(i,u)});var _=n(f),O=v(n(_),2),S=n(O);S.__click=e;var T=n(S);s(S),s(O),s(_);var b=v(_,2);H(b,5,m,i=>i,(i,u)=>{var I=pe(),L=n(I);de(L,{get id(){return E(u)},onDestroy:()=>h(E(u))}),s(I),w(i,I)}),s(b);var k=v(b,2),x=v(n(k),6),D=v(n(x));D.nodeValue=" 4",s(x),s(k),s(f),R(()=>{S.disabled=m().length>=l,J(T,`+ Add Terminal (${m().length??""}/4)`)}),w(p,f),B(),o()}G(["click"]);export{Ae as component};
