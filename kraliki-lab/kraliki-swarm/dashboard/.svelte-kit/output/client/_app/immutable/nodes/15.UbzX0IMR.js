import{f as h,a as p,c as ve}from"../chunks/CZY_NlAX.js";import{o as ne}from"../chunks/BHyL2apj.js";import{ag as ce,al as t,an as w,ai as ie,G as V,aj as W,ak as a,am as e,m as s,ah as Ts,aq as L,ao as js,ar as oe}from"../chunks/CHIrzwsT.js";import{s as n}from"../chunks/DsvTbyZG.js";import{i as O}from"../chunks/DNv7RG3c.js";import{e as Z,i as ss}from"../chunks/De-eo5w8.js";import{d as de}from"../chunks/CaHQap0G.js";import{s as x}from"../chunks/U6XQp83X.js";import{s as pe}from"../chunks/CuoGBMhC.js";var _e=h('<div class="card svelte-3hm2cj" style="border-color: var(--system-red);"><h2 class="red svelte-3hm2cj">CONNECTION_ERROR</h2> <p class="error-msg svelte-3hm2cj"> </p></div>'),he=h('<span class="pulse-dot green big svelte-3hm2cj"></span>'),me=h('<span class="pulse-dot yellow big svelte-3hm2cj"></span>'),ue=h('<span class="pulse-dot red big pulse-brutal svelte-3hm2cj"></span>'),je=h('<span class="issue-count svelte-3hm2cj"> </span>'),fe=h('<div class="card svelte-3hm2cj"><h2 class="svelte-3hm2cj">SYSTEM_RESOURCES</h2> <div class="stat-row svelte-3hm2cj"><span class="stat-label svelte-3hm2cj">Uptime</span> <span class="stat-value cyan svelte-3hm2cj"> </span></div> <div class="stat-row svelte-3hm2cj"><span class="stat-label svelte-3hm2cj">Load Average</span> <span> </span></div> <div class="stat-row svelte-3hm2cj"><span class="stat-label svelte-3hm2cj">Memory Used</span> <span> </span></div> <div class="memory-bar svelte-3hm2cj"><div></div></div></div>'),ge=h('<div class="issue-item svelte-3hm2cj"><span class="issue-name svelte-3hm2cj"> </span> <span> </span></div>'),ye=h('<div class="issues-section svelte-3hm2cj"><h3 class="svelte-3hm2cj">ISSUES_DETECTED</h3> <!></div>'),be=h('<div><h2>PM2_PROCESSES</h2> <div class="pm2-stats svelte-3hm2cj"><div class="pm2-stat svelte-3hm2cj"><span class="pm2-count green svelte-3hm2cj"> </span> <span class="pm2-label svelte-3hm2cj">ONLINE</span></div> <div class="pm2-stat svelte-3hm2cj"><span class="pm2-count yellow svelte-3hm2cj"> </span> <span class="pm2-label svelte-3hm2cj">STOPPED</span></div> <div class="pm2-stat svelte-3hm2cj"><span class="pm2-count red svelte-3hm2cj"> </span> <span class="pm2-label svelte-3hm2cj">ERRORED</span></div></div> <!></div>'),xe=h('<div class="cb-note svelte-3hm2cj"> </div>'),Ee=h('<div class="cb-reason svelte-3hm2cj"> </div>'),Se=h('<span class="svelte-3hm2cj"> </span>'),Ce=h('<span class="svelte-3hm2cj"> </span>'),ke=h('<div><div class="cb-header svelte-3hm2cj"><span class="cb-name svelte-3hm2cj"> </span> <span class="cb-state svelte-3hm2cj"><span></span> </span></div> <!> <!> <div class="cb-times svelte-3hm2cj"><!> <!></div></div>'),we=h('<div><h2> </h2> <p class="hint svelte-3hm2cj">CLI health status. Open = failing, Closed = healthy, Half-open = recovering.</p> <div class="cb-grid svelte-3hm2cj"></div></div>'),Oe=h('<div><div class="ep-info svelte-3hm2cj"><span class="ep-name svelte-3hm2cj"> </span> <span class="ep-url svelte-3hm2cj"> </span></div> <div class="ep-status svelte-3hm2cj"><span></span> <span class="svelte-3hm2cj"> </span></div></div>'),Re=h('<div class="card svelte-3hm2cj"><h2 class="svelte-3hm2cj">ENDPOINT_HEALTH</h2> <div class="endpoint-list svelte-3hm2cj"></div></div>'),Te=h('<span class="check-msg svelte-3hm2cj"> </span>'),Ie=h('<div><span class="check-name svelte-3hm2cj"> </span> <span class="check-status svelte-3hm2cj"><span></span> </span> <!></div>'),Me=h('<div class="card svelte-3hm2cj"><h2 class="svelte-3hm2cj">SERVICE_CHECKS</h2> <div class="check-list svelte-3hm2cj"></div></div>'),$e=h('<div><span class="proc-name svelte-3hm2cj"> </span> <span class="proc-status svelte-3hm2cj"><span></span> </span> <span> </span> <span class="svelte-3hm2cj"> </span> <span class="svelte-3hm2cj"> </span> <span class="svelte-3hm2cj"> </span></div>'),Ue=h('<div class="card span-2 svelte-3hm2cj"><h2 class="svelte-3hm2cj">PM2_PROCESS_LIST</h2> <div class="process-table svelte-3hm2cj"><div class="process-row header svelte-3hm2cj"><span class="svelte-3hm2cj">NAME</span> <span class="svelte-3hm2cj">STATUS</span> <span class="svelte-3hm2cj">RESTARTS</span> <span class="svelte-3hm2cj">UPTIME</span> <span class="svelte-3hm2cj">CPU%</span> <span class="svelte-3hm2cj">MEM</span></div> <!></div></div>'),De=h('<div><div class="status-icon svelte-3hm2cj"><!></div> <div class="status-text svelte-3hm2cj"><span class="status-label svelte-3hm2cj">SYSTEM_STATUS</span> <span class="status-value svelte-3hm2cj"> </span></div> <div class="status-summary svelte-3hm2cj"><span class="svelte-3hm2cj"> </span> <span class="svelte-3hm2cj"> </span> <!></div></div> <div class="grid svelte-3hm2cj"><!> <!> <!> <!> <!> <!></div>',1),Ne=h('<div class="page svelte-3hm2cj"><div class="page-header svelte-3hm2cj"><h2 class="glitch svelte-3hm2cj">System Health // Diagnostics</h2> <div class="header-controls svelte-3hm2cj"><span class="last-update svelte-3hm2cj"> </span> <button class="brutal-btn svelte-3hm2cj"> </button></div></div> <!></div>');function qe(Is,Ms){ce(Ms,!0);let vs=W(null),P=W(null),es=W(!0),as=W(null),fs=W("--");const $s={linear_api:"LINEAR",claude_cli:"CLAUDE",codex_cli:"CODEX",gemini_cli:"GEMINI",opencode_cli:"OPENCODE"};async function ns(){V(es,!0);try{const[o,_]=await Promise.all([fetch("/api/health"),fetch("/api/status")]);o.ok&&V(vs,await o.json(),!0),_.ok&&V(P,await _.json(),!0),V(fs,new Date().toLocaleTimeString(),!0),V(as,null)}catch(o){V(as,o instanceof Error?o.message:"Failed to fetch health data",!0)}finally{V(es,!1)}}function Us(o){const _=Math.floor(o/1e3),U=Math.floor(_/3600),H=Math.floor(_%3600/60);return U>0?`${U}h ${H}m`:`${H}m`}function gs(o){return`${(o/1024/1024).toFixed(1)} GB`}function Ds(o){const _=o/1024/1024;return _>=1024?`${(_/1024).toFixed(1)} GB`:`${_.toFixed(0)} MB`}function Ns(){if(!s(P)?.kraliki)return"unhealthy";const o=s(P).kraliki.pm2,_=Object.values(s(P).circuitBreakers||{}).filter(U=>U.state==="open").length;return o.errored>0||_>2?"unhealthy":o.stopped>0||_>0?"degraded":"healthy"}ne(()=>{ns();const o=setInterval(ns,3e4);return()=>clearInterval(o)});const X=L(Ns),$=L(()=>s(P)?.kraliki?.pm2||null),I=L(()=>s(P)?.kraliki?.system||null),ys=L(()=>s(P)?.kraliki?.health?.endpoints||[]),ts=L(()=>s(P)?.kraliki?.health?.pm2_issues||[]),As=L(()=>s(P)?.circuitBreakers||{}),z=L(()=>Object.entries(s(As))),ls=L(()=>s(z).filter(([o,_])=>_.state==="open").length),Ls=L(()=>s(z).filter(([o,_])=>_.state==="closed").length);var cs=Ne(),is=a(cs),bs=t(a(is),2),os=a(bs),Ps=a(os);e(os);var rs=t(os,2);rs.__click=ns;var Fs=a(rs,!0);e(rs),e(bs),e(is);var Bs=t(is,2);{var Hs=o=>{var _=_e(),U=t(a(_),2),H=a(U,!0);e(U),e(_),w(()=>n(H,s(as))),p(o,_)},Gs=o=>{var _=De(),U=Ts(_);let H;var ds=a(U),Ks=a(ds);{var Ys=r=>{var v=he();p(r,v)},qs=r=>{var v=ve(),m=Ts(v);{var f=l=>{var d=me();p(l,d)},c=l=>{var d=ue();p(l,d)};O(m,l=>{s(X)==="degraded"?l(f):l(c,!1)},!0)}p(r,v)};O(Ks,r=>{s(X)==="healthy"?r(Ys):r(qs,!1)})}e(ds);var ps=t(ds,2),xs=t(a(ps),2),Vs=a(xs,!0);e(xs),e(ps);var Es=t(ps,2),_s=a(Es),Xs=a(_s);e(_s);var hs=t(_s,2),zs=a(hs);e(hs);var Js=t(hs,2);{var Qs=r=>{var v=je(),m=a(v);e(v),w(()=>n(m,`${s(ts).length??""} ISSUES`)),p(r,v)};O(Js,r=>{s(ts).length>0&&r(Qs)})}e(Es),e(U);var Ss=t(U,2),Cs=a(Ss);{var Ws=r=>{var v=fe(),m=t(a(v),2),f=t(a(m),2),c=a(f);e(f),e(m);var l=t(m,2),d=t(a(l),2);let g;var R=a(d,!0);e(d),e(l);var y=t(l,2),j=t(a(y),2);let i;var E=a(j);e(j),e(y);var T=t(y,2),b=a(T);let u;e(T),e(v),w((S,M,N,A,G,D)=>{n(c,`${S??""}D ${M??""}H`),g=x(d,1,"stat-value svelte-3hm2cj",null,g,{red:s(I).load_avg[0]>4,yellow:s(I).load_avg[0]>2}),n(R,N),i=x(j,1,"stat-value svelte-3hm2cj",null,i,{red:s(I).memory.percent_used>90,yellow:s(I).memory.percent_used>75}),n(E,`${A??""} / ${G??""} (${D??""}%)`),u=x(b,1,"memory-fill svelte-3hm2cj",null,u,{high:s(I).memory.percent_used>75,critical:s(I).memory.percent_used>90}),pe(b,`width: ${s(I).memory.percent_used??""}%;`)},[()=>Math.floor((s(I).uptime_seconds||0)/86400),()=>Math.floor((s(I).uptime_seconds||0)%86400/3600),()=>s(I).load_avg.map(S=>S.toFixed(2)).join(" / "),()=>gs(s(I).memory.used_kb),()=>gs(s(I).memory.total_kb),()=>s(I).memory.percent_used.toFixed(1)]),p(r,v)};O(Cs,r=>{s(I)&&r(Ws)})}var ks=t(Cs,2);{var Zs=r=>{var v=be();let m;var f=a(v);let c;var l=t(f,2),d=a(l),g=a(d),R=a(g,!0);e(g),js(2),e(d);var y=t(d,2),j=a(y),i=a(j,!0);e(j),js(2),e(y);var E=t(y,2),T=a(E),b=a(T,!0);e(T),js(2),e(E),e(l);var u=t(l,2);{var S=M=>{var N=ye(),A=t(a(N),2);Z(A,17,()=>s(ts),ss,(G,D)=>{var K=ge(),F=a(K),J=a(F,!0);e(F);var B=t(F,2);let Y;var ms=a(B,!0);e(B),e(K),w(us=>{n(J,s(D).name),Y=x(B,1,"issue-status svelte-3hm2cj",null,Y,{stopped:s(D).status==="stopped",errored:s(D).status==="errored"}),n(ms,us)},[()=>s(D).status.toUpperCase()]),p(G,K)}),e(N),p(M,N)};O(u,M=>{s(ts).length>0&&M(S)})}e(v),w(()=>{m=x(v,1,"card svelte-3hm2cj",null,m,{"pulse-scan":s($).stopped>0||s($).errored>0}),c=x(f,1,"svelte-3hm2cj",null,c,{red:s($).errored>0,yellow:s($).stopped>0}),n(R,s($).online),n(i,s($).stopped),n(b,s($).errored)}),p(r,v)};O(ks,r=>{s($)&&r(Zs)})}var ws=t(ks,2);{var se=r=>{var v=we();let m;var f=a(v);let c;var l=a(f);e(f);var d=t(f,4);Z(d,21,()=>s(z),ss,(g,R)=>{var y=L(()=>oe(s(R),2));let j=()=>s(y)[0],i=()=>s(y)[1];var E=ke();let T;var b=a(E),u=a(b),S=a(u,!0);e(u);var M=t(u,2),N=a(M);let A;var G=t(N);e(M),e(b);var D=t(b,2);{var K=C=>{var k=xe(),q=a(k,!0);e(k),w(()=>n(q,i().note)),p(C,k)};O(D,C=>{i().note&&C(K)})}var F=t(D,2);{var J=C=>{var k=Ee(),q=a(k,!0);e(k),w(Q=>n(q,Q),[()=>i().last_failure_reason.slice(0,100)]),p(C,k)};O(F,C=>{i().last_failure_reason&&i().state==="open"&&C(J)})}var B=t(F,2),Y=a(B);{var ms=C=>{var k=Se(),q=a(k);e(k),w(Q=>n(q,`OK: ${Q??""}`),[()=>new Date(i().last_success_time).toLocaleTimeString()]),p(C,k)};O(Y,C=>{i().last_success_time&&i().state!=="open"&&C(ms)})}var us=t(Y,2);{var re=C=>{var k=Ce(),q=a(k);e(k),w(Q=>n(q,`FAIL: ${Q??""}`),[()=>new Date(i().last_failure_time).toLocaleTimeString()]),p(C,k)};O(us,C=>{i().last_failure_time&&C(re)})}e(B),e(E),w((C,k)=>{T=x(E,1,"cb-card svelte-3hm2cj",null,T,{"cb-open":i().state==="open","cb-closed":i().state==="closed","cb-half":i().state==="half-open"}),n(S,C),A=x(N,1,"pulse-dot svelte-3hm2cj",null,A,{green:i().state==="closed",red:i().state==="open",yellow:i().state==="half-open"}),n(G,` ${k??""}`)},[()=>$s[j()]||j().toUpperCase(),()=>i().state.toUpperCase()]),p(g,E)}),e(d),e(v),w(()=>{m=x(v,1,"card span-2 svelte-3hm2cj",null,m,{"pulse-scan":s(ls)>0}),c=x(f,1,"svelte-3hm2cj",null,c,{red:s(ls)>0}),n(l,`CIRCUIT_BREAKERS // ${s(ls)>0?`${s(ls)} TRIPPED`:"ALL_OK"}`)}),p(r,v)};O(ws,r=>{s(z).length>0&&r(se)})}var Os=t(ws,2);{var ee=r=>{var v=Re(),m=t(a(v),2);Z(m,21,()=>s(ys),ss,(f,c)=>{var l=Oe();let d;var g=a(l),R=a(g),y=a(R,!0);e(R);var j=t(R,2),i=a(j,!0);e(j),e(g);var E=t(g,2),T=a(E);let b;var u=t(T,2),S=a(u,!0);e(u),e(E),e(l),w(()=>{d=x(l,1,"endpoint-item svelte-3hm2cj",null,d,{healthy:s(c).status==="healthy",unhealthy:s(c).status!=="healthy"}),n(y,s(c).name),n(i,s(c).url),b=x(T,1,"pulse-dot svelte-3hm2cj",null,b,{green:s(c).status==="healthy",red:s(c).status!=="healthy"}),n(S,s(c).status_code)}),p(f,l)}),e(m),e(v),p(r,v)};O(Os,r=>{s(ys).length>0&&r(ee)})}var Rs=t(Os,2);{var ae=r=>{var v=Me(),m=t(a(v),2);Z(m,21,()=>s(vs).checks,ss,(f,c)=>{var l=Ie();let d;var g=a(l),R=a(g,!0);e(g);var y=t(g,2),j=a(y);let i;var E=t(j);e(y);var T=t(y,2);{var b=u=>{var S=Te(),M=a(S,!0);e(S),w(()=>n(M,s(c).message)),p(u,S)};O(T,u=>{s(c).message&&u(b)})}e(l),w((u,S)=>{d=x(l,1,"check-item svelte-3hm2cj",null,d,{healthy:s(c).status==="healthy",unhealthy:s(c).status==="unhealthy",unknown:s(c).status==="unknown"}),n(R,u),i=x(j,1,"pulse-dot svelte-3hm2cj",null,i,{green:s(c).status==="healthy",red:s(c).status==="unhealthy",yellow:s(c).status==="unknown"}),n(E,` ${S??""}`)},[()=>s(c).service.toUpperCase(),()=>s(c).status.toUpperCase()]),p(f,l)}),e(m),e(v),p(r,v)};O(Rs,r=>{s(vs)?.checks&&r(ae)})}var te=t(Rs,2);{var le=r=>{var v=Ue(),m=t(a(v),2),f=t(a(m),2);Z(f,17,()=>s($).processes,ss,(c,l)=>{var d=$e();let g;var R=a(d),y=a(R,!0);e(R);var j=t(R,2),i=a(j);let E;var T=t(i);e(j);var b=t(j,2);let u;var S=a(b,!0);e(b);var M=t(b,2),N=a(M,!0);e(M);var A=t(M,2),G=a(A,!0);e(A);var D=t(A,2),K=a(D,!0);e(D),e(d),w((F,J,B,Y)=>{g=x(d,1,"process-row svelte-3hm2cj",null,g,{online:s(l).status==="online",stopped:s(l).status==="stopped",errored:s(l).status==="errored"}),n(y,s(l).name),E=x(i,1,"pulse-dot svelte-3hm2cj",null,E,{green:s(l).status==="online",red:s(l).status!=="online"}),n(T,` ${F??""}`),u=x(b,1,"svelte-3hm2cj",null,u,{"high-restarts":s(l).restarts>5}),n(S,s(l).restarts),n(N,J),n(G,B),n(K,Y)},[()=>s(l).status.toUpperCase(),()=>Us(s(l).uptime),()=>s(l).cpu.toFixed(1),()=>Ds(s(l).memory)]),p(c,d)}),e(m),e(v),p(r,v)};O(te,r=>{s($)?.processes&&r(le)})}e(Ss),w(r=>{H=x(U,1,"status-banner svelte-3hm2cj",null,H,{healthy:s(X)==="healthy",degraded:s(X)==="degraded",unhealthy:s(X)==="unhealthy"}),n(Vs,r),n(Xs,`PM2: ${(s($)?.online||0)??""}/${(s($)?.total||0)??""}`),n(zs,`CB: ${s(Ls)??""}/${s(z).length??""} OK`)},[()=>s(X).toUpperCase()]),p(o,_)};O(Bs,o=>{s(as)?o(Hs):o(Gs,!1)})}e(cs),w(()=>{n(Ps,`LAST_SCAN: ${s(fs)??""}`),rs.disabled=s(es),n(Fs,s(es)?"SCANNING...":"REFRESH")}),p(Is,cs),ie()}de(["click"]);export{qe as component};
